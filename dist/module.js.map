{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","$","_","moment","d3","MultistatPanelCtrl","$scope","$injector","variableSrv","panelDefaults","timeFrom","timeShift","BarPadding","BaseLineColor","BaseLineWidth","BaseLineValue","DateTimeColName","DateFormat","TooltipDateFormat","FlashHighLimitBar","FlashLowLimitBar","HighAxisColor","HighAxisWidth","HighBarColor","RecolorColName","HighLimitBarColor","HighLimitBarFlashColor","HighLimitBarFlashTimeout","HighLimitLineColor","HighLimitValue","HighLmitLineWidth","HighSideMargin","Horizontal","LabelColName","LabelNameFilter","LabelColor","OutOfRangeLabelColor","GroupLabelColor","LabelFontSize","GroupLabelFontSize","GroupGap","LabelMargin","Links","LowAxisColor","LowAxisWidth","LowBarColor","LowLimitBarColor","LowLimitBarFlashColor","LowLimitBarFlashTimeout","LowLimitLineColor","LowLimitValue","LowLmitLineWidth","LowSideMargin","MaxLineColor","MaxLineWidth","MaxLineValue","MinLineColor","MinLineWidth","MinLineValue","RecolorHighLimitBar","RecolorLowLimitBar","RecolorRules","ShowBaseLine","ShowDate","Aggregate","ShowHighLimitLine","ShowLabels","ShowGroupLabels","ShowLeftAxis","ShowLowLimitLine","ShowMaxLine","ShowMinLine","ShowRightAxis","ShowTooltips","ShowValues","SortColName","SortDirection","TZOffsetHours","ValueColName","ValueDecimals","ValueColor","ValueFontSize","OddRowColor","EvenRowColor","OutlineColor","GroupSortString","GroupCols","GroupNameFilter","ScaleFactor","ValuePosition","LableAngle","ShowBars","ShowLines","LineWidth","LineColor","DotSize","DotColor","CurveType","defaults","panel","variables","forEach","v","console","log","name","current","value","updateNamedValue","split","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","onDataSnapshotLoad","className","id","obj","names","shift","length","Number","snapshotData","err","seriesList","data","displayStatusMessage","status","statusText","metricNames","sortDirections","aggregations","fontSizes","valuePositions","curveTypes","matchTypes","addEditorTab","cols","rows","render","type","columns","i","text","cols0","concat","index","up","ctrl","splice","dateTimeCol","$title","elem","closest","find","$maxDate","append","children","last","maxDate","dd","add","toUpperCase","fromNow","show","format","hide","msg","html","labelCol","valueCol","sortCol","groupCol","recolorCol","GroupColName","groupedLabelFunc","regex","RegExp","matchingRows","label","match","push","oo","nest","key","rollup","d","entries","x","Object","values","assign","mean","Array","from","max","min","groupNameOffset","replace","groupedRows","regexGroupRows","matchingGroups","groupName","groupSortString","sort","a","b","aPos","search","bPos","localeCompare","$container","h","height","w","width","buildDateHtml","horizontal","labelMargin","isNumeric","lowSideMargin","highSideMargin","svg","select","selectAll","interrupt","barPadding","baseLineValue","minLineValue","maxLineValue","highBarColor","lowBarColor","highLimitValue","recolorHighLimitBar","lowLimitValue","recolorLowLimitBar","flashHighLimitBar","flashLowLimitBar","showTooltips","panelID","tooltipDivID","minValue","maxValue","remove","sortData","sortDirection","ascending","y","xx","yy","translateValues","s","s1","re","g","exec","getTooltipContent","cc","toFixed","l","url","newtab","isInTooltip","$panel","$panelContent","panelContent","tooltipShow","parent","attr","style","tooltipDiv","classed","tooltipHide","$tooltipDiv","tooltipWidth","tooltipHeight","minTop","mouseCoordinates","mouse","node","Left","Top","panelWidth","panelHeight","transition","duration","cancel","scaleAndClipValue","val","getBarColor","recolorString","recolorRule","r","pattern","matchType","test","indexOf","color","Option","plotGroupHorizontal","numRows","left","hh","dh","labels","map","Math","random","toString","substr","labelScale","scaleBand","domain","rangeRound","paddingInner","paddingOuter","stripedata","range","stripeScale","oddeven","enter","step","g1","maxValueWidth","bandwidth","each","thisWidth","getComputedTextLength","maxLabelWidth","labelAngle","bbox","getBBox","sin","PI","c","cos","abs","valueScale","scaleLinear","nice","vLine","strokeWidth","HighLimitLineWidth","LowLimitLineWidth","points","bw","curveFunc","curveLinear","curveMonotoneY","curveCardinal","curveCatmullRom","lineFunction","line","curve","lineGraph","ggHighSide","call","axisTop","ggLowSide","axisBottom","gcols","dw","pointsPerRow","rr","floor","u","totalPoints","rowOverheadHeight","rowHeight","ceil","nn","ii","plotGroupVertical","g2","maxValueHeight","thisHeight","maxLabelHeight","hLine","curveMonotoneX","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","pointsPerCol","colOverheadWidth","colWidth","ww","pulseHigh","highFlashRects","_groups","highRepeat","active","pulseLow","lowFlashRects","lowRepeat","renderingCompleted","refresh","scope","attrs","panelContentElem","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["/*jshint esversion: 6 */\r\n/*jshint -W087 */\r\n/*jshint -W014 */\r\nimport { MetricsPanelCtrl } from \"app/plugins/sdk\";\r\nimport $ from \"jquery\";\r\nimport \"jquery.flot\";\r\nimport _ from \"lodash\";\r\nimport moment from \"moment\";\r\nimport \"./css/multistat-panel.css!\";\r\nimport d3 from \"./external/d3.min\";\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n  /** @ngInject */\r\n  constructor($scope, $injector, variableSrv) {\r\n    super($scope, $injector, variableSrv);\r\n\r\n    var panelDefaults = {\r\n      timeFrom: null,\r\n      timeShift: null,\r\n      BarPadding: 10,\r\n      BaseLineColor: \"#ff0000\",\r\n      BaseLineWidth: 1,\r\n      BaseLineValue: null,\r\n      DateTimeColName: \"date\",\r\n      DateFormat: \"YYYY-MM-DD HH:mm:ss\",\r\n      TooltipDateFormat: \"YYYY-MM-DD HH:mm:ss\",\r\n      FlashHighLimitBar: false,\r\n      FlashLowLimitBar: false,\r\n      HighAxisColor: \"#ffffff\",\r\n      HighAxisWidth: 1,\r\n      HighBarColor: \"rgb(120, 128, 0)\",\r\n      RecolorColName: null,\r\n      HighLimitBarColor: \"#ff0000\",\r\n      HighLimitBarFlashColor: \"#ffa500\",\r\n      HighLimitBarFlashTimeout: 1000,\r\n      HighLimitLineColor: \"#ff0000\",\r\n      HighLimitValue: null,\r\n      HighLmitLineWidth: 1,\r\n      HighSideMargin: 22,\r\n      Horizontal: false,\r\n      LabelColName: \"\",\r\n      LabelNameFilter: \"\",\r\n      LabelColor: \"#ffffff\",\r\n      OutOfRangeLabelColor: \"#ffffff\",\r\n      GroupLabelColor: \"#ffffff\",\r\n      LabelFontSize: \"100%\",\r\n      GroupLabelFontSize: \"200%\",\r\n      GroupGap: 5,\r\n      LabelMargin: null,\r\n      Links: [],\r\n      LowAxisColor: \"#ffffff\",\r\n      LowAxisWidth: 1,\r\n      LowBarColor: \"teal\",\r\n      LowLimitBarColor: \"#ff0000\",\r\n      LowLimitBarFlashColor: \"#ffa500\",\r\n      LowLimitBarFlashTimeout: 200,\r\n      LowLimitLineColor: \"#ff0000\",\r\n      LowLimitValue: null,\r\n      LowLmitLineWidth: 1,\r\n      LowSideMargin: 22,\r\n      MaxLineColor: \"rgb(74, 232, 12)\",\r\n      MaxLineWidth: 1,\r\n      MaxLineValue: null,\r\n      MinLineColor: \"#ff0000\",\r\n      MinLineWidth: 1,\r\n      MinLineValue: null,\r\n      RecolorHighLimitBar: false,\r\n      RecolorLowLimitBar: false,\r\n      RecolorRules: [],\r\n      ShowBaseLine: false,\r\n      ShowDate: false,\r\n      Aggregate: \"last\",\r\n      ShowHighLimitLine: false,\r\n      ShowLabels: true,\r\n      ShowGroupLabels: true,\r\n      ShowLeftAxis: true,\r\n      ShowLowLimitLine: false,\r\n      ShowMaxLine: false,\r\n      ShowMinLine: false,\r\n      ShowRightAxis: true,\r\n      ShowTooltips: true,\r\n      ShowValues: true,\r\n      SortColName: \"value\",\r\n      SortDirection: \"ascending\",\r\n      TZOffsetHours: 0,\r\n      ValueColName: \"temperature\",\r\n      ValueDecimals: 2,\r\n      ValueColor: \"#ffffff\",\r\n      ValueFontSize: \"100%\",\r\n      OddRowColor: \"rgba(33, 33, 34, 0.92)\",\r\n      EvenRowColor: \"rgba(61, 61, 64, 0.78)\",\r\n      OutlineColor: \"rgba(245, 255, 0, 0.1)\",\r\n      GroupSortString: \"\",\r\n      GroupCols: 0,\r\n      GroupNameFilter: \"\",\r\n      ScaleFactor: 1,\r\n      ValuePosition: \"top\",\r\n      LableAngle: 0,\r\n      ShowBars: true,\r\n      ShowLines: false,\r\n      LineWidth: 5,\r\n      LineColor: \"blue\",\r\n      DotSize: 10,\r\n      DotColor: \"white\",\r\n      CurveType: \"Monotone\",\r\n    };\r\n\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    variableSrv.variables.forEach((v) => {\r\n      console.log(\"dashboard variable[\" + v.name + \"]=\" + v.current.value);\r\n      this.updateNamedValue(this.panel, v.name.split(\"_\"), v.current.value);\r\n    });\r\n\r\n    this.events.on(\"render\", this.onRender.bind(this));\r\n    this.events.on(\"data-received\", this.onDataReceived.bind(this));\r\n    this.events.on(\"data-error\", this.onDataError.bind(this));\r\n    this.events.on(\"init-edit-mode\", this.onInitEditMode.bind(this));\r\n    this.events.on(\"data-snapshot-load\", this.onDataSnapshotLoad.bind(this));\r\n\r\n    //    this.className = this.panelID;\r\n    this.className = \"michaeldmoore-multistat-panel-\" + this.panel.id;\r\n  }\r\n\r\n  updateNamedValue(obj, names, value) {\r\n    let name = names.shift();\r\n    if (obj[name]) {\r\n      if (names.length) this.updateNamedValue(obj[name], names, value);\r\n      else obj[name] = Number(value);\r\n    }\r\n  }\r\n\r\n  onDataSnapshotLoad(snapshotData) {\r\n    this.onDataReceived(snapshotData);\r\n  }\r\n\r\n  onDataError(err) {\r\n    this.seriesList = [];\r\n    this.data = [];\r\n    this.displayStatusMessage(\r\n      \"Query failure, Status=\" + err.status + \", \" + err.statusText\r\n    );\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.metricNames = [\r\n      \"min\",\r\n      \"max\",\r\n      \"avg\",\r\n      \"current\",\r\n      \"total\",\r\n      \"name\",\r\n      \"first\",\r\n      \"delta\",\r\n      \"diff\",\r\n      \"range\",\r\n    ];\r\n    this.sortDirections = [\"none\", \"ascending\", \"descending\"];\r\n    this.aggregations = [\"all\", \"last\", \"first\", \"mean\", \"max\", \"min\"];\r\n    this.fontSizes = [\r\n      \"20%\",\r\n      \"30%\",\r\n      \"50%\",\r\n      \"70%\",\r\n      \"80%\",\r\n      \"100%\",\r\n      \"110%\",\r\n      \"120%\",\r\n      \"150%\",\r\n      \"170%\",\r\n      \"200%\",\r\n      \"250%\",\r\n      \"300%\",\r\n      \"350%\",\r\n      \"400%\",\r\n    ];\r\n    this.valuePositions = [\"bar base\", \"bar end\", \"top\"];\r\n    this.curveTypes = [\"Linear\", \"Monotone\", \"Cardinal\", \"Catmull-Rom\"];\r\n    this.matchTypes = [\"exact\", \"subset\", \"list\", \"reg-ex\"];\r\n    this.addEditorTab(\r\n      \"Columns\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/columns.html\",\r\n      2\r\n    );\r\n    this.addEditorTab(\r\n      \"Layout\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/layout.html\",\r\n      3\r\n    );\r\n    this.addEditorTab(\r\n      \"Grouping\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/grouping.html\",\r\n      4\r\n    );\r\n    this.addEditorTab(\r\n      \"Options\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/options.html\",\r\n      5\r\n    );\r\n    this.addEditorTab(\r\n      \"Lines-and-Limits\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/linesandlimits.html\",\r\n      6\r\n    );\r\n    this.addEditorTab(\r\n      \"Bar links\",\r\n      \"public/plugins/michaeldmoore-multistat-panel/barlinks.html\",\r\n      7\r\n    );\r\n  }\r\n\r\n  onDataReceived(data) {\r\n    this.cols = [];\r\n    // console.log('onDataReceived(' + JSON.stringify(data) + ')');\r\n    if (data.length == 0) {\r\n      this.displayStatusMessage(\"No data to show\");\r\n      this.data = data;\r\n      this.rows = null;\r\n      this.render();\r\n    } else if (data[0].type == \"table\" || data[0].columns) {\r\n      this.data = data[0];\r\n\r\n      for (let i = 0; i < this.data.columns.length; i++)\r\n        this.cols[i] = this.data.columns[i].text;\r\n      this.cols0 = [\"\"].concat(this.cols);\r\n\r\n      this.render();\r\n    } else {\r\n      this.displayStatusMessage(\"Multistat only supports Table datasets\");\r\n      this.data = data;\r\n      this.rows = null;\r\n      this.render();\r\n\r\n      //      appEvents.emit(\"alert-error\", [\r\n      //        \"Non-Table type data received\",\r\n      //        \"Multistat does not support Time Series data sets\",\r\n      //      ]);\r\n    }\r\n  }\r\n\r\n  onReorderRecolorRules(index, up) {\r\n    const RecolorRules = this.ctrl.panel.RecolorRules;\r\n    if (up) {\r\n      if (index)\r\n        RecolorRules[index] = RecolorRules.splice(\r\n          index - 1,\r\n          1,\r\n          RecolorRules[index]\r\n        )[0];\r\n    } else {\r\n      if (index + 1 < RecolorRules.length)\r\n        RecolorRules[index] = RecolorRules.splice(\r\n          index + 1,\r\n          1,\r\n          RecolorRules[index]\r\n        )[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  onReorderLinks(index, up) {\r\n    const Links = this.ctrl.panel.Links;\r\n    if (up) {\r\n      if (index) Links[index] = Links.splice(index - 1, 1, Links[index])[0];\r\n    } else {\r\n      if (index + 1 < Links.length)\r\n        Links[index] = Links.splice(index + 1, 1, Links[index])[0];\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  buildDateHtml(dateTimeCol) {\r\n    var $title = this.elem.closest(\".panel-container\").find(\".panel-title\");\r\n    var $maxDate = $title.find(\"span.michaeldmoore-multistat-panel-maxDate\");\r\n\r\n    if ($maxDate.length == 0)\r\n      $maxDate = $title\r\n        .append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>')\r\n        .children()\r\n        .last();\r\n\r\n    if (dateTimeCol != -1 && this.panel.ShowDate) {\r\n      var maxDate = this.rows[0][dateTimeCol];\r\n\r\n      for (let i = 1; i < this.rows.length; i++) {\r\n        if (maxDate < this.rows[i][dateTimeCol])\r\n          maxDate = this.rows[i][dateTimeCol];\r\n      }\r\n\r\n      var dd = moment(maxDate).add(this.panel.TZOffsetHours, \"h\");\r\n\r\n      if (this.panel.DateFormat.toUpperCase() == \"ELAPSED\")\r\n        $maxDate.text(dd.fromNow()).show();\r\n      else $maxDate.text(dd.format(this.panel.DateFormat)).show();\r\n    } else $maxDate.hide();\r\n  }\r\n\r\n  displayStatusMessage(msg) {\r\n    this.elem.html(\r\n      \"<div class='michaeldmoore-multistat-panel-statusmessage'>\" +\r\n        msg +\r\n        \"</div>\"\r\n    );\r\n  }\r\n\r\n  onRender() {\r\n    if (this.data != null && this.data.rows && this.data.rows.length) {\r\n      var cols = this.cols;\r\n      var dateTimeCol = -1;\r\n      var labelCol = -1;\r\n      var valueCol = 0;\r\n      var sortCol = 0;\r\n      var groupCol = -1;\r\n      var recolorCol = -1;\r\n      for (let i = 0; i < cols.length; i++) {\r\n        if (cols[i] == this.panel.DateTimeColName) dateTimeCol = i;\r\n        if (cols[i] == this.panel.LabelColName) labelCol = i;\r\n        if (cols[i] == this.panel.ValueColName) valueCol = i;\r\n        if (cols[i] == this.panel.SortColName) sortCol = i;\r\n        if (cols[i] == this.panel.GroupColName) groupCol = i;\r\n        if (cols[i] == this.panel.RecolorColName) recolorCol = i;\r\n      }\r\n\r\n      const groupedLabelFunc = function (obj) {\r\n        if (groupCol != -1) return obj[groupCol] + \":\" + obj[labelCol];\r\n        else return obj[labelCol];\r\n      };\r\n\r\n      if (this.panel.LabelNameFilter.length > 0 && labelCol != -1) {\r\n        var regex = new RegExp(this.panel.LabelNameFilter, \"\");\r\n        this.matchingRows = [];\r\n        for (let i = 0; i < this.data.rows.length; i++) {\r\n          var dd = this.data.rows[i];\r\n          var label = dd[labelCol];\r\n          if (label.match(regex) != null) this.matchingRows.push(dd);\r\n        }\r\n\r\n        if (this.matchingRows.length == 0) {\r\n          this.displayStatusMessage(\r\n            \"No data.  Regex filter '\" +\r\n              this.panel.LabelNameFilter +\r\n              \"' eliminated all \" +\r\n              this.data.rows.length +\r\n              \" rows from current query\"\r\n          );\r\n          return;\r\n        }\r\n      } else this.matchingRows = this.data.rows;\r\n\r\n      if (this.panel.Aggregate != \"all\" && labelCol != -1) {\r\n        var oo = [];\r\n        this.rows = [];\r\n        switch (this.panel.Aggregate) {\r\n          case \"first\":\r\n            this.rows = d3\r\n              .nest()\r\n              .key(groupedLabelFunc)\r\n              .rollup(function (d) {\r\n                return d[0];\r\n              })\r\n              .entries(this.matchingRows)\r\n              .forEach(function (x) {\r\n                oo.push(x.value);\r\n              });\r\n            this.rows = oo;\r\n            break;\r\n\r\n          case \"last\":\r\n            this.rows = d3\r\n              .nest()\r\n              .key(groupedLabelFunc)\r\n              .rollup(function (d) {\r\n                return d[d.length - 1];\r\n              })\r\n              .entries(this.matchingRows)\r\n              .forEach(function (x) {\r\n                oo.push(x.value);\r\n              });\r\n            this.rows = oo;\r\n            break;\r\n\r\n          case \"mean\":\r\n            this.rows = d3\r\n              .nest()\r\n              .key(groupedLabelFunc)\r\n              .rollup(function (d) {\r\n                var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                dd[valueCol] = d3.mean(d, function (d) {\r\n                  return d[valueCol];\r\n                });\r\n                return dd;\r\n              })\r\n              .entries(this.matchingRows)\r\n              .forEach(function (x) {\r\n                oo.push(x.value);\r\n              });\r\n            this.rows = Array.from(oo);\r\n            break;\r\n\r\n          case \"max\":\r\n            this.rows = d3\r\n              .nest()\r\n              .key(groupedLabelFunc)\r\n              .rollup(function (d) {\r\n                var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                dd[valueCol] = d3.max(d, function (d) {\r\n                  return d[valueCol];\r\n                });\r\n                return dd;\r\n              })\r\n              .entries(this.matchingRows)\r\n              .forEach(function (x) {\r\n                oo.push(x.value);\r\n              });\r\n            this.rows = Array.from(oo);\r\n            break;\r\n\r\n          case \"min\":\r\n            this.rows = d3\r\n              .nest()\r\n              .key(groupedLabelFunc)\r\n              .rollup(function (d) {\r\n                var dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n                dd[valueCol] = d3.min(d, function (d) {\r\n                  return d[valueCol];\r\n                });\r\n                return dd;\r\n              })\r\n              .entries(this.matchingRows)\r\n              .forEach(function (x) {\r\n                oo.push(x.value);\r\n              });\r\n            this.rows = Array.from(oo);\r\n            break;\r\n        }\r\n      } else {\r\n        this.rows = this.matchingRows;\r\n      }\r\n\r\n      var groupNameOffset = this.panel.ShowGroupLabels\r\n        ? Number(this.panel.GroupLabelFontSize.replace(\"%\", \"\")) * 0.15\r\n        : 0;\r\n\r\n      if (groupCol >= 0) {\r\n        this.groupedRows = d3\r\n          .nest()\r\n          .key(function (d) {\r\n            return d[groupCol];\r\n          })\r\n          .entries(this.rows);\r\n\r\n        if (this.panel.GroupNameFilter.length > 0) {\r\n          var regexGroupRows = new RegExp(this.panel.GroupNameFilter, \"\");\r\n          let matchingGroups = [];\r\n          for (let i = 0; i < this.groupedRows.length; i++) {\r\n            let groupName = this.groupedRows[i].key;\r\n            if (groupName.match(regexGroupRows) != null)\r\n              matchingGroups.push(this.groupedRows[i]);\r\n          }\r\n\r\n          if (matchingGroups.length > 0) this.groupedRows = matchingGroups;\r\n          else {\r\n            this.displayStatusMessage(\r\n              \"No groups.  Group Regex filter '\" +\r\n                this.panel.GroupNameFilter +\r\n                \"' eliminated all \" +\r\n                this.groupedRows.length +\r\n                \" groups from current query\"\r\n            );\r\n            return;\r\n          }\r\n        }\r\n\r\n        let groupSortString = this.panel.GroupSortString;\r\n\r\n        this.groupedRows.sort(function (a, b) {\r\n          var aPos = groupSortString.search(a.key);\r\n          var bPos = groupSortString.search(b.key);\r\n\r\n          if (aPos == bPos) return a.key.localeCompare(b.key);\r\n          else if (aPos == -1) return 1;\r\n          else if (bPos == -1) return -1;\r\n          else return aPos - bPos;\r\n        });\r\n      } else {\r\n        this.groupedRows = null;\r\n      }\r\n\r\n      this.elem.html(\r\n        \"<svg class='\" +\r\n          this.className +\r\n          \"'  style='height:100%; width:100%'></svg>\"\r\n      );\r\n      var $container = this.elem.find(\".\" + this.className);\r\n\r\n      var h = $container.height();\r\n      var w = $container.width() - 15;\r\n      this.buildDateHtml(dateTimeCol);\r\n\r\n      var horizontal = this.panel.Horizontal;\r\n\r\n      var labelMargin =\r\n        $.isNumeric(this.panel.LabelMargin) && this.panel.LabelMargin >= 0\r\n          ? this.panel.LabelMargin\r\n          : null;\r\n      var lowSideMargin =\r\n        this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\r\n      var highSideMargin =\r\n        this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\r\n\r\n      this.svg = d3.select(\".\" + this.className).append(\"svg\");\r\n      this.svg\r\n        .selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\")\r\n        .interrupt();\r\n      this.svg\r\n        .selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\")\r\n        .interrupt();\r\n\r\n      var id = this.panel.id;\r\n      var barPadding = this.panel.BarPadding;\r\n      var baseLineValue = this.panel.BaseLineValue;\r\n      var minLineValue = this.panel.MinLineValue;\r\n      var maxLineValue = this.panel.MaxLineValue;\r\n      var highBarColor = this.panel.HighBarColor;\r\n      var lowBarColor = this.panel.LowBarColor;\r\n      var highLimitValue = this.panel.HighLimitValue;\r\n      var HighLimitBarColor = this.panel.HighLimitBarColor;\r\n      var HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\r\n      var HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\r\n      var recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n      var Links = this.panel.Links;\r\n      var lowLimitValue = this.panel.LowLimitValue;\r\n      var LowLimitBarColor = this.panel.LowLimitBarColor;\r\n      var LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\r\n      var LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\r\n      var RecolorRules = this.panel.RecolorRules;\r\n      var recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n      var flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n      var flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n      var showTooltips = this.panel.ShowTooltips;\r\n      var DateTimeColName = this.panel.DateTimeColName;\r\n      var TooltipDateFormat = this.panel.TooltipDateFormat;\r\n      var ValueColName = this.panel.ValueColName;\r\n      var ValueDecimals = this.panel.ValueDecimals;\r\n      var OddRowColor = this.panel.OddRowColor;\r\n      var EvenRowColor = this.panel.EvenRowColor;\r\n      var OutlineColor = this.panel.OutlineColor;\r\n      var TZOffsetHours = this.panel.TZOffsetHours;\r\n      var GroupCols = this.panel.GroupCols;\r\n      var GroupGap = this.panel.GroupGap;\r\n      var ScaleFactor = Number(this.panel.ScaleFactor);\r\n      var LabelColor = this.panel.LabelColor;\r\n      var ValuePosition = this.panel.ValuePosition;\r\n\r\n      var panelID = \"michaeldmoore-multistat-panel-\" + id;\r\n      var tooltipDivID = \"michaeldmoore-multistat-panel-tooltip-\" + id;\r\n\r\n      var minValue = d3.min(this.rows, function (d) {\r\n        return Number(d[valueCol]) * ScaleFactor;\r\n      });\r\n      if ($.isNumeric(minLineValue) == false) minLineValue = minValue;\r\n\r\n      var maxValue = d3.max(this.rows, function (d) {\r\n        return Number(d[valueCol]) * ScaleFactor;\r\n      });\r\n      if ($.isNumeric(maxLineValue) == false) maxLineValue = maxValue;\r\n\r\n      if ($.isNumeric(baseLineValue) == false) baseLineValue = 0;\r\n\r\n      if (minLineValue > baseLineValue) minLineValue = baseLineValue;\r\n\r\n      if ($.isNumeric(lowLimitValue) && minLineValue > lowLimitValue)\r\n        minLineValue = lowLimitValue;\r\n\r\n      if (maxLineValue < baseLineValue) maxLineValue = baseLineValue;\r\n\r\n      if ($.isNumeric(highLimitValue) && maxLineValue < highLimitValue)\r\n        maxLineValue = highLimitValue;\r\n\r\n      $(\"#\" + tooltipDivID).remove();\r\n\r\n      var sortData = function (data, sortDirection) {\r\n        if (sortDirection != \"none\") {\r\n          var ascending = sortDirection == \"ascending\";\r\n          data.sort(function (x, y) {\r\n            let xx = x[sortCol];\r\n            let yy = y[sortCol];\r\n\r\n            if ($.isNumeric(xx) && $.isNumeric(yy))\r\n              return ascending ? xx - yy : yy - xx;\r\n            else return ascending ? xx.localeCompare(yy) : yy.localeCompare(xx);\r\n          });\r\n        }\r\n      };\r\n\r\n      var translateValues = function (s, d) {\r\n        // lookup column index corresponding to the substitution tokens and replace with this bar's value\r\n        let s1 = s;\r\n        const re = /\\{[^}]+\\}/g;\r\n        let g = re.exec(s);\r\n        while (g) {\r\n          for (var i = 0; i < cols.length; i++) {\r\n            if (g == \"{\" + cols[i] + \"}\") {\r\n              s1 = s1.replace(g, d[i]);\r\n              break;\r\n            }\r\n          }\r\n          g = re.exec(s);\r\n        }\r\n        return s1;\r\n      };\r\n\r\n      var getTooltipContent = function (d) {\r\n        let html = \"\";\r\n        if (showTooltips) {\r\n          html += \"<table>\";\r\n          if (labelCol != -1)\r\n            html +=\r\n              \"<thead><tr class='michaeldmoore-multistat-panel-tooltip-title'><th colspan='2' align='center'>\" +\r\n              d[labelCol] +\r\n              \"</th></tr></thead>\";\r\n          html += \"<tbody>\";\r\n          for (var i = 0; i < d.length; i++) {\r\n            if (i != labelCol) {\r\n              var cc = cols[i];\r\n              var dd = d[i];\r\n\r\n              if (cc == DateTimeColName)\r\n                dd = moment(dd)\r\n                  .add(TZOffsetHours, \"h\")\r\n                  .format(TooltipDateFormat);\r\n              else if (cc == ValueColName && $.isNumeric(dd))\r\n                dd = Number(dd).toFixed(ValueDecimals);\r\n\r\n              html += \"<tr><td>\" + cc + \"</td><td>\" + dd + \"</td></tr>\";\r\n            }\r\n          }\r\n          html += \"</tbody></table>\";\r\n        }\r\n\r\n        if (Links.length) {\r\n          html += \"<table><tbody>\";\r\n          Links.forEach((l) => {\r\n            html +=\r\n              \"<tr><td align='right'><i class='fa fa-link'></i></td><td><a href='\" +\r\n              translateValues(l.url, d) +\r\n              (l.newtab ? \"' target='_blank'\" : \"'\") +\r\n              \">\" +\r\n              translateValues(l.name, d) +\r\n              \"</a></td></tr>\";\r\n          });\r\n          html += \"</tbody></table>\";\r\n        }\r\n        return html;\r\n      };\r\n\r\n      var isInTooltip = false;\r\n      var $panel;\r\n      var $panelContent;\r\n      var panelContent;\r\n      var tooltipShow = function (d) {\r\n        if (showTooltips || Links.length) {\r\n          if ($(\"#\" + tooltipDivID).length == 0) {\r\n            $panel = $(\".\" + panelID);\r\n            $panelContent = $panel.parent().parent().parent().parent();\r\n            panelContent = d3.selectAll($panelContent);\r\n            panelContent\r\n              .append(\"div\")\r\n              .attr(\"id\", tooltipDivID)\r\n              .style(\"opacity\", 0);\r\n          }\r\n\r\n          const tooltipDiv = d3.selectAll(\"#\" + tooltipDivID);\r\n          tooltipDiv\r\n            .classed(\"michaeldmoore-multistat-panel-tooltip\", true)\r\n            .html(getTooltipContent(d))\r\n            .on(\"mouseover\", function () {\r\n              if (!isInTooltip) {\r\n                isInTooltip = true;\r\n                tooltipHide(true);\r\n              }\r\n            })\r\n            .on(\"mouseleave\", function () {\r\n              isInTooltip = false;\r\n              tooltipHide(false);\r\n            });\r\n\r\n          const $tooltipDiv = $(\"#\" + tooltipDivID);\r\n          const tooltipWidth = $tooltipDiv.width();\r\n          const tooltipHeight = $tooltipDiv.height();\r\n          const minTop = 28;\r\n\r\n          const mouseCoordinates = d3.mouse(panelContent.node());\r\n          let Left = mouseCoordinates[0] - tooltipWidth / 2;\r\n          let Top = mouseCoordinates[1] + minTop - tooltipHeight / 2;\r\n\r\n          let panelWidth = $panel.width();\r\n          let panelHeight = $panel.height();\r\n\r\n          if (Left < 0) Left = 0;\r\n          else if (Left > panelWidth - tooltipWidth)\r\n            Left = panelWidth - tooltipWidth;\r\n\r\n          if (Top < 0) Top = 0;\r\n          else if (Top > panelHeight + minTop - tooltipHeight)\r\n            Top = panelHeight + minTop - tooltipHeight;\r\n\r\n          tooltipDiv\r\n            .transition()\r\n            .duration(200)\r\n            .style(\"opacity\", 1.0)\r\n            .style(\"left\", Left + \"px\")\r\n            .style(\"top\", Top + \"px\");\r\n        }\r\n      };\r\n\r\n      var tooltipHide = function (cancel) {\r\n        const tooltipDiv = d3.selectAll(\"#\" + tooltipDivID);\r\n\r\n        if (cancel) {\r\n          //console.log(\"cancelling tooltip hide\");\r\n          tooltipDiv.transition().style(\"opacity\", 1.0);\r\n        } else {\r\n          tooltipDiv\r\n            .transition()\r\n            .duration(2000)\r\n            .style(\"opacity\", 0)\r\n            .on(\"end\", function () {\r\n              d3.select(this)\r\n                .html(\"\")\r\n                .classed(\"michaeldmoore-multistat-panel-tooltip\", false);\r\n            });\r\n        }\r\n      };\r\n\r\n      var scaleAndClipValue = function (d) {\r\n        var val = d * ScaleFactor;\r\n        if (val > maxLineValue) val = maxLineValue;\r\n        if (val < minLineValue) val = minLineValue;\r\n\r\n        return val;\r\n      };\r\n\r\n      var getBarColor = function (d) {\r\n        if (recolorCol != -1) {\r\n          let recolorString = d[recolorCol];\r\n\r\n          if (RecolorRules.length) {\r\n            if (recolorString) {\r\n              let recolorRule = RecolorRules.find((r) => {\r\n                if (r.pattern) {\r\n                  switch (r.matchType) {\r\n                    case \"reg-ex\":\r\n                      let re = RegExp(r.pattern);\r\n                      return re.test(recolorString);\r\n\r\n                    case \"list\":\r\n                      return r.pattern.indexOf(recolorString) != -1;\r\n\r\n                    case \"subset\":\r\n                      return recolorString.indexOf(r.pattern) != -1;\r\n\r\n                    default:\r\n                      return r.pattern === recolorString;\r\n                  }\r\n                }\r\n                return false;\r\n              });\r\n\r\n              if (recolorRule) return recolorRule.color;\r\n            }\r\n          }\r\n\r\n          // no matching rule found, check if recolorString is a valid color\r\n          const s = new Option().style;\r\n          s.color = recolorString;\r\n          if (s.color !== \"\") return recolorString;\r\n        }\r\n\r\n        let value = d[valueCol] * ScaleFactor;\r\n        if (recolorHighLimitBar && value > highLimitValue)\r\n          return HighLimitBarColor;\r\n        if (recolorLowLimitBar && value < lowLimitValue)\r\n          return LowLimitBarColor;\r\n        return value > baseLineValue ? highBarColor : lowBarColor;\r\n      };\r\n\r\n      if (horizontal) {\r\n        var plotGroupHorizontal = function (\r\n          panel,\r\n          svg,\r\n          data,\r\n          numRows,\r\n          groupName,\r\n          groupNameOffset,\r\n          left,\r\n          w,\r\n          hh,\r\n          dh\r\n        ) {\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"yellow\");*/\r\n\r\n          sortData(data, panel.SortDirection);\r\n\r\n          // Add Above-High Side Group Names\r\n          if (groupName != \"\" && panel.ShowGroupLabels) {\r\n            svg\r\n              .append(\"text\")\r\n              .text(groupName)\r\n              .attr(\"x\", left + (labelMargin + w) / 2)\r\n              .attr(\"y\", hh + groupNameOffset / 2)\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.GroupLabelFontSize)\r\n              .attr(\"fill\", panel.GroupLabelColor)\r\n              .attr(\"background\", \"blue\")\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\");\r\n          }\r\n\r\n          hh += groupNameOffset;\r\n          dh -= groupNameOffset;\r\n\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"#ffffff\");*/\r\n\r\n          var labels = data.map(function (d) {\r\n            return d[labelCol];\r\n          });\r\n          while (labels.length < numRows)\r\n            labels = labels.concat(\r\n              \"_\" + Math.random().toString(36).substr(2, 9)\r\n            );\r\n\r\n          var labelScale = d3\r\n            .scaleBand()\r\n            .domain(labels)\r\n            .rangeRound([hh + highSideMargin, hh + dh - lowSideMargin])\r\n            .paddingInner(barPadding / 100)\r\n            .paddingOuter(barPadding / 200);\r\n\r\n          var stripedata = data.concat(d3.range(data.length, numRows));\r\n\r\n          var stripeScale = d3\r\n            .scaleBand()\r\n            .domain(stripedata)\r\n            .rangeRound([hh + highSideMargin, hh + dh - lowSideMargin]);\r\n\r\n          // Draw background of alternating stripes\r\n          var oddeven = false;\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n            .attr(\"width\", w)\r\n            .attr(\"height\", stripeScale.step())\r\n            .attr(\"x\", left)\r\n            .attr(\"y\", function (d) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"fill\", function (d) {\r\n              oddeven = !oddeven;\r\n              return oddeven ? OddRowColor : EvenRowColor;\r\n            });\r\n\r\n          var g1 = svg\r\n            .append(\"g\")\r\n            .selectAll(\"text\")\r\n            .data(data)\r\n            .enter()\r\n            .append(\"g\");\r\n\r\n          if (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n            var maxValueWidth = 0;\r\n            g1.append(\"text\")\r\n              .text(function (d) {\r\n                return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                  ValueDecimals\r\n                );\r\n              })\r\n              .attr(\"x\", left + w)\r\n              .attr(\"y\", function (d, i) {\r\n                return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.ValueFontSize)\r\n              .attr(\"fill\", panel.ValueColor)\r\n              .attr(\"text-anchor\", \"end\")\r\n              .attr(\"dominant-baseline\", \"central\")\r\n              .each(function (d, i) {\r\n                var thisWidth = this.getComputedTextLength();\r\n                maxValueWidth = d3.max([maxValueWidth, thisWidth]);\r\n              });\r\n            w -= maxValueWidth;\r\n          }\r\n\r\n          if (panel.ShowLabels) {\r\n            var maxLabelWidth = 0;\r\n            var labelAngle = Number(panel.LableAngle);\r\n            g1.append(\"text\")\r\n              .text(function (d) {\r\n                return d[labelCol];\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.LabelFontSize)\r\n              .attr(\"fill\", function (d, i) {\r\n                let value = d[valueCol] * ScaleFactor;\r\n                return value > maxLineValue || value < minLineValue\r\n                  ? panel.OutOfRangeLabelColor\r\n                  : panel.LabelColor;\r\n              })\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\")\r\n              .attr(\"transform\", function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var y = labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n                var x = left + a / 2;\r\n                return (\r\n                  \"translate(\" + x + \",\" + y + \") rotate(\" + labelAngle + \")\"\r\n                );\r\n              })\r\n              .each(function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var thisWidth = a;\r\n                maxLabelWidth = d3.max([maxLabelWidth, thisWidth]);\r\n              });\r\n\r\n            if ($.isNumeric(labelMargin)) {\r\n              left += labelMargin;\r\n              w -= labelMargin;\r\n            } else {\r\n              left += maxLabelWidth;\r\n              w -= maxLabelWidth;\r\n            }\r\n          }\r\n\r\n          var valueScale = d3\r\n            .scaleLinear()\r\n            .domain([minLineValue, maxLineValue])\r\n            .range([left + labelMargin, left + w])\r\n            .nice();\r\n\r\n          function vLine(svg, value, color, strokeWidth) {\r\n            svg\r\n              .append(\"line\")\r\n              .style(\"stroke\", color)\r\n              .attr(\"stroke-width\", strokeWidth == null ? 1 : strokeWidth)\r\n              .attr(\"y1\", hh + highSideMargin)\r\n              .attr(\"x1\", valueScale(value))\r\n              .attr(\"y2\", hh + dh - lowSideMargin)\r\n              .attr(\"x2\", valueScale(value));\r\n          }\r\n\r\n          if (panel.ShowBaseLine)\r\n            vLine(svg, baseLineValue, panel.BaseLineColor, panel.BaseLineWidth);\r\n\r\n          if (panel.ShowMaxLine)\r\n            vLine(svg, maxLineValue, panel.MaxLineColor, panel.MaxLineWidth);\r\n\r\n          if (panel.ShowMinLine)\r\n            vLine(svg, minLineValue, panel.MinLineColor, panel.MinLineWidth);\r\n\r\n          if (panel.ShowHighLimitLine)\r\n            vLine(\r\n              svg,\r\n              highLimitValue,\r\n              panel.HighLimitLineColor,\r\n              panel.HighLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowLowLimitLine)\r\n            vLine(\r\n              svg,\r\n              lowLimitValue,\r\n              panel.LowLimitLineColor,\r\n              panel.LowLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowBars) {\r\n            g1.append(\"rect\")\r\n              .attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n              .attr(\"width\", function (d) {\r\n                var val = scaleAndClipValue(d[valueCol]);\r\n                return Math.abs(valueScale(val) - valueScale(baseLineValue));\r\n              })\r\n              .attr(\"height\", labelScale.bandwidth())\r\n              .attr(\"x\", function (d) {\r\n                var val = scaleAndClipValue(d[valueCol]);\r\n                return d3.min([valueScale(val), valueScale(baseLineValue)]);\r\n              })\r\n              .attr(\"y\", function (d, i) {\r\n                return labelScale(d[labelCol]);\r\n              })\r\n              .attr(\"fill\", function (d) {\r\n                return getBarColor(d);\r\n              })\r\n              .classed(\"highflash\", function (d) {\r\n                return (\r\n                  recolorHighLimitBar &&\r\n                  flashHighLimitBar &&\r\n                  d[valueCol] * ScaleFactor > highLimitValue\r\n                );\r\n              })\r\n              .classed(\"lowflash\", function (d) {\r\n                return (\r\n                  recolorLowLimitBar &&\r\n                  flashLowLimitBar &&\r\n                  d[valueCol] * ScaleFactor < lowLimitValue\r\n                );\r\n              });\r\n          }\r\n\r\n          if (panel.ShowLines) {\r\n            if (panel.LineWidth) {\r\n              var points = [];\r\n              var bw = labelScale.step();\r\n              for (var i = 0; i < data.length; i++) {\r\n                var d = data[i];\r\n                var y = hh + highSideMargin + (i + 0.5) * bw;\r\n                var x = valueScale(d[valueCol]);\r\n                points.push({\r\n                  x,\r\n                  y,\r\n                });\r\n              }\r\n\r\n              var curveFunc = d3.curveLinear;\r\n              switch (panel.CurveType) {\r\n                case \"Linear\":\r\n                  curveFunc = d3.curveLinear;\r\n                  break;\r\n                case \"Monotone\":\r\n                  curveFunc = d3.curveMonotoneY;\r\n                  break;\r\n                case \"Cardinal\":\r\n                  curveFunc = d3.curveCardinal;\r\n                  break;\r\n                case \"Catmull-Rom\":\r\n                  curveFunc = d3.curveCatmullRom;\r\n                  break;\r\n              }\r\n\r\n              var lineFunction = d3\r\n                .line()\r\n                .curve(curveFunc)\r\n                .x(function (d) {\r\n                  return d.x;\r\n                })\r\n                .y(function (d) {\r\n                  return d.y;\r\n                });\r\n\r\n              var lineGraph = svg\r\n                .append(\"path\")\r\n                .attr(\"d\", lineFunction(points))\r\n                .attr(\"stroke\", panel.LineColor)\r\n                .attr(\"stroke-width\", panel.LineWidth)\r\n                .attr(\"fill\", \"none\");\r\n            }\r\n\r\n            if (panel.DotSize) {\r\n              g1.append(\"circle\")\r\n                .attr(\"r\", panel.DotSize / 2.0)\r\n                .attr(\"fill\", panel.DotColor)\r\n                .attr(\"cy\", function (d) {\r\n                  return (\r\n                    labelScale(d[labelCol]) +\r\n                    (bw * (1.0 - barPadding / 100.0)) / 2.0\r\n                  );\r\n                })\r\n                .attr(\"cx\", function (d) {\r\n                  return valueScale(d[valueCol]);\r\n                });\r\n            }\r\n          }\r\n\r\n          if (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n            g1.append(\"text\")\r\n              .text(function (d) {\r\n                return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                  ValueDecimals\r\n                );\r\n              })\r\n              .attr(\"x\", function (d) {\r\n                if (panel.ValuePosition == \"bar base\")\r\n                  return valueScale(baseLineValue);\r\n                else {\r\n                  var val = scaleAndClipValue(d[valueCol]);\r\n                  return valueScale(val) + (val > baseLineValue);\r\n                }\r\n              })\r\n              .attr(\"y\", function (d, i) {\r\n                return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.ValueFontSize)\r\n              .attr(\"fill\", panel.ValueColor)\r\n              .attr(\"text-anchor\", function (d) {\r\n                if (panel.ValuePosition == \"bar base\")\r\n                  return d[valueCol] * ScaleFactor > baseLineValue\r\n                    ? \"start\"\r\n                    : \"end\";\r\n                else\r\n                  return d[valueCol] * ScaleFactor > baseLineValue\r\n                    ? \"end\"\r\n                    : \"start\";\r\n              })\r\n              .attr(\"dominant-baseline\", \"central\");\r\n          }\r\n\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"width\", w)\r\n            .attr(\"height\", stripeScale.step())\r\n            .attr(\"x\", left)\r\n            .attr(\"y\", function (d) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"fill\", \"rgba(0,0,0,0)\")\r\n            .attr(\"stroke\", OutlineColor)\r\n            .on(\"mouseover\", function (d) {\r\n              if (showTooltips || Links.length /* && i < data.length*/)\r\n                tooltipShow(d);\r\n            })\r\n            .on(\"mouseleave\", function () {\r\n              if (!isInTooltip) {\r\n                tooltipHide(false);\r\n              }\r\n            });\r\n\r\n          // Add High Side Value Axis (X)\r\n          if (highSideMargin > 0) {\r\n            var ggHighSide = svg\r\n              .append(\"g\")\r\n              .attr(\"transform\", \"translate(1,\" + (hh + highSideMargin) + \")\")\r\n              .attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n              .call(d3.axisTop(valueScale));\r\n            ggHighSide\r\n              .selectAll(\".tick text\")\r\n              .attr(\"fill\", panel.HighAxisColor);\r\n            ggHighSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n            ggHighSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n          }\r\n\r\n          // Add Low Side Value Axis (X)\r\n          if (lowSideMargin > 0) {\r\n            var ggLowSide = svg\r\n              .append(\"g\")\r\n              .attr(\r\n                \"transform\",\r\n                \"translate(0,\" + (hh + dh - lowSideMargin) + \")\"\r\n              )\r\n              .attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n              .call(d3.axisBottom(valueScale));\r\n            ggLowSide.selectAll(\".tick text\").attr(\"fill\", panel.LowAxisColor);\r\n            ggLowSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n            ggLowSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n          }\r\n        };\r\n\r\n        if (this.groupedRows != null) {\r\n          var gcols =\r\n            GroupCols <= 0 || GroupCols > this.groupedRows.length\r\n              ? this.groupedRows.length\r\n              : GroupCols;\r\n          var dw = (w + GroupGap) / gcols;\r\n\r\n          // Figure out the max data points in each row of groups...\r\n          var pointsPerRow = [];\r\n          for (let i = 0; i < this.groupedRows.length / gcols; i++)\r\n            pointsPerRow.push(0);\r\n          for (let i = 0; i < this.groupedRows.length; i++) {\r\n            let rr = Math.floor(i / gcols);\r\n            let u = this.groupedRows[i].values.length;\r\n            if (pointsPerRow[rr] < u) pointsPerRow[rr] = u;\r\n          }\r\n\r\n          var totalPoints = 0;\r\n          for (let i = 0; i < pointsPerRow.length; i++)\r\n            totalPoints += pointsPerRow[i];\r\n\r\n          var rowOverheadHeight =\r\n            groupNameOffset +\r\n            this.panel.LowSideMargin +\r\n            this.panel.HighSideMargin;\r\n          var rowHeight =\r\n            (h - pointsPerRow.length * rowOverheadHeight) / totalPoints;\r\n\r\n          var numRows = Math.ceil(this.groupedRows.length / gcols);\r\n          var hh = 0;\r\n          for (var rr = 0; rr < numRows; rr++) {\r\n            var nn = pointsPerRow[rr];\r\n            var dh = rowOverheadHeight + nn * rowHeight;\r\n            hh += dh;\r\n            for (var cc = 0; cc < gcols; cc++) {\r\n              var ii = cc + rr * gcols;\r\n              if (ii < this.groupedRows.length) {\r\n                plotGroupHorizontal(\r\n                  this.panel,\r\n                  this.svg,\r\n                  this.groupedRows[ii].values,\r\n                  nn,\r\n                  this.groupedRows[ii].key,\r\n                  groupNameOffset,\r\n                  cc * dw,\r\n                  dw - GroupGap,\r\n                  hh - dh,\r\n                  dh\r\n                );\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          plotGroupHorizontal(\r\n            this.panel,\r\n            this.svg,\r\n            this.rows,\r\n            this.rows.length,\r\n            \"\",\r\n            0,\r\n            0,\r\n            w,\r\n            0,\r\n            h\r\n          );\r\n        }\r\n      } else {\r\n        var plotGroupVertical = function (\r\n          panel,\r\n          svg,\r\n          data,\r\n          numRows,\r\n          groupName,\r\n          groupNameOffset,\r\n          left,\r\n          w,\r\n          hh,\r\n          dh\r\n        ) {\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n\t\t\t.attr(\"width\", w)\r\n\t\t\t.attr(\"height\", dh)\r\n\t\t\t.attr(\"x\", left)\r\n\t\t\t.attr(\"y\", hh)\r\n\t\t\t.attr(\"stroke\", \"yellow\");*/\r\n\r\n          sortData(data, panel.SortDirection);\r\n\r\n          // Add Above-High Side Group Names\r\n          if (groupName != \"\" && panel.ShowGroupLabels) {\r\n            svg\r\n              .append(\"text\")\r\n              .text(groupName)\r\n              .attr(\"x\", left + (labelMargin + w) / 2)\r\n              .attr(\"y\", hh + groupNameOffset / 2)\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.GroupLabelFontSize)\r\n              .attr(\"fill\", panel.GroupLabelColor)\r\n              .attr(\"background\", \"blue\")\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\");\r\n          }\r\n\r\n          hh += groupNameOffset;\r\n          dh -= groupNameOffset;\r\n\r\n          // Draw border rectangle\r\n          /*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"#ffffff\");*/\r\n\r\n          var labels = data.map(function (d) {\r\n            return d[labelCol];\r\n          });\r\n          while (labels.length < numRows)\r\n            labels = labels.concat(\r\n              \"_\" + Math.random().toString(36).substr(2, 9)\r\n            );\r\n\r\n          var labelScale = d3\r\n            .scaleBand()\r\n            .domain(labels)\r\n            .range([left + lowSideMargin, left + w - highSideMargin])\r\n            .paddingInner(barPadding / 100)\r\n            .paddingOuter(barPadding / 200);\r\n\r\n          var stripedata = data.concat(d3.range(data.length, numRows));\r\n\r\n          var stripeScale = d3\r\n            .scaleBand()\r\n            .domain(stripedata)\r\n            .range([left + lowSideMargin, left + w - highSideMargin]);\r\n\r\n          // Draw background of alternating stripes\r\n          var oddeven = false;\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n            .attr(\"width\", stripeScale.step())\r\n            .attr(\"height\", dh)\r\n            .attr(\"x\", function (d, i) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"y\", hh)\r\n            .attr(\"fill\", function (d) {\r\n              oddeven = !oddeven;\r\n              return oddeven ? OddRowColor : EvenRowColor;\r\n            });\r\n\r\n          var g2 = svg\r\n            .append(\"g\")\r\n            .selectAll(\"text\")\r\n            .data(data)\r\n            .enter()\r\n            .append(\"g\");\r\n\r\n          if (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n            var maxValueHeight = 0;\r\n            g2.append(\"text\")\r\n              .text(function (d) {\r\n                return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                  ValueDecimals\r\n                );\r\n              })\r\n              .attr(\"x\", function (d, i) {\r\n                return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n              })\r\n              .attr(\"y\", hh)\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.ValueFontSize)\r\n              .attr(\"fill\", panel.ValueColor)\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"text-before-edge\")\r\n              .each(function (d, i) {\r\n                var thisHeight = this.getBBox().height;\r\n                maxValueHeight = d3.max([maxValueHeight, thisHeight]);\r\n              });\r\n            hh += maxValueHeight;\r\n            dh -= maxValueHeight;\r\n          }\r\n\r\n          if (panel.ShowLabels) {\r\n            var maxLabelHeight = 0;\r\n            var labelAngle = Number(panel.LableAngle);\r\n            g2.append(\"text\")\r\n              .text(function (d) {\r\n                return d[labelCol];\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.LabelFontSize)\r\n              .attr(\"fill\", function (d, i) {\r\n                return d[valueCol] * ScaleFactor > maxLineValue ||\r\n                  d[valueCol] * ScaleFactor < minLineValue\r\n                  ? panel.OutOfRangeLabelColor\r\n                  : LabelColor;\r\n              })\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", \"central\")\r\n              .attr(\"transform\", function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var x = labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n                var y = hh + dh - b / 2;\r\n                return (\r\n                  \"translate(\" + x + \",\" + y + \") rotate(\" + labelAngle + \")\"\r\n                );\r\n              })\r\n              .each(function (d, i) {\r\n                var bbox = this.getBBox();\r\n                var s = Math.sin((labelAngle * Math.PI) / 180);\r\n                var c = Math.cos((labelAngle * Math.PI) / 180);\r\n                var b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n                var a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n                var thisHeight = b;\r\n                maxLabelHeight = d3.max([maxLabelHeight, thisHeight]);\r\n              });\r\n            if ($.isNumeric(labelMargin)) {\r\n              dh -= labelMargin;\r\n            } else {\r\n              dh -= maxLabelHeight;\r\n            }\r\n          }\r\n\r\n          var valueScale = d3\r\n            .scaleLinear()\r\n            .domain([maxLineValue, minLineValue])\r\n            .range([hh, hh + dh])\r\n            .nice();\r\n\r\n          function hLine(svg, value, color, strokeWidth) {\r\n            svg\r\n              .append(\"line\")\r\n              .style(\"stroke\", color)\r\n              .attr(\"stroke-width\", strokeWidth == null ? 1 : strokeWidth)\r\n              .attr(\"x1\", left + lowSideMargin)\r\n              .attr(\"y1\", valueScale(value))\r\n              .attr(\"x2\", left + w - highSideMargin)\r\n              .attr(\"y2\", valueScale(value));\r\n          }\r\n\r\n          if (panel.ShowBaseLine)\r\n            hLine(svg, baseLineValue, panel.BaseLineColor, panel.BaseLineWidth);\r\n\r\n          if (panel.ShowMaxLine)\r\n            hLine(svg, maxLineValue, panel.MaxLineColor, panel.MaxLineWidth);\r\n\r\n          if (panel.ShowMinLine)\r\n            hLine(svg, minLineValue, panel.MinLineColor, panel.MinLineWidth);\r\n\r\n          if (panel.ShowHighLimitLine)\r\n            hLine(\r\n              svg,\r\n              highLimitValue,\r\n              panel.HighLimitLineColor,\r\n              panel.HighLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowLowLimitLine)\r\n            hLine(\r\n              svg,\r\n              lowLimitValue,\r\n              panel.LowLimitLineColor,\r\n              panel.LowLimitLineWidth\r\n            );\r\n\r\n          if (panel.ShowBars) {\r\n            g2.append(\"rect\")\r\n              .attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n              .attr(\"height\", function (d) {\r\n                var val = scaleAndClipValue(d[valueCol]);\r\n                return Math.abs(valueScale(baseLineValue) - valueScale(val));\r\n              })\r\n              .attr(\"width\", labelScale.bandwidth())\r\n              .attr(\"y\", function (d) {\r\n                var val = scaleAndClipValue(d[valueCol]);\r\n                return d3.min([valueScale(val), valueScale(baseLineValue)]);\r\n              })\r\n              .attr(\"x\", function (d, i) {\r\n                return labelScale(d[labelCol]);\r\n              })\r\n              .attr(\"fill\", function (d) {\r\n                return getBarColor(d);\r\n              })\r\n              .classed(\"highflash\", function (d) {\r\n                return (\r\n                  recolorHighLimitBar &&\r\n                  flashHighLimitBar &&\r\n                  d[valueCol] * ScaleFactor > highLimitValue\r\n                );\r\n              })\r\n              .classed(\"lowflash\", function (d) {\r\n                return (\r\n                  recolorLowLimitBar &&\r\n                  flashLowLimitBar &&\r\n                  d[valueCol] * ScaleFactor < lowLimitValue\r\n                );\r\n              });\r\n          }\r\n\r\n          if (panel.ShowLines) {\r\n            if (panel.LineWidth) {\r\n              var points = [];\r\n              var bw = labelScale.step();\r\n              for (var i = 0; i < data.length; i++) {\r\n                var d = data[i];\r\n                var x = left + lowSideMargin + (i + 0.5) * bw;\r\n                var y = valueScale(d[valueCol]);\r\n                points.push({\r\n                  x,\r\n                  y,\r\n                });\r\n              }\r\n\r\n              var curveFunc = d3.curveLinear;\r\n              switch (panel.CurveType) {\r\n                case \"Linear\":\r\n                  curveFunc = d3.curveLinear;\r\n                  break;\r\n                case \"Monotone\":\r\n                  curveFunc = d3.curveMonotoneX;\r\n                  break;\r\n                case \"Cardinal\":\r\n                  curveFunc = d3.curveCardinal;\r\n                  break;\r\n                case \"Catmull-Rom\":\r\n                  curveFunc = d3.curveCatmullRom;\r\n                  break;\r\n              }\r\n\r\n              var lineFunction = d3\r\n                .line()\r\n                .curve(curveFunc)\r\n                .x(function (d) {\r\n                  return d.x;\r\n                })\r\n                .y(function (d) {\r\n                  return d.y;\r\n                });\r\n\r\n              var lineGraph = svg\r\n                .append(\"path\")\r\n                .attr(\"d\", lineFunction(points))\r\n                .attr(\"stroke\", panel.LineColor)\r\n                .attr(\"stroke-width\", panel.LineWidth)\r\n                .attr(\"fill\", \"none\");\r\n            }\r\n\r\n            if (panel.DotSize) {\r\n              g2.append(\"circle\")\r\n                .attr(\"r\", panel.DotSize / 2.0)\r\n                .attr(\"fill\", panel.DotColor)\r\n                .attr(\"cx\", function (d) {\r\n                  return (\r\n                    labelScale(d[labelCol]) +\r\n                    (bw * (1.0 - barPadding / 100.0)) / 2.0\r\n                  );\r\n                })\r\n                .attr(\"cy\", function (d) {\r\n                  return valueScale(d[valueCol]);\r\n                });\r\n            }\r\n          }\r\n\r\n          if (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n            g2.append(\"text\")\r\n              .text(function (d) {\r\n                return (Number(d[valueCol]) * ScaleFactor).toFixed(\r\n                  ValueDecimals\r\n                );\r\n              })\r\n              .attr(\"x\", function (d, i) {\r\n                return labelScale(d[labelCol]) + labelScale.bandwidth() / 2;\r\n              })\r\n              .attr(\"y\", function (d) {\r\n                if (ValuePosition == \"bar base\")\r\n                  return valueScale(baseLineValue);\r\n                else {\r\n                  var val = scaleAndClipValue(d[valueCol]);\r\n                  return valueScale(val);\r\n                }\r\n              })\r\n              .attr(\"font-family\", \"sans-serif\")\r\n              .attr(\"font-size\", panel.ValueFontSize)\r\n              .attr(\"fill\", panel.ValueColor)\r\n              .attr(\"text-anchor\", \"middle\")\r\n              .attr(\"dominant-baseline\", function (d) {\r\n                if (ValuePosition == \"bar base\")\r\n                  return d[valueCol] * ScaleFactor > baseLineValue\r\n                    ? \"text-after-edge\"\r\n                    : \"text-before-edge\";\r\n                else\r\n                  return d[valueCol] * ScaleFactor > baseLineValue\r\n                    ? \"text-before-edge\"\r\n                    : \"text-after-edge\";\r\n              });\r\n          }\r\n\r\n          svg\r\n            .append(\"g\")\r\n            .selectAll(\"rect\")\r\n            .data(stripedata)\r\n            .enter()\r\n            .append(\"rect\")\r\n            .attr(\"width\", stripeScale.step())\r\n            .attr(\"height\", dh)\r\n            .attr(\"x\", function (d) {\r\n              return stripeScale(d);\r\n            })\r\n            .attr(\"y\", hh)\r\n            .attr(\"fill\", \"rgba(0,0,0,0)\")\r\n            .attr(\"stroke\", OutlineColor)\r\n            .on(\"mouseover\", function (d) {\r\n              if (showTooltips || Links.length) tooltipShow(d);\r\n            })\r\n            .on(\"mouseleave\", function () {\r\n              tooltipHide(false);\r\n            });\r\n\r\n          if (lowSideMargin > 0) {\r\n            let ggLowSide = svg\r\n              .append(\"g\")\r\n              .attr(\"transform\", \"translate(\" + (left + lowSideMargin) + \", 0)\")\r\n              .classed(\"michaeldmoore-multistat-panel-valueaxis\", true)\r\n              .call(\r\n                d3\r\n                  .axisLeft(valueScale)\r\n                  .tickSizeInner(5)\r\n                  .tickSizeOuter(10)\r\n                  .ticks(5)\r\n              );\r\n            ggLowSide.selectAll(\".tick text\").attr(\"fill\", panel.LowAxisColor);\r\n            ggLowSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n            ggLowSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.LowAxisColor)\r\n              .attr(\"stroke-width\", panel.LowAxisWidth);\r\n          }\r\n\r\n          if (highSideMargin > 0) {\r\n            let ggHighSide = svg\r\n              .append(\"g\")\r\n              .attr(\r\n                \"transform\",\r\n                \"translate(\" + (left + w - highSideMargin) + \", 0)\"\r\n              )\r\n              .classed(\"michaeldmoore-multistat-panel-valueaxis\", true)\r\n              .call(\r\n                d3\r\n                  .axisRight(valueScale)\r\n                  .tickSizeInner(5)\r\n                  .tickSizeOuter(10)\r\n                  .ticks(5)\r\n              );\r\n            ggHighSide\r\n              .selectAll(\".tick text\")\r\n              .attr(\"fill\", panel.HighAxisColor);\r\n            ggHighSide\r\n              .selectAll(\".tick line\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n            ggHighSide\r\n              .selectAll(\"path.domain\")\r\n              .attr(\"stroke\", panel.HighAxisColor)\r\n              .attr(\"stroke-width\", panel.HighAxisWidth);\r\n          }\r\n        };\r\n\r\n        let groupNameOffset = this.panel.ShowGroupLabels\r\n          ? Number(this.panel.GroupLabelFontSize.replace(\"%\", \"\")) * 0.15\r\n          : 0;\r\n\r\n        if (this.groupedRows != null) {\r\n          let gcols =\r\n            GroupCols <= 0 || GroupCols > this.groupedRows.length\r\n              ? this.groupedRows.length\r\n              : GroupCols;\r\n          let dw = (w + GroupGap) / gcols;\r\n\r\n          // Figure out the max data points in each column of groups...\r\n          var pointsPerCol = [];\r\n          for (let i = 0; i < gcols; i++) pointsPerCol.push(0);\r\n          for (let i = 0; i < this.groupedRows.length; i++) {\r\n            let cc = i % gcols;\r\n            let u = this.groupedRows[i].values.length;\r\n            if (pointsPerCol[cc] < u) pointsPerCol[cc] = u;\r\n          }\r\n\r\n          let totalPoints = 0;\r\n          for (let i = 0; i < pointsPerCol.length; i++)\r\n            totalPoints += pointsPerCol[i];\r\n\r\n          var colOverheadWidth =\r\n            this.panel.LowSideMargin + this.panel.HighSideMargin;\r\n          var colWidth =\r\n            (w - pointsPerCol.length * colOverheadWidth) / totalPoints;\r\n\r\n          let numRows = Math.ceil(this.groupedRows.length / gcols);\r\n          let dh = h / numRows;\r\n          let hh = dh;\r\n          for (let rr = 0; rr < numRows; rr++) {\r\n            let ww = 0;\r\n            for (let cc = 0; cc < gcols; cc++) {\r\n              let nn = pointsPerCol[cc];\r\n\r\n              let ii = cc + rr * gcols;\r\n              if (ii < this.groupedRows.length) {\r\n                plotGroupVertical(\r\n                  this.panel,\r\n                  this.svg,\r\n                  this.groupedRows[ii].values,\r\n                  nn,\r\n                  this.groupedRows[ii].key,\r\n                  groupNameOffset,\r\n                  ww,\r\n                  dw - GroupGap,\r\n                  hh - dh,\r\n                  dh\r\n                );\r\n                ww += dw;\r\n              }\r\n            }\r\n            hh += dh;\r\n          }\r\n        } else {\r\n          plotGroupVertical(\r\n            this.panel,\r\n            this.svg,\r\n            this.rows,\r\n            this.rows.length,\r\n            \"\",\r\n            0,\r\n            0,\r\n            w,\r\n            0,\r\n            h\r\n          );\r\n        }\r\n      }\r\n\r\n      var pulseHigh = function (svg) {\r\n        var highFlashRects = svg.selectAll(\r\n          \"rect.michaeldmoore-multistat-panel-bar.highflash\"\r\n        );\r\n\r\n        if (\r\n          $.isNumeric(HighLimitBarFlashTimeout) &&\r\n          highFlashRects._groups.length > 0 &&\r\n          highFlashRects._groups[0].length > 0\r\n        ) {\r\n          highFlashRects.transition().on(\"start\", function highRepeat() {\r\n            d3.active(this)\r\n              .style(\"fill\", HighLimitBarFlashColor)\r\n              .duration(HighLimitBarFlashTimeout)\r\n              .transition()\r\n              .style(\"fill\", HighLimitBarColor)\r\n              .duration(HighLimitBarFlashTimeout)\r\n              .transition()\r\n              .on(\"start\", highRepeat);\r\n          });\r\n        }\r\n      };\r\n\r\n      var pulseLow = function (svg) {\r\n        var lowFlashRects = svg.selectAll(\r\n          \"rect.michaeldmoore-multistat-panel-bar.lowflash\"\r\n        );\r\n        if (\r\n          $.isNumeric(LowLimitBarFlashTimeout) &&\r\n          lowFlashRects._groups.length > 0 &&\r\n          lowFlashRects._groups[0].length > 0\r\n        ) {\r\n          lowFlashRects.transition().on(\"start\", function lowRepeat() {\r\n            d3.active(this)\r\n              .style(\"fill\", LowLimitBarFlashColor)\r\n              .duration(LowLimitBarFlashTimeout)\r\n              .transition()\r\n              .style(\"fill\", LowLimitBarColor)\r\n              .duration(LowLimitBarFlashTimeout)\r\n              .transition()\r\n              .on(\"start\", lowRepeat);\r\n          });\r\n        }\r\n      };\r\n\r\n      pulseHigh(this.svg);\r\n      pulseLow(this.svg);\r\n      //} else {\r\n      //  this.displayStatusMessage(\"No data\");\r\n    }\r\n\r\n    // console.log((new XMLSerializer()).serializeToString(this.svg.node()));\r\n\r\n    this.ctrl.renderingCompleted();\r\n  }\r\n\r\n  onConfigChanged() {\r\n    this.refresh();\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    this.ctrl = ctrl;\r\n    this.elem = elem;\r\n\r\n    // for backward compatability (grafana 6.6.0 and earlier)\r\n    var panelContentElem = elem.find(\".panel-content\");\r\n    if (panelContentElem.length) this.elem = panelContentElem;\r\n  }\r\n}\r\n\r\nMultistatPanelCtrl.templateUrl = \"module.html\";\r\n\r\nexport { MultistatPanelCtrl as PanelCtrl };\r\n"]}