{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","d3","angular","kbn","config","TimeSeries","moment","MultistatPanelCtrl","$scope","$injector","alertSrv","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","className","id","svg","select","append","err","set","data","message","seriesList","render","metricNames","sortDirections","aggregations","fontSizes","valuePositions","addEditorTab","cols","length","html","rows","type","i","columns","text","cols0","concat","dateTimeCol","$title","closest","find","$maxDate","children","last","ShowDate","maxDate","dd","add","TZOffsetHours","DateFormat","toUpperCase","fromNow","show","format","hide","scaleAndClipValue","d","val","ScaleFactor","maxLineValue","minLineValue","pulseHigh","highFlashRects","selectAll","isNumeric","HighLimitBarFlashTimeout","_groups","transition","highRepeat","active","style","HighLimitBarFlashColor","duration","HighLimitBarColor","pulseLow","lowFlashRects","LowLimitBarFlashTimeout","lowRepeat","LowLimitBarFlashColor","LowLimitBarColor","labelCol","valueCol","sortCol","groupCol","DateTimeColName","LabelColName","ValueColName","SortColName","GroupColName","LabelNameFilter","regex","RegExp","matchingRows","label","match","push","Aggregate","oo","nest","key","rollup","entries","forEach","x","value","Object","values","assign","mean","Array","from","max","min","height","$container","h","w","width","SortDirection","ascending","sort","y","comp","buildDateHtml","horizontal","Horizontal","labelMargin","LabelMargin","lowSideMargin","LowSideMargin","highSideMargin","HighSideMargin","interrupt","barPadding","BarPadding","baseLineValue","BaseLineValue","MinLineValue","MaxLineValue","highBarColor","HighBarColor","lowBarColor","LowBarColor","highLimitValue","HighLimitValue","recolorHighLimitBar","RecolorHighLimitBar","lowLimitValue","LowLimitValue","recolorLowLimitBar","RecolorLowLimitBar","flashHighLimitBar","FlashHighLimitBar","flashLowLimitBar","FlashLowLimitBar","showTooltips","ShowTooltips","TooltipDateFormat","ValueDecimals","OddRowColor","EvenRowColor","GroupSortString","GroupCols","GroupNameFilter","Number","LabelColor","OutOfRangeLabelColor","ValuePosition","minValue","maxValue","attr","tooltipShow","c","tooltipDiv","cc","toFixed","event","pageX","pageY","tooltipHide","plotGroupHorizontal","numRows","groupName","groupNameOffset","left","hh","dh","labels","map","Math","random","toString","substr","labelScale","scaleBand","domain","rangeRound","padding","stripedata","range","stripeScale","oddeven","enter","bandwidth","gg","ShowValues","maxValueWidth","ValueFontSize","ValueColor","each","thisWidth","getComputedTextLength","ShowLabels","maxLabelWidth","LabelFontSize","valueScale","scaleLinear","nice","vLine","color","ShowBaseLine","BaseLineColor","ShowMaxLine","MaxLineColor","ShowMinLine","MinLineColor","ShowHighLimitLine","HighLimitLineColor","ShowLowLimitLine","LowLimitLineColor","abs","classed","g","ShowGroupLabels","GroupLabelFontSize","GroupLabelColor","call","axisTop","HighAxisColor","axisBottom","LowAxisColor","replace","groupedRows","matchingGroups","a","b","aPos","search","bPos","localeCompare","gap","gcols","dw","pointsPerRow","rr","floor","u","totalPoints","rowOverheadHeight","rowHeight","ceil","nn","ii","hLine","chartTop","maxValueHeight","thisHeight","getBBox","maxLabelHeight","labelAngle","LableAngle","bbox","s","sin","PI","cos","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","renderingCompleted","refresh","scope","attrs","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {\r\n    MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\n\r\nimport \"./css/multistat-panel.css!\";\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport d3 from './external/d3';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport moment from 'moment';\r\n\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n\r\n    /** @ngInject */\r\n    constructor($scope, $injector, alertSrv) {\r\n        super($scope, $injector);\r\n\r\n        this.alertSrv = alertSrv;\r\n\r\n        var panelDefaults = {\r\n\t\t\t\"BarPadding\": 10,\r\n\t\t\t\"BaseLineColor\": \"red\",\r\n\t\t\t\"BaseLineValue\": 0,\r\n\t\t\t\"DateTimeColName\": \"date\",\r\n\t\t\t\"DateFormat\": \"YYYY-MM-DD HH:mm:ss\",\r\n\t\t\t\"TooltipDateFormat\": \"YYYY-MM-DD HH:mm:ss\",\r\n\t\t\t\"FlashHighLimitBar\": false,\r\n\t\t\t\"FlashLowLimitBar\": false,\r\n\t\t\t\"HighAxisColor\": \"white\",\r\n\t\t\t\"HighBarColor\": \"rgb(120, 128, 0)\",\r\n\t\t\t\"HighLimitBarColor\": \"red\",\r\n\t\t\t\"HighLimitBarFlashColor\": \"orange\",\r\n\t\t\t\"HighLimitBarFlashTimeout\": 1000,\r\n\t\t\t\"HighLimitLineColor\": \"red\",\r\n\t\t\t\"HighLimitValue\": 0.33,\r\n\t\t\t\"HighSideMargin\": 20,\r\n\t\t\t\"Horizontal\": false,\r\n\t\t\t\"LabelColName\": \"sensor\",\r\n\t\t\t\"LabelNameFilter\": \"\",\r\n\t\t\t\"LabelColor\": \"white\",\r\n\t\t\t\"OutOfRangeLabelColor\": \"red\",\r\n\t\t\t\"GroupLabelColor\": \"white\",\r\n\t\t\t\"LabelFontSize\": \"100%\",\r\n\t\t\t\"GroupLabelFontSize\": \"200%\",\r\n\t\t\t\"LabelMargin\": null,\r\n\t\t\t\"LowAxisColor\": \"white\",\r\n\t\t\t\"LowBarColor\": \"teal\",\r\n\t\t\t\"LowLimitBarColor\": \"red\",\r\n\t\t\t\"LowLimitBarFlashColor\": \"orange\",\r\n\t\t\t\"LowLimitBarFlashTimeout\": 200,\r\n\t\t\t\"LowLimitLineColor\": \"red\",\r\n\t\t\t\"LowLimitValue\": null,\r\n\t\t\t\"LowSideMargin\": 20,\r\n\t\t\t\"MaxLineColor\": \"rgb(74, 232, 12)\",\r\n\t\t\t\"MaxLineValue\": 1,\r\n\t\t\t\"MinLineValue\": 0,\r\n\t\t\t\"RecolorHighLimitBar\": true,\r\n\t\t\t\"RecolorLowLimitBar\": false,\r\n\t\t\t\"ShowBaseLine\": true,\r\n\t\t\t\"ShowDate\": false,\r\n\t\t\t\"Aggregate\": \"last\",\r\n\t\t\t\"ShowHighLimitLine\": true,\r\n\t\t\t\"ShowLabels\": true,\r\n\t\t\t\"ShowGroupLabels\": true,\r\n\t\t\t\"ShowLeftAxis\": true,\r\n\t\t\t\"ShowLowLimitLine\": false,\r\n\t\t\t\"ShowMaxLine\": false,\r\n\t\t\t\"ShowMinLine\": true,\r\n\t\t\t\"ShowRightAxis\": true,\r\n\t\t\t\"ShowTooltips\": true,\r\n\t\t\t\"ShowValues\": true,\r\n\t\t\t\"SortColName\": \"value\",\r\n\t\t\t\"SortDirection\": \"ascending\",\r\n\t\t\t\"TZOffsetHours\": 0,\r\n\t\t\t\"ValueColName\": \"value\",\r\n\t\t\t\"ValueDecimals\": 2,\r\n\t\t\t\"ValueColor\": \"white\",\r\n\t\t\t\"ValueFontSize\": \"100%\",\r\n\t\t\t\"OddRowColor\": \"rgba(33, 33, 34, 0.92)\",\r\n\t\t\t\"EvenRowColor\": \"rgba(61, 61, 64, 0.78)\",\r\n\t\t\t\"GroupSortString\": \"\",\r\n\t\t\t\"GroupCols\": 0,\r\n\t\t\t\"GroupNameFilter\": \"\",\r\n\t\t\t\"ScaleFactor\": 1.0,\r\n\t\t\t\"ValuePosition\": \"top\",\r\n\t\t\t\"LableAngle\": 0\r\n\t\t\t};\r\n\r\n        var panel = {};\r\n        var elem = {};\r\n        var ctrl = {};\r\n\t\t\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\r\n\t\tthis.className = 'michaeldmoore-multistat-panel-' + this.panel.id;\r\n\t\tthis.svg = d3.select('.' + this.className).append('svg');\t\r\n    }\r\n\r\n    onDataError(err) {\r\n        this.alertSrv.set('Multistat Data Error', err.data.message == 'Found no column named time' ? 'Time-Series queries not yet supported' : err.data.message, 'error', 5000);\r\n        this.seriesList = [];\r\n\t\tthis.data = [];\r\n        this.render();\r\n    }\r\n\r\n    onInitEditMode() {\r\n\t\tthis.metricNames = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\r\n\t\tthis.sortDirections = ['none', 'ascending', 'descending'];\r\n\t\tthis.aggregations = ['all', 'last', 'first', 'mean', 'max', 'min'];\r\n        this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%', '250%', '300%', '350%', '400%'];\r\n\t\tthis.valuePositions = ['bar base', 'bar end', 'top'];\r\n        this.addEditorTab('Columns', 'public/plugins/michaeldmoore-multistat-panel/columns.html', 2);\r\n        this.addEditorTab('Layout', 'public/plugins/michaeldmoore-multistat-panel/layout.html', 3);\r\n        this.addEditorTab('Options', 'public/plugins/michaeldmoore-multistat-panel/options.html', 4);\r\n        this.addEditorTab('Lines-and-Limits', 'public/plugins/michaeldmoore-multistat-panel/linesandlimits.html', 5);\r\n    }\r\n\r\n\r\n    onDataReceived(data) {\r\n\t\tthis.cols = [];\r\n\t\tif (data.length == 0){\r\n\t\t\tthis.elem.html(\"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show</div>\");\r\n\t\t\tthis.data = data;\r\n\t\t\tthis.rows = null;\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\telse if (data[0].type == \"table\"){\r\n\t\t\tthis.data = data[0];\r\n\r\n\t\t\tfor(var i=0; i < this.data.columns.length; i++)\r\n\t\t\t\tthis.cols[i] = this.data.columns[i].text;\r\n\t\t\tthis.cols0 = [''].concat(this.cols);\r\n\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\telse {\r\n          this.alertSrv.set('Non-Table type data received', 'Multistat does not support Time Series data sets', 'error', 5000);\r\n\t\t}\r\n    }\r\n\r\n\tbuildDateHtml(dateTimeCol){\r\n\t\tvar $title = this.elem.closest('.panel-container').find('.panel-title');\r\n\t\tvar $maxDate = $title.find('span.michaeldmoore-multistat-panel-maxDate');\r\n\r\n\t\tif($maxDate.length == 0)\r\n\t\t\t$maxDate = $title.append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>').children().last();\r\n\r\n\t\tif (dateTimeCol != -1 && this.panel.ShowDate) {\r\n\t\t\tvar maxDate = this.rows[0][dateTimeCol];\r\n\r\n\t\t\tfor(var i = 1; i < this.rows.length; i++){\r\n\t\t\t\tif (maxDate < this.rows[i][dateTimeCol])\r\n\t\t\t\t\tmaxDate = this.rows[i][dateTimeCol];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar dd = moment(maxDate).add(this.panel.TZOffsetHours, 'h');\r\n\t\t\t\r\n\t\t\tif (this.panel.DateFormat.toUpperCase() == 'ELAPSED')\r\n\t\t\t\t$maxDate.text(dd.fromNow()).show();\r\n\t\t\telse\r\n\t\t\t\t$maxDate.text(dd.format(this.panel.DateFormat)).show();\r\n\t\t}\r\n\t\telse\r\n\t\t\t$maxDate.hide();\t\t\t\r\n\t}\r\n\r\n\r\n    onRender() {\r\n\t\tif (this.data != null && this.data.rows != null) {\r\n\t\t\tvar cols = this.cols;\r\n\t\t\tvar dateTimeCol = -1;\r\n\t\t\tvar labelCol = -1;\r\n\t\t\tvar valueCol = 0;\r\n\t\t\tvar sortCol = 0;\r\n\t\t\tvar groupCol = -1;\r\n\t\t\tfor(var i=0; i < cols.length; i++){\r\n\t\t\t\tif (cols[i] == this.panel.DateTimeColName)\r\n\t\t\t\t\tdateTimeCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.LabelColName)\r\n\t\t\t\t\tlabelCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.ValueColName)\r\n\t\t\t\t\tvalueCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.SortColName)\r\n\t\t\t\t\tsortCol = i;\r\n\t\t\t\tif (cols[i] == this.panel.GroupColName)\r\n\t\t\t\t\tgroupCol = i;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.panel.LabelNameFilter.length > 0 && labelCol != -1)\r\n\t\t\t{\r\n\t\t\t\tvar regex = new RegExp(this.panel.LabelNameFilter, \"\");\r\n\t\t\t\tthis.matchingRows = [];\r\n\t\t\t\tfor(var i = 0; i < this.data.rows.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar dd = this.data.rows[i];\r\n\t\t\t\t\tvar label = dd[labelCol];\r\n\t\t\t\t\tif (label.match(regex) != null)\r\n\t\t\t\t\t\tthis.matchingRows.push(dd);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tthis.matchingRows = this.data.rows;\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\tif (this.panel.Aggregate != 'all' && labelCol != -1){\r\n\t\t\t\tvar oo = [];\r\n\t\t\t\tthis.rows = [];\r\n\t\t\t\tswitch(this.panel.Aggregate) {\r\n\t\t\t\t\tcase 'first':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){return d[0]})\r\n\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = oo;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'last':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){return d[d.length - 1]})\r\n\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = oo;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'mean':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){\r\n\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\tdd[valueCol] = d3.mean(d, function(d) { return d[valueCol];});\r\n\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'max':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){\r\n\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\tdd[valueCol] = d3.max(d, function(d) { return d[valueCol];});\r\n\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'min':\r\n\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t.key(function(d){return d[labelCol]})\r\n\t\t\t\t\t\t\t.rollup(function(d){\r\n\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\tdd[valueCol] = d3.min(d, function(d) { return d[valueCol];});\r\n\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t.forEach(function(x){oo.push(x.value); });\r\n\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.rows = this.matchingRows;\r\n\t\t\t}\t\t\r\n\r\n\t\t\tthis.elem.html(\"<svg class='\" + this.className + \"'  style='height:\" + this.ctrl.height + \"px; width:100%'></svg>\");\r\n\t\t\tvar $container = this.elem.find('.' + this.className);\r\n\r\n\t\t\tvar h = $container.height();\r\n\t\t\tvar w = $container.width() - 15;\r\n\r\n\t\t\tif (this.panel.SortDirection != \"none\"){\r\n\t\t\t\tvar ascending = this.panel.SortDirection == \"ascending\";\r\n\t\t\t\tthis.rows.sort(function(x, y){\r\n\t\t\t\t\tvar comp = (x[sortCol] == y[sortCol]) ? 0 : ((x[sortCol] > y[sortCol]) ? 1 : -1);\r\n\t\t\t\t\treturn ascending ? comp : -comp;\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.buildDateHtml(dateTimeCol);\r\n\t\t\t\r\n\t\t\tvar horizontal = this.panel.Horizontal;\r\n\t\t\t\r\n\t\t\tvar labelMargin = ($.isNumeric(this.panel.LabelMargin) && this.panel.LabelMargin >= 0) ? this.panel.LabelMargin : null;\r\n\t\t\tvar lowSideMargin = this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\r\n\t\t\tvar highSideMargin = this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\r\n\r\n\t\t\tthis.svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\").interrupt();\r\n\t\t\tthis.svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\").interrupt();\r\n\r\n\t\t\tthis.svg = d3.select('.' + this.className).append('svg');\t\r\n\t\t\t\r\n\t\t\tvar id = this.panel.id;\r\n\t\t\tvar barPadding = this.panel.BarPadding;\r\n\t\t\tvar baseLineValue = this.panel.BaseLineValue;\r\n\t\t\tvar minLineValue = this.panel.MinLineValue;\r\n\t\t\tvar maxLineValue = this.panel.MaxLineValue;\r\n\t\t\tvar highBarColor = this.panel.HighBarColor;\r\n\t\t\tvar lowBarColor = this.panel.LowBarColor;\r\n\t\t\tvar highLimitValue = this.panel.HighLimitValue;\r\n\t\t\tvar HighLimitBarColor = this.panel.HighLimitBarColor;\r\n\t\t\tvar HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\r\n\t\t\tvar HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\r\n\t\t\tvar recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n\t\t\tvar lowLimitValue = this.panel.LowLimitValue;\r\n\t\t\tvar LowLimitBarColor = this.panel.LowLimitBarColor;\r\n\t\t\tvar LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\r\n\t\t\tvar LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\r\n\t\t\tvar recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n\t\t\tvar flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n\t\t\tvar flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n\t\t\tvar showTooltips = this.panel.ShowTooltips;\r\n\t\t\tvar DateTimeColName = this.panel.DateTimeColName;\r\n\t\t\tvar DateFormat = this.panel.DateFormat;\r\n\t\t\tvar TooltipDateFormat = this.panel.TooltipDateFormat;\r\n\t\t\tvar ValueColName = this.panel.ValueColName;\r\n\t\t\tvar ValueDecimals = this.panel.ValueDecimals;\r\n\t\t\tvar OddRowColor = this.panel.OddRowColor;\r\n\t\t\tvar EvenRowColor = this.panel.EvenRowColor;\r\n\t\t\tvar TZOffsetHours = this.panel.TZOffsetHours;\r\n\t\t\tvar GroupSortString = this.panel.GroupSortString;\r\n\t\t\tvar GroupCols = this.panel.GroupCols;\r\n\t\t\tvar GroupNameFilter = this.panel.GroupNameFilter;\r\n\t\t\tvar ScaleFactor = Number(this.panel.ScaleFactor);\r\n\t\t\tvar LabelColor = this.panel.LabelColor;\r\n\t\t\tvar OutOfRangeLabelColor = this.panel.OutOfRangeLabelColor;\r\n\t\t\tvar ValuePosition = this.panel.ValuePosition;\r\n\t\t\t\r\n\t\t\tvar minValue = d3.min(this.rows, function(d) { return Number(d[valueCol]) * ScaleFactor; });\r\n\t\t\tif ($.isNumeric(minLineValue) == false)\r\n\t\t\t\tminLineValue = minValue;\r\n\t\t\t\r\n\t\t\tvar maxValue = d3.max(this.rows, function(d) { return Number(d[valueCol]) * ScaleFactor; });\r\n\t\t\tif ($.isNumeric(maxLineValue) == false)\r\n\t\t\t\tmaxLineValue = maxValue;\t\t\t\t\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(baseLineValue) == false)\r\n\t\t\t\tbaseLineValue = 0;\r\n\t\t\t\r\n\t\t\tif (minLineValue > baseLineValue)\r\n\t\t\t\tminLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(lowLimitValue) && minLineValue > lowLimitValue)\r\n\t\t\t\tminLineValue = lowLimitValue;\r\n\t\t\t\r\n\t\t\tif (maxLineValue < baseLineValue)\r\n\t\t\t\tmaxLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(highLimitValue) && maxLineValue < highLimitValue)\r\n\t\t\t\tmaxLineValue = highLimitValue;\r\n\r\n\t\t\td3.select(\"body\").append(\"div\")\r\n\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-tooltip michaeldmoore-multistat-panel-tooltip-\" + id)\r\n\t\t\t\t.style(\"opacity\", 0);\r\n\t\t\t\r\n\t\t\tvar tooltipShow = function(d, c, id){\r\n\t\t\t\tvar tooltipDiv = d3.select(\".michaeldmoore-multistat-panel-tooltip-\" + id);\r\n\t\t\t\ttooltipDiv.transition()\r\n\t\t\t\t.duration(200)\r\n\t\t\t\t.style(\"opacity\", .9);\r\n\t\t\t\tvar html = \"<table>\";\r\n\t\t\t\tfor (i = 0; i < d.length; i++){\r\n\t\t\t\t\tvar cc = c[i];\r\n\t\t\t\t\tvar dd = d[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (cc == DateTimeColName)\r\n\t\t\t\t\t\tdd = moment(dd).add(TZOffsetHours, 'h').format(TooltipDateFormat);\r\n\t\t\t\t\telse if (cc == ValueColName && $.isNumeric(dd))\r\n\t\t\t\t\t\tdd = Number(dd).toFixed(ValueDecimals);\r\n\t\t\t\t\t\r\n\t\t\t\t\thtml += \"<tr><td>\" + cc + \"</td><td>\" + dd + \"</td></tr>\";\r\n\t\t\t\t}\r\n\t\t\t\thtml += \"</table>\";\r\n\t\t\t\ttooltipDiv.html(html)\r\n\t\t\t\t.style(\"left\", d3.event.pageX + \"px\")\r\n\t\t\t\t.style(\"top\", (d3.event.pageY - 28) + \"px\");\r\n\t\t\t}\r\n\r\n\t\t\tvar tooltipHide = function(id) {\r\n\t\t\t\tvar tooltipDiv = d3.selectAll(\".michaeldmoore-multistat-panel-tooltip-\" + id);\r\n\t\t\t\ttooltipDiv.transition()\t\t\r\n\t\t\t\t.duration(500)\t\t\r\n\t\t\t\t.style(\"opacity\", 0);\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfunction scaleAndClipValue(d) {\r\n\t\t\t\tvar val = d * ScaleFactor;\r\n\t\t\t\tif (val > maxLineValue)\r\n\t\t\t\t\tval = maxLineValue;\r\n\t\t\t\tif (val < minLineValue)\r\n\t\t\t\t\tval = minLineValue;\r\n\t\t\t\t\r\n\t\t\t\treturn val;\r\n\t\t\t}\t\t\t\r\n\t\t\t\t\t\r\n\r\n\t\t\tif(horizontal) {\r\n\t\t\t\tvar plotGroupHorizontal = function(panel, svg, data, numRows, groupName, groupNameOffset, left, w, hh, dh) {\r\n\r\n\t\t\t\t\t// draw border rectangle\r\n\t\t\t\t\t/*svg.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t.attr(\"stroke\", \"yellow\");*/\r\n\r\n\t\t\t\t\t\t//panel.GroupLabelFontSize\r\n\t\t\t\t\t\r\n\t\t\t\t\thh += groupNameOffset;\r\n\t\t\t\t\tdh -= groupNameOffset;\r\n\t\t\t\t\tw -= 10;\r\n\r\n\t\t\t\t\t// draw border rectangle\r\n\t\t\t\t\t/*svg.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t.attr(\"stroke\", \"white\");*/\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tvar labels = data.map(function(d){ return d[labelCol]; });\r\n\t\t\t\t\twhile (labels.length < numRows)\r\n\t\t\t\t\t\tlabels = labels.concat('_' + Math.random().toString(36).substr(2, 9));\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t.domain(labels)\r\n\t\t\t\t\t\t\t\t.rangeRound([hh + highSideMargin, hh + dh - lowSideMargin])\r\n\t\t\t\t\t\t\t\t.padding(barPadding / 100);\r\n\t\t\t\t\r\n\t\t\t\t\tvar stripedata = data.concat(d3.range(data.length, numRows));\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar stripeScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t.domain(stripedata)\r\n\t\t\t\t\t\t\t\t.rangeRound([hh + highSideMargin, hh + dh - lowSideMargin])\r\n\t\t\t\t\t\t\t\t.padding(barPadding / 100);\r\n\t\t\t\t\r\n\t\t\t\t\t// Draw background of alternating stripes \r\n\t\t\t\t\tvar oddeven = false;\r\n\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t.data(stripedata)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t.attr(\"height\", labelScale.bandwidth())\r\n\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t.attr(\"y\", function(d){return stripeScale(d)})\r\n\t\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\t\toddeven = !oddeven;\r\n\t\t\t\t\t\t\t\treturn oddeven ? OddRowColor : EvenRowColor;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseover\", function(d, i) {\r\n\t\t\t\t\t\t\tif (showTooltips && i < data.length)\r\n\t\t\t\t\t\t\t\ttooltipShow(d, cols, id);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\t\ttooltipHide(id);\r\n\t\t\t\t\t\t\t});\r\n\r\n\r\n\r\n\r\n\t\t\t\t\tvar gg = svg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"g\");\r\n\r\n\t\t\t\t\tif (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n\t\t\t\t\t\tvar maxValueWidth = 0;\r\n\t\t\t\t\t\tgg.append(\"text\")\r\n\t\t\t\t\t\t.text(function(d) {return (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals)})\r\n\t\t\t\t\t\t.attr(\"x\", left + w)\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\")\r\n\t\t\t\t\t\t.each(function(d,i) {\r\n\t\t\t\t\t\t\tvar thisWidth = this.getComputedTextLength();\r\n\t\t\t\t\t\t\tmaxValueWidth = d3.max([maxValueWidth, thisWidth]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tw -= maxValueWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (panel.ShowLabels) {\r\n\t\t\t\t\t\tvar maxLabelWidth = 0;\r\n\t\t\t\t\t\tgg.append(\"text\")\r\n\t\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", panel.LabelFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", function(d,i){return d[valueCol] * ScaleFactor > maxLineValue || d[valueCol] * ScaleFactor < minLineValue ? panel.OutOfRangeLabelColor : panel.LabelColor; })\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"start\")\r\n\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\")\r\n\t\t\t\t\t\t.on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\t\ttooltipShow(d, cols, id);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\t\ttooltipHide(id);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.each(function(d,i) {\r\n\t\t\t\t\t\t\tvar thisWidth = this.getComputedTextLength();\r\n\t\t\t\t\t\t\tmaxLabelWidth = d3.max([maxLabelWidth, thisWidth]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif ($.isNumeric(labelMargin)){\r\n\t\t\t\t\t\t\tleft += labelMargin;\r\n\t\t\t\t\t\t\tw -= labelMargin;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tleft += maxLabelWidth;\r\n\t\t\t\t\t\t\tw -= maxLabelWidth;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t.domain([minLineValue, maxLineValue])\r\n\t\t\t\t\t\t.range([left + labelMargin, left + w])\r\n\t\t\t\t\t\t.nice();\r\n\t\t\t\t\r\n\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\tfunction vLine(svg, value, color) {\t\r\n\t\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t\t.attr(\"y1\", hh + highSideMargin)\r\n\t\t\t\t\t\t\t.attr(\"x1\", valueScale(value))\r\n\t\t\t\t\t\t\t.attr(\"y2\", hh + dh - lowSideMargin)\r\n\t\t\t\t\t\t\t.attr(\"x2\", valueScale(value));\r\n\t\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\t\tif(panel.ShowBaseLine)\r\n\t\t\t\t\t\tvLine(svg, baseLineValue, panel.BaseLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowMaxLine)\r\n\t\t\t\t\t\tvLine(svg, maxLineValue, panel.MaxLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowMinLine)\r\n\t\t\t\t\t\tvLine(svg, minLineValue, panel.MinLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowHighLimitLine)\r\n\t\t\t\t\t\tvLine(svg, highLimitValue, panel.HighLimitLineColor);\r\n\r\n\t\t\t\t\tif(panel.ShowLowLimitLine)\r\n\t\t\t\t\t\tvLine(svg, lowLimitValue, panel.LowLimitLineColor);\r\n\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t\t.attr(\"width\", function(d) {\r\n\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\treturn Math.abs(valueScale(val) - valueScale(baseLineValue));\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"height\", labelScale.bandwidth())\r\n\t\t\t\t\t\t.attr(\"x\", function(d) { \r\n\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\treturn d3.min([valueScale(val), valueScale(baseLineValue)]); \r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol])})\r\n\t\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] * ScaleFactor > highLimitValue))\r\n\t\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] * ScaleFactor < lowLimitValue))\r\n\t\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.classed(\"highflash\", function(d) { \r\n\t\t\t\t\t\t\treturn recolorHighLimitBar && flashHighLimitBar && (d[valueCol] * ScaleFactor > highLimitValue);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.classed(\"lowflash\", function(d) { \r\n\t\t\t\t\t\t\treturn recolorLowLimitBar && flashLowLimitBar && (d[valueCol] * ScaleFactor < lowLimitValue);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\t\ttooltipShow(d, cols, id);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\t\ttooltipHide(id);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tvar g = svg\r\n\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t.append(\"g\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n\t\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t\t.text(function(d) {return (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals)})\r\n\t\t\t\t\t\t.attr(\"x\", function(d){\r\n\t\t\t\t\t\t\tif (panel.ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t\treturn valueScale(baseLineValue);// + 5;\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\treturn valueScale(val) + ((val > baseLineValue))// ? - 5 : + 5)\r\n\t\t\t\t\t\t\t}})\r\n\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t.attr(\"text-anchor\", function(d){\r\n\t\t\t\t\t\t\tif (panel.ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"start\" : \"end\";\r\n\t\t\t\t\t\t\t\t//return \"start\";\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"end\" : \"start\";\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add Above-High Side Group Names\r\n\t\t\t\t\tif(groupName != '' && panel.ShowGroupLabels) {\r\n\t\t\t\t\t\tsvg\r\n\t\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t\t.text(groupName)\r\n\t\t\t\t\t\t\t.attr(\"x\", left + (labelMargin + w)/2)\r\n\t\t\t\t\t\t\t.attr(\"y\", hh - groupNameOffset/2)\r\n\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t.attr(\"font-size\", panel.GroupLabelFontSize)\r\n\t\t\t\t\t\t\t.attr(\"fill\", panel.GroupLabelColor)\r\n\t\t\t\t\t\t\t.attr(\"background\", \"blue\")\r\n\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Add High Side Value Axis (X)\r\n\t\t\t\t\tif (highSideMargin > 0) {\r\n\t\t\t\t\t\tvar gg = svg\r\n\t\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t\t.attr(\"transform\", 'translate(1,' + (hh + highSideMargin) + ')')\r\n\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t\t.call(d3.axisTop(valueScale));\r\n\t\t\t\t\t\tgg.selectAll('.tick text').attr('fill', panel.HighAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', panel.HighAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', panel.HighAxisColor);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Add Low Side Value Axis (X)\r\n\t\t\t\t\tif (lowSideMargin > 0) {\t\r\n\t\t\t\t\t\tvar gg = svg\r\n\t\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t\t.attr(\"transform\", 'translate(0,' + (hh + dh - lowSideMargin) + ')')\r\n\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t\t.call(d3.axisBottom(valueScale));\r\n\t\t\t\t\t\tgg.selectAll('.tick text').attr('fill', panel.LowAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', panel.LowAxisColor);\r\n\t\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', panel.LowAxisColor);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar groupNameOffset = 0;\r\n\t\t\t\t\r\n\t\t\t\tif (this.panel.ShowGroupLabels)\r\n\t\t\t\t\tgroupNameOffset = Number(this.panel.GroupLabelFontSize.replace('%','')) * 0.15;\r\n\r\n\t\t\t\tif (groupCol >= 0){\r\n\t\t\t\t\tthis.groupedRows = d3.nest()\r\n\t\t\t\t\t\t.key(function(d){return d[groupCol]})\r\n\t\t\t\t\t\t.entries(this.rows);\r\n\r\n\t\t\t\t\tif (GroupNameFilter.length > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar regex = new RegExp(GroupNameFilter, \"\");\r\n\t\t\t\t\t\tvar matchingGroups = [];\r\n\t\t\t\t\t\tfor(var i = 0; i < this.groupedRows.length; i++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar groupName = this.groupedRows[i].key;\r\n\t\t\t\t\t\t\tif (groupName.match(regex) != null)\r\n\t\t\t\t\t\t\t\tmatchingGroups.push(this.groupedRows[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.groupedRows = matchingGroups;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\tthis.groupedRows.sort(\r\n\t\t\t\t\t\tfunction(a,b){\r\n\t\t\t\t\t\t\tvar aPos = GroupSortString.search(a.key);\r\n\t\t\t\t\t\t\tvar bPos = GroupSortString.search(b.key);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (aPos == bPos)\r\n\t\t\t\t\t\t\t\treturn a.key.localeCompare(b.key);\r\n\t\t\t\t\t\t\telse if (aPos == -1)\r\n\t\t\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\t\t\telse if (bPos == -1)\r\n\t\t\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\treturn aPos - bPos;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar gap = 5;\t\r\n\t\t\t\t\tvar gcols = (GroupCols <= 0 || GroupCols > this.groupedRows.length) ? this.groupedRows.length : GroupCols;\r\n\t\t\t\t\tvar dw = ((w + gap) / gcols);\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t// figure out the max data points in each row of groups...\r\n\t\t\t\t\tvar pointsPerRow = [];\r\n\t\t\t\t\tfor(var i = 0; i < this.groupedRows.length/gcols; i++)\r\n\t\t\t\t\t\tpointsPerRow.push(0);\r\n\t\t\t\t\tfor(var i = 0; i < this.groupedRows.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar rr = Math.floor(i / gcols);\r\n\t\t\t\t\t\tvar u = this.groupedRows[i].values.length;\r\n\t\t\t\t\t\tif (pointsPerRow[rr] < u)\r\n\t\t\t\t\t\t\tpointsPerRow[rr] = u;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar totalPoints = 0;\r\n\t\t\t\t\tfor(var i = 0; i < pointsPerRow.length; i++)\r\n\t\t\t\t\t\ttotalPoints += pointsPerRow[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar rowOverheadHeight = groupNameOffset + this.panel.LowSideMargin + this.panel.HighSideMargin;\r\n\t\t\t\t\tvar rowHeight = (h - (pointsPerRow.length * rowOverheadHeight)) / totalPoints;\t\t\t\t\t\r\n\r\n\t\t\t\t\tvar numRows = Math.ceil(this.groupedRows.length / gcols);\r\n\t\t\t\t\tvar hh = 0;\r\n\t\t\t\t\tfor (var rr = 0; rr < numRows; rr++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar nn = pointsPerRow[rr];\r\n\t\t\t\t\t\tvar dh = rowOverheadHeight + (nn * rowHeight);\r\n\t\t\t\t\t\thh += dh;\r\n\t\t\t\t\t\tfor (var cc = 0; cc < gcols; cc++)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar ii = cc + (rr * gcols);\r\n\t\t\t\t\t\t\tif (ii < this.groupedRows.length)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tplotGroupHorizontal(this.panel, this.svg, this.groupedRows[ii].values, nn, this.groupedRows[ii].key, groupNameOffset, cc * dw, dw - gap, hh - dh, dh);\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.groupedRows = null;\r\n\r\n\t\t\t\t\tplotGroupHorizontal(this.panel, this.svg, this.rows, this.rows.length, '', 0, 0, w, 0, h);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t.domain(this.rows.map(function(d){ return d[labelCol]; }))\r\n\t\t\t\t\t\t\t.range([lowSideMargin, w - highSideMargin])\r\n\t\t\t\t\t\t\t.padding(barPadding / 100);\r\n\r\n\t\t\t\tvar chartTop = 0;\r\n\r\n\t\t\t\t// Draw background of alternating stripes \r\n\t\t\t\tvar oddeven = false;\r\n\t\t\t\t//var svg = \r\n\t\t\t\tthis.svg\r\n\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n\t\t\t\t\t.attr(\"width\", labelScale.bandwidth())\r\n\t\t\t\t\t.attr(\"height\", h)\r\n\t\t\t\t\t.attr(\"x\", function(d,i){return labelScale(d[labelCol])})\r\n\t\t\t\t\t.attr(\"y\", chartTop)\r\n\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\toddeven = !oddeven;\r\n\t\t\t\t\t\t\treturn oddeven ? OddRowColor : EvenRowColor;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\ttooltipShow(d, cols, id);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\ttooltipHide(id);\r\n\t\t\t\t\t\t});\r\n\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tvar gg = this.svg\r\n\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"g\");\r\n\t\t\t\t\t\r\n\t\t\t\tif (this.panel.ShowValues && this.panel.ValuePosition == \"top\") {\r\n\t\t\t\t\tvar maxValueHeight = 0;\r\n\t\t\t\t\tgg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) {return (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals)})\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2); })\r\n\t\t\t\t\t.attr(\"y\", 0)\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.ValueFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.ValueColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"dominant-baseline\", \"text-before-edge\")\r\n\t\t\t\t\t.each(function(d,i) {\r\n\t\t\t\t\t\tvar thisHeight = this.getBBox().height;\r\n\t\t\t\t\t\tmaxValueHeight = d3.max([maxValueHeight, thisHeight]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchartTop += maxValueHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.panel.ShowLabels) {\r\n\t\t\t\t\tvar maxLabelHeight = 0;\r\n\t\t\t\t\tvar labelAngle = this.panel.LableAngle; \r\n\t\t\t\t\tgg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t//.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2); })\r\n\t\t\t\t\t//.attr(\"y\", h)//function(d) { return h - labelMargin + 14; })\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.LabelFontSize)\r\n\t\t\t\t\t.attr(\"fill\", function(d,i){return d[valueCol] * ScaleFactor > maxLineValue || d[valueCol] * ScaleFactor < minLineValue ? OutOfRangeLabelColor : LabelColor; })\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"dominant-baseline\", \"text-after-edge\")\r\n\t\t\t\t\t.attr(\"transform\", function(d, i) { \r\n\t\t\t\t\t\tvar bbox = this.getBBox();\r\n\t\t\t\t\t\t//console.log(\"bbox=[\"+bbox.width+\",\"+bbox.height+\"]\");\r\n\t\t\t\t\t\tvar s = Math.sin(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\tvar c = Math.cos(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t//console.log(\"s=\"+s+\", c=\"+c);\r\n\t\t\t\t\t\tvar b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n\t\t\t\t\t\tvar a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//console.log(\"bcr=[\"+a+\",\"+b+\"]\");\r\n\t\t\t\t\t\t//var thisHeight = this.getBBox().height;\r\n\t\t\t\t\t\tvar x =  labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\tvar y = h - b/2;\r\n\t\t\t\t\t\treturn \"translate(\"+x+\",\"+y+\") rotate(\"+labelAngle+\")\";\r\n\t\t\t\t\t})\t\t\t\t\t\r\n\t\t\t\t\t.on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\ttooltipShow(d, cols, id);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\ttooltipHide(id);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.each(function(d,i) {\r\n\t\t\t\t\t\tvar bbox = this.getBBox();\r\n\t\t\t\t\t\t//console.log(\"bbox=[\"+bbox.width+\",\"+bbox.height+\"]\");\r\n\t\t\t\t\t\tvar s = Math.sin(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\tvar c = Math.cos(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\tvar b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n\t\t\t\t\t\tvar a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n\t\t\t\t\t\t//var thisHeight = this.getBBox().height;\r\n\t\t\t\t\t\tvar thisHeight = b;\r\n\t\t\t\t\t\tmaxLabelHeight = d3.max([maxLabelHeight, thisHeight]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif ($.isNumeric(labelMargin)){\r\n\t\t\t\t\t\th -= labelMargin;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\th -= maxLabelHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t.domain([maxLineValue, minLineValue])\r\n\t\t\t\t\t.range([chartTop, h])\r\n\t\t\t\t\t.nice();\r\n\t\t\t\t\r\n\t\t\t\tfunction hLine(svg, value, color) {\t\r\n\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t.attr(\"x1\", lowSideMargin)\r\n\t\t\t\t\t\t.attr(\"y1\", valueScale(value))\r\n\t\t\t\t\t\t.attr(\"x2\", w - highSideMargin)\r\n\t\t\t\t\t\t.attr(\"y2\", valueScale(value));\r\n\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\t\r\n\t\t\t\tif(this.panel.ShowBaseLine)\r\n\t\t\t\t\thLine(this.svg, baseLineValue, this.panel.BaseLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMaxLine)\r\n\t\t\t\t\thLine(this.svg, maxLineValue, this.panel.MaxLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMinLine)\r\n\t\t\t\t\thLine(this.svg, minLineValue, this.panel.MinLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowHighLimitLine)\r\n\t\t\t\t\thLine(this.svg, highLimitValue, this.panel.HighLimitLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowLowLimitLine)\r\n\t\t\t\t\thLine(this.svg, lowLimitValue, this.panel.LowLimitLineColor);\r\n\r\n\t\t\t\tgg.append(\"rect\")\t\r\n\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t.attr(\"height\", function(d) { \r\n\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\treturn Math.abs(valueScale(baseLineValue) - valueScale(val));\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"width\", labelScale.bandwidth())\r\n\t\t\t\t\t.attr(\"y\", function(d) { \r\n\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\treturn d3.min([valueScale(val), valueScale(baseLineValue)]); \r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) })\r\n\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] * ScaleFactor > highLimitValue))\r\n\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] * ScaleFactor < lowLimitValue))\r\n\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.classed(\"highflash\", function(d) { \r\n\t\t\t\t\t\treturn recolorHighLimitBar && flashHighLimitBar && (d[valueCol] * ScaleFactor > highLimitValue);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.classed(\"lowflash\", function(d) { \r\n\t\t\t\t\t\treturn recolorLowLimitBar && flashLowLimitBar && (d[valueCol] * ScaleFactor < lowLimitValue);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t    .on(\"mouseover\", function(d) {\r\n\t\t\t\t\t\tif (showTooltips)\r\n\t\t\t\t\t\t\ttooltipShow(d, cols, id);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function() { \r\n\t\t\t\t\t\ttooltipHide(id);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\r\n\t\t\t\tif (this.panel.ShowValues && this.panel.ValuePosition != \"top\") {\r\n\t\t\t\t\tgg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) {return (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals)})\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2); })\r\n\t\t\t\t\t.attr(\"y\", function(d){\r\n\t\t\t\t\t\tif (ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\treturn valueScale(baseLineValue);// + 5;\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\treturn valueScale(val);// + ((val > baseLineValue) ? - 5 : + 5)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.ValueFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.ValueColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"dominant-baseline\", function(d){\r\n\t\t\t\t\t\tif (ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t//return \"text-after-edge\";\r\n\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"text-after-edge\" : \"text-before-edge\";\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"text-before-edge\" : \"text-after-edge\";\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif (lowSideMargin > 0) {\t\r\n\t\t\t\t\tvar gg = this.svg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.attr('transform', 'translate(' + lowSideMargin + ', 0)')\r\n\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t.call(d3.axisLeft(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t\tgg.selectAll('.tick text').attr('fill', this.panel.LowAxisColor);\r\n\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', this.panel.LowAxisColor);\r\n\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', this.panel.LowAxisColor);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (highSideMargin > 0) {\t\r\n\t\t\t\t\tvar gg = this.svg\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.attr('transform', 'translate(' + (w - highSideMargin) + ', 0)')\r\n\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t.call(d3.axisRight(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t\tgg.selectAll('.tick text').attr('fill', this.panel.HighAxisColor);\r\n\t\t\t\t\tgg.selectAll('.tick line').attr('stroke', this.panel.HighAxisColor);\r\n\t\t\t\t\tgg.selectAll('path.domain').attr('stroke', this.panel.HighAxisColor);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t\t\t\t\r\n\t\t\tfunction pulseHigh(svg) {\r\n\t\t\t\tvar highFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\");\r\n\t\t\t\t\r\n\t\t\t\tif ($.isNumeric(HighLimitBarFlashTimeout) && highFlashRects._groups.length > 0 && highFlashRects._groups[0].length > 0) {\r\n\t\t\t\t\thighFlashRects\r\n\t\t\t\t\t.transition()\r\n\t\t\t\t\t.on(\"start\", function highRepeat() {\r\n\t\t\t\t\t\td3.active(this)\r\n\t\t\t\t\t\t\t.style(\"fill\", HighLimitBarFlashColor)\r\n\t\t\t\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.style(\"fill\", HighLimitBarColor)\r\n\t\t\t\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.on(\"start\", highRepeat);\r\n\t\t\t\t\t  });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction pulseLow(svg) {\r\n\t\t\t\tvar lowFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\");\r\n\t\t\t\tif ($.isNumeric(LowLimitBarFlashTimeout) && lowFlashRects._groups.length > 0 && lowFlashRects._groups[0].length > 0) {\r\n\t\t\t\t\tlowFlashRects\r\n\t\t\t\t\t.transition()\r\n\t\t\t\t\t.on(\"start\", function lowRepeat() {\r\n\t\t\t\t\t\td3.active(this)\r\n\t\t\t\t\t\t\t.style(\"fill\", LowLimitBarFlashColor)\r\n\t\t\t\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.style(\"fill\", LowLimitBarColor)\r\n\t\t\t\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.on(\"start\", lowRepeat);\r\n\t\t\t\t\t  });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\tpulseHigh(this.svg);\r\n\t\t\tpulseLow(this.svg);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.elem.html(\"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show!!</div>\");\r\n\r\n\t\t\t\t\t\t\r\n        this.ctrl.renderingCompleted();\r\n    }\r\n\r\n    onConfigChanged() {\r\n        this.refresh();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        this.ctrl = ctrl;\r\n        this.elem = elem.find('.panel-content');\r\n    }\r\n}\r\n\r\nMultistatPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n    MultistatPanelCtrl as PanelCtrl\r\n};\r\n"]}