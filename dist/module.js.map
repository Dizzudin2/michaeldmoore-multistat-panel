{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","angular","d3","kbn","config","TimeSeries","MultistatPanelCtrl","$scope","$injector","alertSrv","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","err","set","seriesList","render","metricNames","sortDirections","fontSizes","addEditorTab","dateTimeCol","$title","closest","find","$maxDate","length","append","children","last","ShowDate","maxDate","rows","i","text","show","hide","hLine","y","color","svg","style","attr","leftMargin","yScale","w","labelCol","valueCol","sortCol","cols","DateTimeColName","LabelColName","ValueColName","SortColName","SortDirection","ascending","sort","x","comp","buildDateHtml","className","html","height","$container","LeftMargin","rightMargin","RightMargin","bottomMargin","h","width","dw","barPadding","BarPadding","baseLineValue","BaseLineValue","minLineValue","MinLineValue","maxLineValue","MaxLineValue","highBarColor","HighBarColor","lowBarColor","LowBarColor","highLimitValue","HighLimitValue","HighLimitBarColor","recolorHighLimitBar","RecolorHighLimitBar","lowLimitValue","LowLimitValue","LowLimitBarColor","recolorLowLimitBar","RecolorLowLimitBar","flashHighLimitBar","FlashHighLimitBar","flashLowLimitBar","FlashLowLimitBar","isNumeric","min","d","max","formatDecimal","format","scaleLinear","domain","range","nice","select","ShowBaseLine","BaseLineColor","ShowMaxLine","MaxLineColor","ShowMinLine","MinLineColor","ShowHighLimitLine","HighLimitLineColor","ShowLowLimitLine","LowLimitLineColor","selectAll","data","enter","hh","classed","g","ShowValues","ValueFontSize","ValueColor","ShowLabels","LabelFontSize","LabelColor","call","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","renderingCompleted","dataList","type","parseCols","columns","Type","refresh","scope","attrs","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {\r\n    MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\n\r\nimport \"./css/multistat-panel.css!\";\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport angular from 'angular';\r\nimport * as d3 from './external/d3';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n\r\n    /** @ngInject */\r\n    constructor($scope, $injector, alertSrv) {\r\n        super($scope, $injector);\r\n\r\n        this.alertSrv = alertSrv;\r\n\r\n        var panelDefaults = {\r\n\t\t\t\"ShowValues\": true,\r\n\t\t\t\"ValueFontSize\": \"100%\",\r\n\t\t\t\"ValueColor\": \"white\",\r\n\t\t\t\"ShowLabels\": true,\r\n\t\t\t\"LabelFontSize\": \"100%\",\r\n\t\t\t\"LabelColor\": \"white\",\r\n\t\t\t\"HighLimitValue\": \"\",\r\n\t\t\t\"HighLimitLineColor\": \"red\",\r\n\t\t\t\"ShowHighLimitLine\": false,\r\n\t\t\t\"RecolorHighLimitBar\": false,\r\n\t\t\t\"HighLimitBarColor\": \"red\",\r\n\t\t\t\"FlashHighLimitBar\": true,\r\n\t\t\t\"LowLimitLineColor\": \"red\",\r\n\t\t\t\"ShowLowLimitLine\": false,\r\n\t\t\t\"RecolorLowLimitBar\": false,\r\n\t\t\t\"LowLimitBarColor\": \"red\",\r\n\t\t\t\"FlashLowLimitBar\": true,\r\n\t\t\t\"ShowDate\": true,\r\n\t\t\t\"ShowLeftAxis\": true,\r\n\t\t\t\"ShowRightAxis\": true,\r\n\t\t\t\"ShowBaseLine\": true,\r\n\t\t\t\"BaseLineValue\": \"\",\r\n\t\t\t\"BaseLineColor\": \"red\",\r\n\t\t\t\"HighBarColor\": \"teal\",\r\n\t\t\t\"LowBarColor\": \"teal\",\r\n\t\t\t\"MinLineValue\": \"\",\r\n\t\t\t\"MaxLineValue\": \"\",\r\n\t\t\t\"SortDirection\": \"none\"\r\n        };\r\n\r\n        var panel = {};\r\n        var elem = {};\r\n        var ctrl = {};\r\n\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    }\r\n\r\n    onDataError(err) {\r\n        this.alertSrv.set('Multistat Data Error', err, 'error', 5000);\r\n        this.seriesList = [];\r\n        this.render([]);\r\n    }\r\n\r\n    onInitEditMode() {\r\n\t\tthis.metricNames = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\r\n\t\tthis.sortDirections = ['none', 'ascending', 'decending'];\r\n        this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\r\n        this.addEditorTab('Options', 'public/plugins/michaeldmoore-multistat-panel/options.html', 2);\r\n    }\r\n\r\n\tbuildDateHtml(dateTimeCol){\r\n\t\tvar $title = this.elem.closest('.panel-container').find('.panel-title.drag-handle.pointer');\r\n\t\tvar $maxDate = $title.find('span.michaeldmoore-multistat-panel-maxDate');\r\n\r\n\t\tif($maxDate.length == 0)\r\n\t\t\t$maxDate = $title.append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>').children().last();\r\n\r\n\t\tif (this.panel.ShowDate) {\r\n\t\t\tvar maxDate = this.rows[0][dateTimeCol];\r\n\r\n\t\t\tfor(var i = 1; i < this.rows.length; i++){\r\n\t\t\t\tif (maxDate < this.rows[i][dateTimeCol])\r\n\t\t\t\t\tmaxDate = this.rows[i][dateTimeCol];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$maxDate.text(maxDate).show();\r\n//\t\t\t$maxDate.text(d3.max(function(d) { return d[dateTimeCol]; })).show();\r\n\t\t}\r\n\t\telse\r\n\t\t\t$maxDate.hide();\t\t\t\r\n\t}\r\n\r\n\r\n\t\r\n    onRender() {\r\n\t\tif (this.rows != null) {\r\n\t\t\tvar dateTimeCol = 0;\r\n\t\t\tvar labelCol = 0;\r\n\t\t\tvar valueCol = 0;\r\n\t\t\tvar sortCol = 0;\r\n\t\t\tfor(var i=0; i < this.cols.length; i++){\r\n\t\t\t\tif (this.cols[i] == this.panel.DateTimeColName)\r\n\t\t\t\t\tdateTimeCol = i;\r\n\t\t\t\tif (this.cols[i] == this.panel.LabelColName)\r\n\t\t\t\t\tlabelCol = i;\r\n\t\t\t\tif (this.cols[i] == this.panel.ValueColName)\r\n\t\t\t\t\tvalueCol = i;\r\n\t\t\t\tif (this.cols[i] == this.panel.SortColName)\r\n\t\t\t\t\tsortCol = i;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.panel.SortDirection != \"none\"){\r\n\t\t\t\tvar ascending = this.panel.SortDirection == \"ascending\";\r\n\t\t\t\tthis.rows.sort(function(x, y){\r\n\t\t\t\t\tvar comp = (x[sortCol] == y[sortCol]) ? 0 : ((x[sortCol] > y[sortCol]) ? 1 : -1);\r\n\t\t\t\t\treturn ascending ? comp : -comp;\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.buildDateHtml(dateTimeCol);\r\n\t\t\t\r\n\t\t\tvar className = 'michaeldmoore-multistat-panel';\r\n\t\t\tthis.elem.html(\"<svg class='\" + className + \"'  style='height:\" + this.ctrl.height + \"px; width:100%'></svg>\");\r\n\t\t\tvar $container = this.elem.find('.' + className);\r\n\t\t\tvar leftMargin = this.panel.LeftMargin >= 0 ? this.panel.LeftMargin : 0;\r\n\t\t\tvar rightMargin = this.panel.RightMargin >= 0 ? this.panel.RightMargin : 0;\r\n\t\t\tvar bottomMargin = 20;\r\n\t\t\tvar h = $container.height() - bottomMargin;\r\n\t\t\tvar w = $container.width() - leftMargin - rightMargin;\r\n\t\t\tvar dw = w / this.rows.length;\r\n\t\t\tvar barPadding = this.panel.BarPadding;\r\n\t\t\tvar baseLineValue = this.panel.BaseLineValue;\r\n\t\t\tvar minLineValue = this.panel.MinLineValue;\r\n\t\t\tvar maxLineValue = this.panel.MaxLineValue;\r\n\t\t\tvar highBarColor = this.panel.HighBarColor;\r\n\t\t\tvar lowBarColor = this.panel.LowBarColor;\r\n\t\t\tvar highLimitValue = this.panel.HighLimitValue;\r\n\t\t\tvar HighLimitBarColor = this.panel.HighLimitBarColor;\r\n\t\t\tvar recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n\t\t\tvar lowLimitValue = this.panel.LowLimitValue;\r\n\t\t\tvar LowLimitBarColor = this.panel.LowLimitBarColor;\r\n\t\t\tvar recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n\t\t\tvar flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n\t\t\tvar flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(barPadding) == false)\r\n\t\t\t\tbarPadding = dw * 0.10;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(minLineValue) == false)\r\n\t\t\t\tminLineValue = d3.min(this.rows, function(d) { return d[valueCol]; });\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(maxLineValue) == false)\r\n\t\t\t\tmaxLineValue = d3.max(this.rows, function(d) { return d[valueCol]; });\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(baseLineValue) == false)\r\n\t\t\t\tbaseLineValue = 0;\r\n\t\t\t\r\n\t\t\tif (minLineValue > baseLineValue)\r\n\t\t\t\tminLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tif (maxLineValue < baseLineValue)\r\n\t\t\t\tmaxLineValue = baseLineValue;\r\n\t\t\t\r\n//\t\t\tif (baseLineValue < minLineValue)\r\n//\t\t\t\tbaseLineValue = minLineValue;\r\n//\t\t\t\r\n//\t\t\tif (baseLineValue > maxLineValue)\r\n//\t\t\t\tbaseLineValue = maxLineValue;\t\t\t\r\n\t\t\t\r\n\t\t\tvar formatDecimal = d3.format(\".2f\");\r\n\t\t\t\r\n\t\t\tvar yScale = d3.scaleLinear()\r\n\t\t\t\t\t\t.domain([maxLineValue, minLineValue])\r\n\t\t\t\t\t\t.range([10, h])\r\n\t\t\t\t\t\t.nice();\r\n\r\n\t\t\tvar svg = d3.select('.' + className);\r\n\r\n//\t\t\t// DEBUG\r\n//\t\t\tsvg.append(\"rect\")\r\n//\t\t\t\t.attr(\"x\", 0)\r\n//\t\t\t\t.attr(\"y\", 0) \r\n//\t\t\t\t.attr(\"width\", $container.width())\r\n//\t\t\t\t.attr(\"height\", $container.height())\r\n//\t\t\t\t.attr(\"fill\", \"yellow\");\r\n\r\n\r\n\r\n\t\t\t\r\n\t\t\tfunction hLine(y, color) {\t\r\n\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t.attr(\"x1\", leftMargin)\r\n\t\t\t\t\t.attr(\"y1\", yScale(y))\r\n\t\t\t\t\t.attr(\"x2\", w + leftMargin)\r\n\t\t\t\t\t.attr(\"y2\", yScale(y));\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\tif(this.panel.ShowBaseLine)\r\n\t\t\t\thLine(baseLineValue, this.panel.BaseLineColor);\r\n\r\n\t\t\tif(this.panel.ShowMaxLine)\r\n\t\t\t\thLine(maxLineValue, this.panel.MaxLineColor);\r\n\r\n\t\t\tif(this.panel.ShowMinLine)\r\n\t\t\t\thLine(minLineValue, this.panel.MinLineColor);\r\n\r\n\t\t\tif(this.panel.ShowHighLimitLine)\r\n\t\t\t\thLine(highLimitValue, this.panel.HighLimitLineColor);\r\n\r\n\t\t\tif(this.panel.ShowLowLimitLine)\r\n\t\t\t\thLine(lowLimitValue, this.panel.LowLimitLineColor);\r\n\r\n\t\t\t\r\n\t\t\tsvg.selectAll(\"rect\")\r\n\t\t\t\t.data(this.rows)\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append(\"rect\")\r\n\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t.attr(\"x\", function(d, i) { return leftMargin + (barPadding / 2) + (i * dw); })\r\n\t\t\t\t.attr(\"y\", function(d) { \r\n\t\t\t\t\t\treturn d3.min([yScale(d[valueCol]), yScale(baseLineValue)]); \r\n\t\t\t\t\t})\r\n\t\t\t\t.attr(\"width\", dw - barPadding)\r\n\t\t\t\t.attr(\"height\", function(d) { \r\n\t\t\t\t\t\tvar hh = yScale(baseLineValue) - yScale(d[valueCol]);\r\n\t\t\t\t\t\tif (hh < 0)\r\n\t\t\t\t\t\t\thh = -hh;\r\n\t\t\t\t\t\treturn hh; \r\n\t\t\t\t\t})\r\n\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] > highLimitValue))\r\n\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] < lowLimitValue))\r\n\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\treturn (yScale(d[valueCol]) < yScale(baseLineValue)) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t})\r\n\t\t\t\t.classed(\"flash\", function(d) { \r\n\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] > highLimitValue))\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] < lowLimitValue))\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\tvar g = svg.selectAll(\"text\")\r\n\t\t\t\t.data(this.rows)\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append(\"g\");\r\n\t\t\t\t\r\n\t\t\t\tif (this.panel.ShowValues) {\r\n\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) { return formatDecimal(d[valueCol]); })\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return leftMargin + (dw / 2) + (i * dw); })\r\n\t\t\t\t\t.attr(\"y\", function(d) { return yScale(d[valueCol]) + 14; })\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.ValueFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.ValueColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.panel.ShowLabels) {\r\n\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return leftMargin + (dw / 2) + (i * dw); })\r\n\t\t\t\t\t.attr(\"y\", function(d) { return h + 14; })\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.LabelFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.LabelColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\");\r\n\t\t\t\t}\r\n\r\n\t\t\tif (leftMargin > 0) {\t\r\n\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t.attr('transform', 'translate(' + leftMargin + ', 0)')\r\n\t\t\t\t\t.classed('michaeldmoore-multistat-panel-yaxis', true)\r\n\t\t\t\t\t.call(d3.axisLeft(yScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (rightMargin > 0) {\t\r\n\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t.attr('transform', 'translate(' + (leftMargin + w) + ', 0)')\r\n\t\t\t\t\t.classed('michaeldmoore-multistat-panel-yaxis', true)\r\n\t\t\t\t\t.call(d3.axisRight(yScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t}\r\n\r\n//\t\t\t// DEBUG\r\n//\t\t\tvar xScale = d3.scaleLinear()\r\n//\t\t\t\t.domain([0, 100])\r\n//\t\t\t\t.range([0, $container.width()]);\r\n//\r\n//\t\t\tsvg.append(\"g\")\r\n//\t\t\t\t.attr('transform', 'translate(0, 50)')\r\n//\t\t\t\t.classed('michaeldmoore-multistat-panel-yaxis', true)\r\n//\t\t\t\t.call(d3.axisBottom(xScale).tickSizeInner(10).tickSizeOuter(40).ticks(50));\r\n\r\n\r\n\r\n\t\t}\r\n\t\t\r\n        this.ctrl.renderingCompleted();\r\n    }\r\n\r\n\r\n    onDataReceived(dataList) {\r\n\t\tif (dataList.length == 0){\r\n\t\t\tthis.elem.html(\"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show</div>\");\r\n\t\t\tthis.rows = null;\r\n\t\t\tthis.cols = [];\r\n\t\t}\r\n\t\telse if (dataList[0].type == \"table\"){\r\n\t\t\tthis.rows = dataList[0].rows;\r\n\t\t\tthis.parseCols(dataList[0].columns);\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\telse {\r\n          this.alertSrv.set('Multistat Data Error', 'Query type \"' + dataList[0].Type + '\", not supported', 'error', 5000);\r\n\t\t}\r\n    }\r\n\r\n\tparseCols(cols){\r\n\t\tthis.cols = [];\r\n\t\tfor(var i=0; i < cols.length; i++){\r\n\t\t\tthis.cols[i] = cols[i].text;\r\n//\t\t\tif (cols[i].text == this.panel.DateTimeColName)\r\n//\t\t\t\tthis.DateTimeCol = i;\r\n//\t\t\tif (cols[i].text == this.panel.LabelColName)\r\n//\t\t\t\tthis.LabelCol = i;\r\n//\t\t\tif (cols[i].text == this.panel.ValueColName)\r\n//\t\t\t\tthis.ValueCol = i;\r\n\t\t}\r\n\t}\r\n\r\n    onConfigChanged() {\r\n        this.refresh();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        this.ctrl = ctrl;\r\n        this.elem = elem.find('.panel-content');\r\n    }\r\n}\r\n\r\nMultistatPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n    MultistatPanelCtrl as PanelCtrl\r\n};\r\n"]}