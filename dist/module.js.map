{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","$","angular","d3","kbn","config","TimeSeries","MultistatPanelCtrl","$scope","$injector","alertSrv","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","err","set","seriesList","render","metricNames","sortDirections","fontSizes","addEditorTab","dateTimeCol","$title","closest","find","$maxDate","length","append","children","last","ShowDate","maxDate","rows","i","text","show","hide","labelCol","valueCol","sortCol","cols","DateTimeColName","LabelColName","ValueColName","SortColName","SortDirection","ascending","sort","x","y","comp","anyHighFlash","anyLowFlash","buildDateHtml","horizontal","Horizontal","className","id","html","height","$container","labelMargin","isNumeric","LabelMargin","lowSideMargin","LowSideMargin","highSideMargin","HighSideMargin","svg","select","h","w","width","dw","barPadding","BarPadding","baseLineValue","BaseLineValue","minLineValue","MinLineValue","maxLineValue","MaxLineValue","highBarColor","HighBarColor","lowBarColor","LowBarColor","highLimitValue","HighLimitValue","HighLimitBarColor","HighLimitBarFlashColor","HighLimitBarFlashTimeout","recolorHighLimitBar","RecolorHighLimitBar","lowLimitValue","LowLimitValue","LowLimitBarColor","LowLimitBarFlashColor","LowLimitBarFlashTimeout","recolorLowLimitBar","RecolorLowLimitBar","flashHighLimitBar","FlashHighLimitBar","flashLowLimitBar","FlashLowLimitBar","min","d","max","formatDecimal","format","vLine","value","color","style","attr","valueScale","scaleLinear","domain","range","nice","labelScale","scaleBand","map","rangeRound","padding","ShowBaseLine","BaseLineColor","ShowMaxLine","MaxLineColor","ShowMinLine","MinLineColor","ShowHighLimitLine","HighLimitLineColor","ShowLowLimitLine","LowLimitLineColor","selectAll","data","enter","ww","bandwidth","classed","g","ShowValues","ValueFontSize","LabelColor","ShowLabels","LabelFontSize","call","axisTop","axisBottom","hLine","hh","ValueColor","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","pulse","highFlashRects","highRepeat","transition","duration","lowFlashRects","lowRepeat","renderingCompleted","dataList","type","parseCols","columns","Type","refresh","scope","attrs","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {\r\n    MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\n\r\nimport \"./css/multistat-panel.css!\";\r\n\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport angular from 'angular';\r\nimport * as d3 from './external/d3';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n\r\n    /** @ngInject */\r\n    constructor($scope, $injector, alertSrv) {\r\n        super($scope, $injector);\r\n\r\n        this.alertSrv = alertSrv;\r\n\r\n        var panelDefaults = {\r\n\t\t\t\"Horizontal\": false,\r\n\t\t\t\"ShowValues\": true,\r\n\t\t\t\"ValueFontSize\": \"100%\",\r\n\t\t\t\"ValueColor\": \"white\",\r\n\t\t\t\"ShowLabels\": true,\r\n\t\t\t\"LabelFontSize\": \"100%\",\r\n\t\t\t\"LabelColor\": \"white\",\r\n\t\t\t\"HighLimitValue\": \"\",\r\n\t\t\t\"HighLimitLineColor\": \"red\",\r\n\t\t\t\"ShowHighLimitLine\": false,\r\n\t\t\t\"RecolorHighLimitBar\": false,\r\n\t\t\t\"HighLimitBarColor\": \"red\",\r\n\t\t\t\"HighLimitBarFlashColor\": \"orange\",\r\n\t\t\t\"HighLimitBarFlashTimeout\": 200,\r\n\t\t\t\"FlashHighLimitBar\": true,\r\n\t\t\t\"LowLimitLineColor\": \"red\",\r\n\t\t\t\"ShowLowLimitLine\": false,\r\n\t\t\t\"RecolorLowLimitBar\": false,\r\n\t\t\t\"LowLimitBarColor\": \"red\",\r\n\t\t\t\"LowLimitBarFlashColor\": \"orange\",\r\n\t\t\t\"LowLimitBarFlashTimeout\": 200,\r\n\t\t\t\"FlashLowLimitBar\": true,\r\n\t\t\t\"ShowDate\": true,\r\n\t\t\t\"ShowLeftAxis\": true,\r\n\t\t\t\"ShowRightAxis\": true,\r\n\t\t\t\"ShowBaseLine\": true,\r\n\t\t\t\"BaseLineValue\": \"\",\r\n\t\t\t\"BaseLineColor\": \"red\",\r\n\t\t\t\"HighBarColor\": \"teal\",\r\n\t\t\t\"LowBarColor\": \"teal\",\r\n\t\t\t\"MinLineValue\": \"\",\r\n\t\t\t\"MaxLineValue\": \"\",\r\n\t\t\t\"SortDirection\": \"none\"\r\n        };\r\n\r\n        var panel = {};\r\n        var elem = {};\r\n        var ctrl = {};\r\n\r\n        _.defaults(this.panel, panelDefaults);\r\n\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    }\r\n\r\n    onDataError(err) {\r\n        this.alertSrv.set('Multistat Data Error', err, 'error', 5000);\r\n        this.seriesList = [];\r\n        this.render([]);\r\n    }\r\n\r\n    onInitEditMode() {\r\n\t\tthis.metricNames = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\r\n\t\tthis.sortDirections = ['none', 'ascending', 'decending'];\r\n        this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\r\n        this.addEditorTab('Options', 'public/plugins/michaeldmoore-multistat-panel/options.html', 2);\r\n    }\r\n\r\n\tbuildDateHtml(dateTimeCol){\r\n\t\tvar $title = this.elem.closest('.panel-container').find('.panel-title.drag-handle.pointer');\r\n\t\tvar $maxDate = $title.find('span.michaeldmoore-multistat-panel-maxDate');\r\n\r\n\t\tif($maxDate.length == 0)\r\n\t\t\t$maxDate = $title.append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>').children().last();\r\n\r\n\t\tif (this.panel.ShowDate) {\r\n\t\t\tvar maxDate = this.rows[0][dateTimeCol];\r\n\r\n\t\t\tfor(var i = 1; i < this.rows.length; i++){\r\n\t\t\t\tif (maxDate < this.rows[i][dateTimeCol])\r\n\t\t\t\t\tmaxDate = this.rows[i][dateTimeCol];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$maxDate.text(maxDate).show();\r\n//\t\t\t$maxDate.text(d3.max(function(d) { return d[dateTimeCol]; })).show();\r\n\t\t}\r\n\t\telse\r\n\t\t\t$maxDate.hide();\t\t\t\r\n\t}\r\n\r\n\r\n\t\r\n    onRender() {\r\n\t\tif (this.rows != null) {\r\n\t\t\tvar dateTimeCol = 0;\r\n\t\t\tvar labelCol = 0;\r\n\t\t\tvar valueCol = 0;\r\n\t\t\tvar sortCol = 0;\r\n\t\t\tfor(var i=0; i < this.cols.length; i++){\r\n\t\t\t\tif (this.cols[i] == this.panel.DateTimeColName)\r\n\t\t\t\t\tdateTimeCol = i;\r\n\t\t\t\tif (this.cols[i] == this.panel.LabelColName)\r\n\t\t\t\t\tlabelCol = i;\r\n\t\t\t\tif (this.cols[i] == this.panel.ValueColName)\r\n\t\t\t\t\tvalueCol = i;\r\n\t\t\t\tif (this.cols[i] == this.panel.SortColName)\r\n\t\t\t\t\tsortCol = i;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.panel.SortDirection != \"none\"){\r\n\t\t\t\tvar ascending = this.panel.SortDirection == \"ascending\";\r\n\t\t\t\tthis.rows.sort(function(x, y){\r\n\t\t\t\t\tvar comp = (x[sortCol] == y[sortCol]) ? 0 : ((x[sortCol] > y[sortCol]) ? 1 : -1);\r\n\t\t\t\t\treturn ascending ? comp : -comp;\r\n\t\t\t\t});\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar anyHighFlash = false;\r\n\t\t\tvar anyLowFlash = false;\r\n\t\t\t\r\n\t\t\tthis.buildDateHtml(dateTimeCol);\r\n\t\t\t\r\n\t\t\tvar horizontal = this.panel.Horizontal;\r\n\t\t\t\r\n\t\t\tvar className = 'michaeldmoore-multistat-panel-' + this.panel.id;\r\n\t\t\tthis.elem.html(\"<svg class='\" + className + \"'  style='height:\" + this.ctrl.height + \"px; width:100%'></svg>\");\r\n\t\t\tvar $container = this.elem.find('.' + className);\r\n\t\t\tvar labelMargin = ($.isNumeric(this.panel.LabelMargin) && this.panel.LabelMargin >= 0) ? this.panel.LabelMargin : (horizontal ? 100 : 20);\r\n\t\t\tvar lowSideMargin = this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\r\n\t\t\tvar highSideMargin = this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\r\n\r\n\t\t\tvar svg = d3.select('.' + className).append('svg');\t\t\t\r\n\r\n\t\t\tvar h = $container.height();\r\n\t\t\tvar w = $container.width() - 5;\r\n\t\t\tvar dw = (w  - lowSideMargin - highSideMargin) / this.rows.length;\r\n\t\t\tvar barPadding = this.panel.BarPadding;\r\n\t\t\tvar baseLineValue = this.panel.BaseLineValue;\r\n\t\t\tvar minLineValue = this.panel.MinLineValue;\r\n\t\t\tvar maxLineValue = this.panel.MaxLineValue;\r\n\t\t\tvar highBarColor = this.panel.HighBarColor;\r\n\t\t\tvar lowBarColor = this.panel.LowBarColor;\r\n\t\t\tvar highLimitValue = this.panel.HighLimitValue;\r\n\t\t\tvar HighLimitBarColor = this.panel.HighLimitBarColor;\r\n\t\t\tvar HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\r\n\t\t\tvar HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\r\n\t\t\tvar recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n\t\t\tvar lowLimitValue = this.panel.LowLimitValue;\r\n\t\t\tvar LowLimitBarColor = this.panel.LowLimitBarColor;\r\n\t\t\tvar LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\r\n\t\t\tvar LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\r\n\t\t\tvar recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n\t\t\tvar flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n\t\t\tvar flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(barPadding) == false)\r\n\t\t\t\tbarPadding = dw * 0.10;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(HighLimitBarFlashTimeout) == false)\r\n\t\t\t\tHighLimitBarFlashTimeout = 200;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(LowLimitBarFlashTimeout) == false)\r\n\t\t\t\tLowLimitBarFlashTimeout = 200;\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(minLineValue) == false)\r\n\t\t\t\tminLineValue = d3.min(this.rows, function(d) { return d[valueCol]; });\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(maxLineValue) == false)\r\n\t\t\t\tmaxLineValue = d3.max(this.rows, function(d) { return d[valueCol]; });\r\n\t\t\t\r\n\t\t\tif ($.isNumeric(baseLineValue) == false)\r\n\t\t\t\tbaseLineValue = 0;\r\n\t\t\t\r\n\t\t\tif (minLineValue > baseLineValue)\r\n\t\t\t\tminLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tif (maxLineValue < baseLineValue)\r\n\t\t\t\tmaxLineValue = baseLineValue;\r\n\t\t\t\r\n\t\t\tvar formatDecimal = d3.format(\".2f\");\r\n\r\n\t\t\tif(horizontal) {\r\n\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t\t.domain([minLineValue, maxLineValue])\r\n\t\t\t\t\t\t\t.range([labelMargin, w])\r\n\t\t\t\t\t\t\t.nice();\r\n\t\t\t\t\r\n\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t.domain(this.rows.map(function(d){ return d[labelCol]; }))\r\n\t\t\t\t\t\t\t.rangeRound([lowSideMargin, h - highSideMargin])\r\n\t\t\t\t\t\t\t.padding(barPadding / 100);\r\n\t\t\t\r\n\t\t\t\tfunction vLine(value, color) {\t\r\n\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t.attr(\"y1\", lowSideMargin)\r\n\t\t\t\t\t\t.attr(\"x1\", valueScale(value))\r\n\t\t\t\t\t\t.attr(\"y2\", h - highSideMargin)\r\n\t\t\t\t\t\t.attr(\"x2\", valueScale(value));\r\n\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\tif(this.panel.ShowBaseLine)\r\n\t\t\t\t\tvLine(baseLineValue, this.panel.BaseLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMaxLine)\r\n\t\t\t\t\tvLine(maxLineValue, this.panel.MaxLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMinLine)\r\n\t\t\t\t\tvLine(minLineValue, this.panel.MinLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowHighLimitLine)\r\n\t\t\t\t\tvLine(highLimitValue, this.panel.HighLimitLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowLowLimitLine)\r\n\t\t\t\t\tvLine(lowLimitValue, this.panel.LowLimitLineColor);\r\n\r\n\t\t\t\tsvg.selectAll(\"rect\")\r\n\t\t\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t\t\t.attr(\"width\", function(d) { \r\n\t\t\t\t\t\t\t\t\tvar ww = valueScale(d[valueCol]) - valueScale(baseLineValue);\r\n\t\t\t\t\t\t\t\t\tif (ww < 0)\r\n\t\t\t\t\t\t\t\t\t\tww = -ww;\r\n\t\t\t\t\t\t\t\t\treturn ww; \r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.attr(\"height\", labelScale.bandwidth())\r\n\t\t\t\t\t\t\t.attr(\"x\", function(d) { \r\n\t\t\t\t\t\t\t\t\treturn d3.min([valueScale(d[valueCol]), valueScale(baseLineValue)]); \r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol])})\r\n\t\t\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] > highLimitValue))\r\n\t\t\t\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] < lowLimitValue))\r\n\t\t\t\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\t\t\t\treturn (d[valueCol] > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.classed(\"highflash\", function(d) { \r\n\t\t\t\t\t\t\t\t\tif (flashHighLimitBar && (d[valueCol] > highLimitValue)){\r\n\t\t\t\t\t\t\t\t\t\tanyHighFlash = true;\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.classed(\"lowflash\", function(d) { \r\n\t\t\t\t\t\t\t\t\tif (flashLowLimitBar && (d[valueCol] < lowLimitValue)){\r\n\t\t\t\t\t\t\t\t\t\tanyLowFlash = true;\r\n\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\tvar g = svg.selectAll(\"text\")\r\n\t\t\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t.append(\"g\");\r\n\t\t\t\t\t\r\n\t\t\t\tif (this.panel.ShowValues) {\r\n\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) {return formatDecimal(d[valueCol])})\r\n\t\t\t\t\t.attr(\"x\", function(d){\r\n\t\t\t\t\t\t\treturn valueScale(d[valueCol]) + ((d[valueCol] > baseLineValue) ? - 5 : + 5);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.ValueFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.LabelColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", function(d){\r\n\t\t\t\t\t\t\treturn (d[valueCol] > baseLineValue) ? \"end\" : \"start\";\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.panel.ShowLabels) {\r\n\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t.attr(\"x\", labelMargin / 2)\r\n\t\t\t\t\t.attr(\"y\", function(d,i){return labelScale(d[labelCol]) + (labelScale.bandwidth() / 2)})\r\n\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t.attr(\"font-size\", this.panel.LabelFontSize)\r\n\t\t\t\t\t.attr(\"fill\", this.panel.LabelColor)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//Add Low Side Value Axis (X)\r\n\t\t\t\tif (lowSideMargin > 0) {\t\r\n\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t\t.attr(\"transform\", 'translate(0,' + lowSideMargin + ')')\r\n\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t.call(d3.axisTop(valueScale));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//Add High Side Value Axis (X)\r\n\t\t\t\tif (highSideMargin > 0) {\t\r\n\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t\t.attr(\"transform\", 'translate(0,' + (h - highSideMargin) + ')')\r\n\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t.call(d3.axisBottom(valueScale));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t\t.domain([maxLineValue, minLineValue])\r\n\t\t\t\t\t\t\t.range([0, h - labelMargin])\r\n\t\t\t\t\t\t\t.nice();\r\n\t\t\t\t\r\n\t\t\t\tfunction hLine(value, color) {\t\r\n\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t.attr(\"x1\", lowSideMargin)\r\n\t\t\t\t\t\t.attr(\"y1\", valueScale(value))\r\n\t\t\t\t\t\t.attr(\"x2\", w - highSideMargin)\r\n\t\t\t\t\t\t.attr(\"y2\", valueScale(value));\r\n\t\t\t\t}\t\t\t\r\n\r\n\t\t\t\tif(this.panel.ShowBaseLine)\r\n\t\t\t\t\thLine(baseLineValue, this.panel.BaseLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMaxLine)\r\n\t\t\t\t\thLine(maxLineValue, this.panel.MaxLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowMinLine)\r\n\t\t\t\t\thLine(minLineValue, this.panel.MinLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowHighLimitLine)\r\n\t\t\t\t\thLine(highLimitValue, this.panel.HighLimitLineColor);\r\n\r\n\t\t\t\tif(this.panel.ShowLowLimitLine)\r\n\t\t\t\t\thLine(lowLimitValue, this.panel.LowLimitLineColor);\r\n\r\n\t\t\t\t\r\n\t\t\t\tsvg.selectAll(\"rect\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t.attr(\"x\", function(d, i) { return lowSideMargin + (barPadding / 2) + (i * dw); })\r\n\t\t\t\t\t.attr(\"y\", function(d) { \r\n\t\t\t\t\t\t\treturn d3.min([valueScale(d[valueCol]), valueScale(baseLineValue)]); \r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"width\", dw - barPadding)\r\n\t\t\t\t\t.attr(\"height\", function(d) { \r\n\t\t\t\t\t\t\tvar hh = valueScale(baseLineValue) - valueScale(d[valueCol]);\r\n\t\t\t\t\t\t\tif (hh < 0)\r\n\t\t\t\t\t\t\t\thh = -hh;\r\n\t\t\t\t\t\t\treturn hh; \r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"fill\", function(d) { \r\n\t\t\t\t\t\t\tif (recolorHighLimitBar && (d[valueCol] > highLimitValue))\r\n\t\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\t\tif (recolorLowLimitBar && (d[valueCol] < lowLimitValue))\r\n\t\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\t\treturn (d[valueCol] > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.classed(\"highflash\", function(d) { \r\n\t\t\t\t\t\t\tif (flashHighLimitBar && (d[valueCol] > highLimitValue)){\r\n\t\t\t\t\t\t\t\tanyHighFlash = true;\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t.classed(\"lowflash\", function(d) { \r\n\t\t\t\t\t\t\tif (flashLowLimitBar && (d[valueCol] < lowLimitValue)){\r\n\t\t\t\t\t\t\t\tanyLowFlash = true;\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\tvar g = svg.selectAll(\"text\")\r\n\t\t\t\t\t.data(this.rows)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"g\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.panel.ShowValues) {\r\n\t\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t\t.text(function(d) { return formatDecimal(d[valueCol]); })\r\n\t\t\t\t\t\t.attr(\"x\", function(d, i) { return lowSideMargin + (dw / 2) + (i * dw); })\r\n\t\t\t\t\t\t.attr(\"y\", function(d){\r\n\t\t\t\t\t\t\treturn valueScale(d[valueCol]) + ((d[valueCol] > baseLineValue) ? 5 : -5);\r\n\t\t\t\t\t\t})\t\t\t\t\t\t\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", this.panel.ValueFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", this.panel.ValueColor)\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t.attr(\"dominant-baseline\", function(d){return (d[valueCol] > baseLineValue) ? \"text-before-edge\" : \"text-after-edge\"});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.panel.ShowLabels) {\r\n\t\t\t\t\t\tg.append(\"text\")\r\n\t\t\t\t\t\t.text(function(d) { return d[labelCol]; })\r\n\t\t\t\t\t\t.attr(\"x\", function(d, i) { return lowSideMargin + (dw / 2) + (i * dw); })\r\n\t\t\t\t\t\t.attr(\"y\", function(d) { return h - labelMargin + 14; })\r\n\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t.attr(\"font-size\", this.panel.LabelFontSize)\r\n\t\t\t\t\t\t.attr(\"fill\", this.panel.LabelColor)\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\tif (lowSideMargin > 0) {\t\r\n\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t.attr('transform', 'translate(' + lowSideMargin + ', 0)')\r\n\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t.call(d3.axisLeft(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (highSideMargin > 0) {\t\r\n\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t.attr('transform', 'translate(' + (w - highSideMargin) + ', 0)')\r\n\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t.call(d3.axisRight(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction pulse() {\r\n\t\t\tvar highFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\");\r\n\t\t\t(function highRepeat() {\r\n\t\t\t\thighFlashRects.transition()\r\n\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t.attr(\"fill\", HighLimitBarColor)\r\n\t\t\t\t.transition()\r\n\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t.attr(\"fill\", HighLimitBarFlashColor)\r\n\t\t\t\t.on(\"end\", highRepeat);\r\n\t\t\t})();\r\n\r\n\t\t\tvar lowFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\");\r\n\t\t\t(function lowRepeat() {\r\n\t\t\t\tlowFlashRects.transition()\r\n\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t.attr(\"fill\", LowLimitBarColor)\r\n\t\t\t\t.transition()\r\n\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t.attr(\"fill\", LowLimitBarFlashColor)\r\n\t\t\t\t.on(\"end\", lowRepeat);\r\n\t\t\t})();\r\n\t\t}\r\n\r\n\t\tpulse();\r\n\t\t\r\n        this.ctrl.renderingCompleted();\r\n    }\r\n\r\n\r\n    onDataReceived(dataList) {\r\n\t\tif (dataList.length == 0){\r\n\t\t\tthis.elem.html(\"<div style='position:absolute;top:50%;text-align:center;font-size:0.875rem;'>No data to show</div>\");\r\n\t\t\tthis.rows = null;\r\n\t\t\tthis.cols = [];\r\n\t\t}\r\n\t\telse if (dataList[0].type == \"table\"){\r\n\t\t\tthis.rows = dataList[0].rows;\r\n\t\t\tthis.parseCols(dataList[0].columns);\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t\telse {\r\n          this.alertSrv.set('Multistat Data Error', 'Query type \"' + dataList[0].Type + '\", not supported', 'error', 5000);\r\n\t\t}\r\n    }\r\n\r\n\tparseCols(cols){\r\n\t\tthis.cols = [];\r\n\t\tfor(var i=0; i < cols.length; i++){\r\n\t\t\tthis.cols[i] = cols[i].text;\r\n//\t\t\tif (cols[i].text == this.panel.DateTimeColName)\r\n//\t\t\t\tthis.DateTimeCol = i;\r\n//\t\t\tif (cols[i].text == this.panel.LabelColName)\r\n//\t\t\t\tthis.LabelCol = i;\r\n//\t\t\tif (cols[i].text == this.panel.ValueColName)\r\n//\t\t\t\tthis.ValueCol = i;\r\n\t\t}\r\n\t}\r\n\r\n    onConfigChanged() {\r\n        this.refresh();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        this.ctrl = ctrl;\r\n        this.elem = elem.find('.panel-content');\r\n    }\r\n}\r\n\r\nMultistatPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n    MultistatPanelCtrl as PanelCtrl\r\n};\r\n"]}