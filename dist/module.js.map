{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","$","_","moment","d3","appEvents","MultistatPanelCtrl","$scope","$injector","variableSrv","panelDefaults","defaults","panel","variables","forEach","console","log","v","name","current","value","updateNamedValue","split","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","onDataSnapshotLoad","className","id","obj","names","shift","length","Number","snapshotData","err","seriesList","data","displayStatusMessage","status","statusText","metricNames","sortDirections","aggregations","fontSizes","valuePositions","curveTypes","matchTypes","addEditorTab","cols","rows","render","type","columns","i","text","cols0","concat","emit","index","up","RecolorRules","ctrl","splice","Links","dateTimeCol","$title","elem","closest","find","$maxDate","append","children","last","ShowDate","maxDate","dd","add","TZOffsetHours","DateFormat","toUpperCase","fromNow","show","format","hide","msg","html","labelCol","valueCol","sortCol","groupCol","recolorCol","DateTimeColName","LabelColName","ValueColName","SortColName","GroupColName","RecolorColName","groupedLabelFunc","LabelNameFilter","regex","RegExp","matchingRows","label","match","push","Aggregate","oo","nest","key","rollup","d","entries","x","Object","values","assign","mean","Array","from","max","min","groupNameOffset","ShowGroupLabels","GroupLabelFontSize","replace","groupedRows","GroupNameFilter","regexGroupRows","matchingGroups","groupName","groupSortString","GroupSortString","sort","a","b","aPos","search","bPos","localeCompare","$container","h","height","w","width","buildDateHtml","horizontal","Horizontal","labelMargin","isNumeric","LabelMargin","lowSideMargin","LowSideMargin","highSideMargin","HighSideMargin","svg","select","selectAll","interrupt","barPadding","BarPadding","baseLineValue","BaseLineValue","minLineValue","MinLineValue","maxLineValue","MaxLineValue","highBarColor","HighBarColor","lowBarColor","LowBarColor","highLimitValue","HighLimitValue","HighLimitBarColor","HighLimitBarFlashColor","HighLimitBarFlashTimeout","recolorHighLimitBar","RecolorHighLimitBar","lowLimitValue","LowLimitValue","LowLimitBarColor","LowLimitBarFlashColor","LowLimitBarFlashTimeout","recolorLowLimitBar","RecolorLowLimitBar","flashHighLimitBar","FlashHighLimitBar","flashLowLimitBar","FlashLowLimitBar","showTooltips","ShowTooltips","TooltipDateFormat","ValueDecimals","OddRowColor","EvenRowColor","OutlineColor","GroupCols","GroupGap","ScaleFactor","LabelColor","ValuePosition","tooltipDivID","minValue","maxValue","remove","translateValues","s","s1","re","g","exec","getTooltipContent","cc","toFixed","l","url","newtab","isInTooltip","tooltipShow","attr","style","tooltipDiv","classed","tooltipHide","$tooltipDiv","www","hhh","transition","duration","event","pageX","pageY","cancel","scaleAndClipValue","val","getBarColor","recolorString","recolorRule","r","pattern","matchType","test","indexOf","color","Option","plotGroupHorizontal","numRows","left","hh","dh","SortDirection","ascending","y","GroupLabelColor","labels","map","Math","random","toString","substr","labelScale","scaleBand","domain","rangeRound","paddingInner","paddingOuter","stripedata","range","stripeScale","oddeven","enter","step","g1","ShowValues","maxValueWidth","bandwidth","ValueFontSize","ValueColor","each","thisWidth","getComputedTextLength","ShowLabels","maxLabelWidth","labelAngle","LableAngle","LabelFontSize","OutOfRangeLabelColor","bbox","getBBox","sin","PI","c","cos","abs","valueScale","scaleLinear","nice","vLine","strokeWidth","ShowBaseLine","BaseLineColor","BaseLineWidth","ShowMaxLine","MaxLineColor","MaxLineWidth","ShowMinLine","MinLineColor","MinLineWidth","ShowHighLimitLine","HighLimitLineColor","HighLimitLineWidth","ShowLowLimitLine","LowLimitLineColor","LowLimitLineWidth","ShowBars","ShowLines","LineWidth","points","bw","curveFunc","curveLinear","CurveType","curveMonotoneY","curveCardinal","curveCatmullRom","lineFunction","line","curve","lineGraph","LineColor","DotSize","DotColor","ggHighSide","call","axisTop","HighAxisColor","HighAxisWidth","ggLowSide","axisBottom","LowAxisColor","LowAxisWidth","gcols","dw","pointsPerRow","rr","floor","u","totalPoints","rowOverheadHeight","rowHeight","ceil","nn","ii","plotGroupVertical","g2","maxValueHeight","thisHeight","maxLabelHeight","hLine","curveMonotoneX","axisLeft","tickSizeInner","tickSizeOuter","ticks","axisRight","pointsPerCol","colOverheadWidth","colWidth","ww","pulseHigh","highFlashRects","_groups","highRepeat","active","pulseLow","lowFlashRects","lowRepeat","renderingCompleted","refresh","scope","attrs","panelContentElem","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["/*jshint esversion: 6 */\r\n/*jshint -W087 */\r\nimport {\r\n\tMetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport _ from 'lodash';\r\nimport moment from 'moment';\r\nimport \"./css/multistat-panel.css!\";\r\nimport d3 from './external/d3.min';\r\nimport {appEvents} from 'app/core/core';\r\n\r\nclass MultistatPanelCtrl extends MetricsPanelCtrl {\r\n\r\n\t/** @ngInject */\r\n\tconstructor($scope, $injector, variableSrv) {\r\n\t\t\tsuper($scope, $injector, variableSrv);\r\n\r\n\t\t\tvar panelDefaults = {\r\n\t\t\t\t\"timeFrom\": null,\r\n\t\t\t\t\"timeShift\": null,\r\n\t\t\t\t\"BarPadding\": 10,\r\n\t\t\t\t\"BaseLineColor\": \"#ff0000\",\r\n\t\t\t\t\"BaseLineWidth\": 1,\r\n\t\t\t\t\"BaseLineValue\": null,\r\n\t\t\t\t\"DateTimeColName\": \"date\",\r\n\t\t\t\t\"DateFormat\": \"YYYY-MM-DD HH:mm:ss\",\r\n\t\t\t\t\"TooltipDateFormat\": \"YYYY-MM-DD HH:mm:ss\",\r\n\t\t\t\t\"FlashHighLimitBar\": false,\r\n\t\t\t\t\"FlashLowLimitBar\": false,\r\n\t\t\t\t\"HighAxisColor\": \"#ffffff\",\r\n\t\t\t\t\"HighAxisWidth\": 1,\r\n\t\t\t\t\"HighBarColor\": \"rgb(120, 128, 0)\",\r\n\t\t\t\t\"RecolorColName\": null,\r\n\t\t\t\t\"HighLimitBarColor\": \"#ff0000\",\r\n\t\t\t\t\"HighLimitBarFlashColor\": \"#ffa500\",\r\n\t\t\t\t\"HighLimitBarFlashTimeout\": 1000,\r\n\t\t\t\t\"HighLimitLineColor\": \"#ff0000\",\r\n\t\t\t\t\"HighLimitValue\": null,\r\n\t\t\t\t\"HighLmitLineWidth\": 1,\r\n\t\t\t\t\"HighSideMargin\": 22,\r\n\t\t\t\t\"Horizontal\": false,\r\n\t\t\t\t\"LabelColName\": \"room\",\r\n\t\t\t\t\"LabelNameFilter\": \"\",\r\n\t\t\t\t\"LabelColor\": \"#ffffff\",\r\n\t\t\t\t\"OutOfRangeLabelColor\": \"#ffffff\",\r\n\t\t\t\t\"GroupLabelColor\": \"#ffffff\",\r\n\t\t\t\t\"LabelFontSize\": \"100%\",\r\n\t\t\t\t\"GroupLabelFontSize\": \"200%\",\r\n\t\t\t\t\"GroupGap\": 5,\r\n\t\t\t\t\"LabelMargin\": null,\r\n\t\t\t\t\"Links\": [],\r\n\t\t\t\t\"LowAxisColor\": \"#ffffff\",\r\n\t\t\t\t\"LowAxisWidth\": 1,\r\n\t\t\t\t\"LowBarColor\": \"teal\",\r\n\t\t\t\t\"LowLimitBarColor\": \"#ff0000\",\r\n\t\t\t\t\"LowLimitBarFlashColor\": \"#ffa500\",\r\n\t\t\t\t\"LowLimitBarFlashTimeout\": 200,\r\n\t\t\t\t\"LowLimitLineColor\": \"#ff0000\",\r\n\t\t\t\t\"LowLimitValue\": null,\r\n\t\t\t\t\"LowLmitLineWidth\": 1,\r\n\t\t\t\t\"LowSideMargin\": 22,\r\n\t\t\t\t\"MaxLineColor\": \"rgb(74, 232, 12)\",\r\n\t\t\t\t\"MaxLineWidth\": 1,\r\n\t\t\t\t\"MaxLineValue\": null,\r\n\t\t\t\t\"MinLineColor\": \"#ff0000\",\r\n\t\t\t\t\"MinLineWidth\": 1,\r\n\t\t\t\t\"MinLineValue\": null,\r\n\t\t\t\t\"RecolorHighLimitBar\": false,\r\n\t\t\t\t\"RecolorLowLimitBar\": false,\r\n\t\t\t\t\"RecolorRules\": [],\r\n\t\t\t\t\"ShowBaseLine\": false,\r\n\t\t\t\t\"ShowDate\": false,\r\n\t\t\t\t\"Aggregate\": \"last\",\r\n\t\t\t\t\"ShowHighLimitLine\": false,\r\n\t\t\t\t\"ShowLabels\": true,\r\n\t\t\t\t\"ShowGroupLabels\": true,\r\n\t\t\t\t\"ShowLeftAxis\": true,\r\n\t\t\t\t\"ShowLowLimitLine\": false,\r\n\t\t\t\t\"ShowMaxLine\": false,\r\n\t\t\t\t\"ShowMinLine\": false,\r\n\t\t\t\t\"ShowRightAxis\": true,\r\n\t\t\t\t\"ShowTooltips\": true,\r\n\t\t\t\t\"ShowValues\": true,\r\n\t\t\t\t\"SortColName\": \"value\",\r\n\t\t\t\t\"SortDirection\": \"ascending\",\r\n\t\t\t\t\"TZOffsetHours\": 0,\r\n\t\t\t\t\"ValueColName\": \"temperature\",\r\n\t\t\t\t\"ValueDecimals\": 2,\r\n\t\t\t\t\"ValueColor\": \"#ffffff\",\r\n\t\t\t\t\"ValueFontSize\": \"100%\",\r\n\t\t\t\t\"OddRowColor\": \"rgba(33, 33, 34, 0.92)\",\r\n\t\t\t\t\"EvenRowColor\": \"rgba(61, 61, 64, 0.78)\",\r\n\t\t\t\t\"OutlineColor\": \"rgba(245, 255, 0, 0.1)\",\r\n\t\t\t\t\"GroupSortString\": \"\",\r\n\t\t\t\t\"GroupCols\": 0,\r\n\t\t\t\t\"GroupNameFilter\": \"\",\r\n\t\t\t\t\"ScaleFactor\": 1,\r\n\t\t\t\t\"ValuePosition\": \"top\",\r\n\t\t\t\t\"LableAngle\": 0,\r\n\t\t\t\t\"ShowBars\": true,\r\n\t\t\t\t\"ShowLines\": false,\r\n\t\t\t\t\"LineWidth\": 5,\r\n\t\t\t\t\"LineColor\": \"blue\",\r\n\t\t\t\t\"DotSize\": 10,\r\n\t\t\t\t\"DotColor\": \"white\",\r\n\t\t\t\t\"CurveType\": \"Monotone\"\r\n\t\t\t};\r\n\r\n\t\t\t_.defaults(this.panel, panelDefaults);\r\n\r\n\t\t\tvariableSrv.variables.forEach(v => {\r\n\t\t\t\tconsole.log(\"dashboard variable[\"+v.name+\"]=\"+v.current.value);\r\n\t\t\t\tthis.updateNamedValue(this.panel, v.name.split('_'), v.current.value);\r\n\t\t\t});\r\n\r\n\t\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\t\tthis.events.on('data-error', this.onDataError.bind(this));\r\n\t\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\t\tthis.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\r\n\r\n\t\t\tthis.className = 'michaeldmoore-multistat-panel-' + this.panel.id;\r\n\t}\r\n\r\n\tupdateNamedValue(obj, names, value) {\r\n\t\tlet name = names.shift();\r\n\t\tif (obj[name]) {\r\n\t\t\t\tif (names.length)\r\n\t\t\t\t\t\tthis.updateNamedValue(obj[name], names, value);\r\n\t\t\t\telse\r\n\t\t\t\t\t\tobj[name] = Number(value);\r\n\t\t}\r\n\t}\r\n\r\n\tonDataSnapshotLoad(snapshotData) {\r\n\t\tthis.onDataReceived(snapshotData);\r\n\t}\r\n\r\n\tonDataError(err) {\r\n\t\t\tthis.seriesList = [];\r\n\t\t\tthis.data = [];\r\n\t\t\tthis.displayStatusMessage(\"Query failure, Status=\" + err.status + \", \" + err.statusText);\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\t\tthis.metricNames = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\r\n\t\t\tthis.sortDirections = ['none', 'ascending', 'descending'];\r\n\t\t\tthis.aggregations = ['all', 'last', 'first', 'mean', 'max', 'min'];\r\n\t\t\tthis.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%', '250%', '300%', '350%', '400%'];\r\n\t\t\tthis.valuePositions = ['bar base', 'bar end', 'top'];\r\n\t\t\tthis.curveTypes = ['Linear', 'Monotone', 'Cardinal', 'Catmull-Rom'];\r\n\t\t\tthis.matchTypes = ['exact', 'subset', 'list', 'reg-ex'];\r\n\t\t\tthis.addEditorTab('Columns', 'public/plugins/michaeldmoore-multistat-panel/columns.html', 2);\r\n\t\t\tthis.addEditorTab('Layout', 'public/plugins/michaeldmoore-multistat-panel/layout.html', 3);\r\n\t\t\tthis.addEditorTab('Grouping', 'public/plugins/michaeldmoore-multistat-panel/grouping.html', 4);\r\n\t\t\tthis.addEditorTab('Options', 'public/plugins/michaeldmoore-multistat-panel/options.html', 5);\r\n\t\t\tthis.addEditorTab('Lines-and-Limits', 'public/plugins/michaeldmoore-multistat-panel/linesandlimits.html', 6);\r\n\t\t\tthis.addEditorTab('Bar links', 'public/plugins/michaeldmoore-multistat-panel/barlinks.html', 7);\r\n\t}\r\n\r\n\tonDataReceived(data) {\r\n\t\t\tthis.cols = [];\r\n\t\t\t// console.log('onDataReceived(' + JSON.stringify(data) + ')');\r\n\t\t\tif (data.length == 0) {\r\n\t\t\t\t\tthis.displayStatusMessage(\"No data to show\");\r\n\t\t\t\t\tthis.data = data;\r\n\t\t\t\t\tthis.rows = null;\r\n\t\t\t\t\tthis.render();\r\n\t\t\t} else if (data[0].type == \"table\" || data[0].columns) {\r\n\t\t\t\t\tthis.data = data[0];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.data.columns.length; i++)\r\n\t\t\t\t\t\t\tthis.cols[i] = this.data.columns[i].text;\r\n\t\t\t\t\tthis.cols0 = [''].concat(this.cols);\r\n\r\n\t\t\t\t\tthis.render();\r\n\t\t\t} else {\r\n\t\t\t\t\tappEvents.emit('alert-error', ['Non-Table type data received', 'Multistat does not support Time Series data sets']);\r\n\t\t\t}\r\n\t}\r\n\r\n\tonReorderRecolorRules(index, up) {\r\n\t\tconst RecolorRules = this.ctrl.panel.RecolorRules;\r\n\t\tif (up) {\r\n\t\t\tif (index)\r\n\t\t\t\tRecolorRules[index] = RecolorRules.splice(index-1, 1, RecolorRules[index])[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (index+1 < RecolorRules.length)\r\n\t\t\t\tRecolorRules[index] = RecolorRules.splice(index+1, 1, RecolorRules[index])[0];\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonReorderLinks(index, up) {\r\n\t\tconst Links = this.ctrl.panel.Links;\r\n\t\tif (up) {\r\n\t\t\tif (index)\r\n\t\t\t\tLinks[index] = Links.splice(index-1, 1, Links[index])[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (index+1 < Links.length)\r\n\t\t\t\tLinks[index] = Links.splice(index+1, 1, Links[index])[0];\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tbuildDateHtml(dateTimeCol) {\r\n\t\t\tvar $title = this.elem.closest('.panel-container').find('.panel-title');\r\n\t\t\tvar $maxDate = $title.find('span.michaeldmoore-multistat-panel-maxDate');\r\n\r\n\t\t\tif ($maxDate.length == 0)\r\n\t\t\t\t\t$maxDate = $title.append('<span class=\"michaeldmoore-multistat-panel-maxDate\"/>').children().last();\r\n\r\n\t\t\tif (dateTimeCol != -1 && this.panel.ShowDate) {\r\n\t\t\t\t\tvar maxDate = this.rows[0][dateTimeCol];\r\n\r\n\t\t\t\t\tfor (let i = 1; i < this.rows.length; i++) {\r\n\t\t\t\t\t\t\tif (maxDate < this.rows[i][dateTimeCol])\r\n\t\t\t\t\t\t\t\t\tmaxDate = this.rows[i][dateTimeCol];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar dd = moment(maxDate).add(this.panel.TZOffsetHours, 'h');\r\n\r\n\t\t\t\t\tif (this.panel.DateFormat.toUpperCase() == 'ELAPSED')\r\n\t\t\t\t\t\t\t$maxDate.text(dd.fromNow()).show();\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\t\t$maxDate.text(dd.format(this.panel.DateFormat)).show();\r\n\t\t\t} else\r\n\t\t\t\t\t$maxDate.hide();\r\n\t}\r\n\r\n\tdisplayStatusMessage(msg) {\r\n\t\t\tthis.elem.html(\"<div class='michaeldmoore-multistat-panel-statusmessage'>\" + msg + \"</div>\");\r\n\t}\r\n\r\n\tonRender() {\r\n\t\t\tif (this.data != null && this.data.rows && this.data.rows.length) {\r\n\t\t\t\t\tvar cols = this.cols;\r\n\t\t\t\t\tvar dateTimeCol = -1;\r\n\t\t\t\t\tvar labelCol = -1;\r\n\t\t\t\t\tvar valueCol = 0;\r\n\t\t\t\t\tvar sortCol = 0;\r\n\t\t\t\t\tvar groupCol = -1;\r\n\t\t\t\t\tvar recolorCol = -1;\r\n\t\t\t\t\tfor (let i = 0; i < cols.length; i++) {\r\n\t\t\t\t\t\t\tif (cols[i] == this.panel.DateTimeColName)\r\n\t\t\t\t\t\t\t\t\tdateTimeCol = i;\r\n\t\t\t\t\t\t\tif (cols[i] == this.panel.LabelColName)\r\n\t\t\t\t\t\t\t\t\tlabelCol = i;\r\n\t\t\t\t\t\t\tif (cols[i] == this.panel.ValueColName)\r\n\t\t\t\t\t\t\t\t\tvalueCol = i;\r\n\t\t\t\t\t\t\tif (cols[i] == this.panel.SortColName)\r\n\t\t\t\t\t\t\t\t\tsortCol = i;\r\n\t\t\t\t\t\t\tif (cols[i] == this.panel.GroupColName)\r\n\t\t\t\t\t\t\t\t\tgroupCol = i;\r\n\t\t\t\t\t\t\tif (cols[i] == this.panel.RecolorColName)\r\n\t\t\t\t\t\t\t\t\trecolorCol = i;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst groupedLabelFunc = function(obj){\r\n\t\t\t\t\t\tif (groupCol != -1)\r\n\t\t\t\t\t\t\treturn obj[groupCol] + ':' + obj[labelCol];\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treturn obj[labelCol];\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (this.panel.LabelNameFilter.length > 0 && labelCol != -1) {\r\n\t\t\t\t\t\t\tvar regex = new RegExp(this.panel.LabelNameFilter, \"\");\r\n\t\t\t\t\t\t\tthis.matchingRows = [];\r\n\t\t\t\t\t\t\tfor (let i = 0; i < this.data.rows.length; i++) {\r\n\t\t\t\t\t\t\t\t\tvar dd = this.data.rows[i];\r\n\t\t\t\t\t\t\t\t\tvar label = dd[labelCol];\r\n\t\t\t\t\t\t\t\t\tif (label.match(regex) != null)\r\n\t\t\t\t\t\t\t\t\t\t\tthis.matchingRows.push(dd);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (this.matchingRows.length == 0) {\r\n\t\t\t\t\t\t\t\t\tthis.displayStatusMessage(\"No data.  Regex filter '\" + this.panel.LabelNameFilter + \"' eliminated all \" + this.data.rows.length + \" rows from current query\");\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tthis.matchingRows = this.data.rows;\r\n\r\n\t\t\t\t\tif (this.panel.Aggregate != 'all' && labelCol != -1) {\r\n\t\t\t\t\t\t\tvar oo = [];\r\n\t\t\t\t\t\t\tthis.rows = [];\r\n\t\t\t\t\t\t\tswitch (this.panel.Aggregate) {\r\n\t\t\t\t\t\t\t\t\tcase 'first':\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.key(groupedLabelFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.rollup(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[0];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(x) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\too.push(x.value);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = oo;\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'last':\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t\t\t\t\t.key(groupedLabelFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t.rollup(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[d.length - 1];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(x) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\too.push(x.value);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = oo;\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'mean':\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t\t\t\t\t.key(groupedLabelFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t.rollup(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdd[valueCol] = d3.mean(d, function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[valueCol];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(x) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\too.push(x.value);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'max':\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t\t\t\t\t.key(groupedLabelFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t.rollup(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdd[valueCol] = d3.max(d, function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[valueCol];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(x) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\too.push(x.value);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t\tcase 'min':\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = d3.nest()\r\n\t\t\t\t\t\t\t\t\t\t\t.key(groupedLabelFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t.rollup(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar dd = Object.values(Object.assign({}, d[d.length - 1]));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdd[valueCol] = d3.min(d, function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[valueCol];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn dd;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.entries(this.matchingRows)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.forEach(function(x) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\too.push(x.value);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tthis.rows = Array.from(oo);\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.rows = this.matchingRows;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar groupNameOffset = this.panel.ShowGroupLabels ? Number(this.panel.GroupLabelFontSize.replace('%', '')) * 0.15 : 0;\r\n\r\n\t\t\t\t\tif (groupCol >= 0) {\r\n\t\t\t\t\t\t\tthis.groupedRows = d3.nest()\r\n\t\t\t\t\t\t\t\t\t.key(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn d[groupCol];\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.entries(this.rows);\r\n\r\n\t\t\t\t\t\t\tif (this.panel.GroupNameFilter.length > 0) {\r\n\t\t\t\t\t\t\t\t\tvar regexGroupRows = new RegExp(this.panel.GroupNameFilter, \"\");\r\n\t\t\t\t\t\t\t\t\tlet matchingGroups = [];\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < this.groupedRows.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet groupName = this.groupedRows[i].key;\r\n\t\t\t\t\t\t\t\t\t\t\tif (groupName.match(regexGroupRows) != null)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmatchingGroups.push(this.groupedRows[i]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (matchingGroups.length > 0)\r\n\t\t\t\t\t\t\t\t\t\t\tthis.groupedRows = matchingGroups;\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\tthis.displayStatusMessage(\"No groups.  Group Regex filter '\" + this.panel.GroupNameFilter + \"' eliminated all \" + this.groupedRows.length + \" groups from current query\");\r\n\t\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet groupSortString = this.panel.GroupSortString;\r\n\r\n\t\t\t\t\t\t\tthis.groupedRows.sort(\r\n\t\t\t\t\t\t\t\t\tfunction(a, b) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar aPos = groupSortString.search(a.key);\r\n\t\t\t\t\t\t\t\t\t\t\tvar bPos = groupSortString.search(b.key);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (aPos == bPos)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn a.key.localeCompare(b.key);\r\n\t\t\t\t\t\t\t\t\t\t\telse if (aPos == -1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\t\t\t\t\t\t\telse if (bPos == -1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn aPos - bPos;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.groupedRows = null;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.elem.html(\"<svg class='\" + this.className + \"'  style='height:100%; width:100%'></svg>\");\r\n\t\t\t\t\tvar $container = this.elem.find('.' + this.className);\r\n\r\n\t\t\t\t\tvar h = $container.height();\r\n\t\t\t\t\tvar w = $container.width() - 15;\r\n\t\t\t\t\tthis.buildDateHtml(dateTimeCol);\r\n\r\n\t\t\t\t\tvar horizontal = this.panel.Horizontal;\r\n\r\n\t\t\t\t\tvar labelMargin = ($.isNumeric(this.panel.LabelMargin) && this.panel.LabelMargin >= 0) ? this.panel.LabelMargin : null;\r\n\t\t\t\t\tvar lowSideMargin = this.panel.LowSideMargin >= 0 ? this.panel.LowSideMargin : 0;\r\n\t\t\t\t\tvar highSideMargin = this.panel.HighSideMargin >= 0 ? this.panel.HighSideMargin : 0;\r\n\r\n\t\t\t\t\tthis.svg = d3.select('.' + this.className).append('svg');\r\n\t\t\t\t\tthis.svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\").interrupt();\r\n\t\t\t\t\tthis.svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\").interrupt();\r\n\r\n\t\t\t\t\tvar id = this.panel.id;\r\n\t\t\t\t\tvar barPadding = this.panel.BarPadding;\r\n\t\t\t\t\tvar baseLineValue = this.panel.BaseLineValue;\r\n\t\t\t\t\tvar minLineValue = this.panel.MinLineValue;\r\n\t\t\t\t\tvar maxLineValue = this.panel.MaxLineValue;\r\n\t\t\t\t\tvar highBarColor = this.panel.HighBarColor;\r\n\t\t\t\t\tvar lowBarColor = this.panel.LowBarColor;\r\n\t\t\t\t\tvar highLimitValue = this.panel.HighLimitValue;\r\n\t\t\t\t\tvar HighLimitBarColor = this.panel.HighLimitBarColor;\r\n\t\t\t\t\tvar HighLimitBarFlashColor = this.panel.HighLimitBarFlashColor;\r\n\t\t\t\t\tvar HighLimitBarFlashTimeout = this.panel.HighLimitBarFlashTimeout;\r\n\t\t\t\t\tvar recolorHighLimitBar = this.panel.RecolorHighLimitBar;\r\n\t\t\t\t\tvar Links = this.panel.Links;\r\n\t\t\t\t\tvar lowLimitValue = this.panel.LowLimitValue;\r\n\t\t\t\t\tvar LowLimitBarColor = this.panel.LowLimitBarColor;\r\n\t\t\t\t\tvar LowLimitBarFlashColor = this.panel.LowLimitBarFlashColor;\r\n\t\t\t\t\tvar LowLimitBarFlashTimeout = this.panel.LowLimitBarFlashTimeout;\r\n\t\t\t\t\tvar RecolorRules = this.panel.RecolorRules;\r\n\t\t\t\t\tvar recolorLowLimitBar = this.panel.RecolorLowLimitBar;\r\n\t\t\t\t\tvar flashHighLimitBar = this.panel.FlashHighLimitBar;\r\n\t\t\t\t\tvar flashLowLimitBar = this.panel.FlashLowLimitBar;\r\n\t\t\t\t\tvar showTooltips = this.panel.ShowTooltips;\r\n\t\t\t\t\tvar DateTimeColName = this.panel.DateTimeColName;\r\n\t\t\t\t\tvar TooltipDateFormat = this.panel.TooltipDateFormat;\r\n\t\t\t\t\tvar ValueColName = this.panel.ValueColName;\r\n\t\t\t\t\tvar ValueDecimals = this.panel.ValueDecimals;\r\n\t\t\t\t\tvar OddRowColor = this.panel.OddRowColor;\r\n\t\t\t\t\tvar EvenRowColor = this.panel.EvenRowColor;\r\n\t\t\t\t\tvar OutlineColor = this.panel.OutlineColor;\r\n\t\t\t\t\tvar TZOffsetHours = this.panel.TZOffsetHours;\r\n\t\t\t\t\tvar GroupCols = this.panel.GroupCols;\r\n\t\t\t\t\tvar GroupGap = this.panel.GroupGap;\r\n\t\t\t\t\tvar ScaleFactor = Number(this.panel.ScaleFactor);\r\n\t\t\t\t\tvar LabelColor = this.panel.LabelColor;\r\n\t\t\t\t\tvar ValuePosition = this.panel.ValuePosition;\r\n\r\n\t\t\t\t\tvar tooltipDivID = \"michaeldmoore-multistat-panel-tooltip-\" + id;\r\n\r\n\t\t\t\t\tvar minValue = d3.min(this.rows, function(d) {\r\n\t\t\t\t\t\t\treturn Number(d[valueCol]) * ScaleFactor;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif ($.isNumeric(minLineValue) == false)\r\n\t\t\t\t\t\t\tminLineValue = minValue;\r\n\r\n\t\t\t\t\tvar maxValue = d3.max(this.rows, function(d) {\r\n\t\t\t\t\t\t\treturn Number(d[valueCol]) * ScaleFactor;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif ($.isNumeric(maxLineValue) == false)\r\n\t\t\t\t\t\t\tmaxLineValue = maxValue;\r\n\r\n\t\t\t\t\tif ($.isNumeric(baseLineValue) == false)\r\n\t\t\t\t\t\t\tbaseLineValue = 0;\r\n\r\n\t\t\t\t\tif (minLineValue > baseLineValue)\r\n\t\t\t\t\t\t\tminLineValue = baseLineValue;\r\n\r\n\t\t\t\t\tif ($.isNumeric(lowLimitValue) && minLineValue > lowLimitValue)\r\n\t\t\t\t\t\t\tminLineValue = lowLimitValue;\r\n\r\n\t\t\t\t\tif (maxLineValue < baseLineValue)\r\n\t\t\t\t\t\t\tmaxLineValue = baseLineValue;\r\n\r\n\t\t\t\t\tif ($.isNumeric(highLimitValue) && maxLineValue < highLimitValue)\r\n\t\t\t\t\t\t\tmaxLineValue = highLimitValue;\r\n\r\n\t\t\t\t\t$('#'+tooltipDivID).remove();\r\n\r\n\t\t\t\t\tvar translateValues = function (s, d) {\r\n\t\t\t\t\t\t// lookup column index corresponding to the substitution tokens and replace with this bar's value\r\n\t\t\t\t\t\tlet s1 = s;\r\n\t\t\t\t\t\tconst re = /\\{[^}]+\\}/g;\r\n\t\t\t\t\t\tlet g = re.exec(s);\r\n\t\t\t\t\t\twhile(g){\r\n\t\t\t\t\t\t\tfor(var i = 0; i < cols.length; i++){\r\n\t\t\t\t\t\t\t\tif (g=='{'+cols[i]+'}'){\r\n\t\t\t\t\t\t\t\t\ts1 = s1.replace(g, d[i]);\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n//\t\t\t\t\t\t\tconsole.log('match ['+g+'], lastIndex='+re.lastIndex+', s=\"'+s1+'\"');\r\n\t\t\t\t\t\t\tg = re.exec(s);\r\n\t\t\t\t\t\t}\r\n//\t\t\t\t\t\tconsole.log('\"'+s+'\" => \"'+s1+'\"');\r\n\t\t\t\t\t\treturn s1;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar getTooltipContent = function(d) {\r\n\t\t\t\t\t\tvar html = \"<table>\";\r\n\t\t\t\t\t\t//html += \"<tr><td>\" + \"ID\" + \"</td><td>\" + id + \"</td></tr>\";\r\n\t\t\t\t\t\tif (showTooltips){\r\n\t\t\t\t\t\t\tfor (var i = 0; i < d.length; i++) {\r\n\t\t\t\t\t\t\t\tvar cc = cols[i];\r\n\t\t\t\t\t\t\t\tvar dd = d[i];\r\n\r\n\t\t\t\t\t\t\t\tif (cc == DateTimeColName)\r\n\t\t\t\t\t\t\t\t\t\tdd = moment(dd).add(TZOffsetHours, 'h').format(TooltipDateFormat);\r\n\t\t\t\t\t\t\t\telse if (cc == ValueColName && $.isNumeric(dd))\r\n\t\t\t\t\t\t\t\t\t\tdd = Number(dd).toFixed(ValueDecimals);\r\n\r\n\t\t\t\t\t\t\t\thtml += \"<tr><td>\" + cc + \"</td><td>\" + dd + \"</td></tr>\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tLinks.forEach(l => {\r\n\t\t\t\t\t\t\thtml += \"<tr><td align='right'><i class='fa fa-link'></i></td><td><a href='\"+translateValues(l.url, d)+\r\n\t\t\t\t\t\t\t\t(l.newtab ? \"' target='_blank'\" : \"'\")+\">\"+l.name+\"</a></td></tr>\";\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\thtml += \"</table>\";\r\n\t\t\t\t\t\treturn html;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar isInTooltip = false;\r\n\t\t\t\t\tvar tooltipShow = function(id, d) {\r\n\t\t\t\t\t\tif (showTooltips || Links.length){\r\n\r\n\t\t\t\t\t\t\tif($('#'+tooltipDivID).length == 0){\r\n\t\t\t\t\t\t\t\td3.select(\"body\").append(\"div\")\r\n\t\t\t\t\t\t\t\t.attr(\"id\", tooltipDivID)\r\n\t\t\t\t\t\t\t\t.style(\"opacity\", 0);\r\n\t\t\t\t\t\t\t}\r\n\r\n//\t\t\t\t\t\t\tconst tooltipDivID = \"#michaeldmoore-multistat-panel-tooltip-\" + id;\r\n\t\t\t\t\t\t\tconst tooltipDiv = d3.selectAll('#'+tooltipDivID);\r\n\t\t\t\t\t\t\ttooltipDiv\r\n\t\t\t\t\t\t\t\t\t.classed(\"michaeldmoore-multistat-panel-tooltip\", true)\r\n\t\t\t\t\t\t\t\t\t.html(getTooltipContent(d))\r\n\t\t\t\t\t\t\t\t\t.on(\"mouseover\", function() {\r\n\t\t\t\t\t\t\t\t\t\tif (!isInTooltip){\r\n\t\t\t\t\t\t\t\t\t\t\tisInTooltip = true;\r\n\t\t\t\t\t\t\t\t\t\t\ttooltipHide(id, true);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.on(\"mouseleave\", function() {\r\n\t\t\t\t\t\t\t\t\t\t\tisInTooltip = false;\r\n\t\t\t\t\t\t\t\t\t\t\ttooltipHide(id, false);\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tconst $tooltipDiv = $('#'+tooltipDivID);\r\n\t\t\t\t\t\t\tconst www = $tooltipDiv.width();\r\n\t\t\t\t\t\t\tconst hhh = $tooltipDiv.height();\r\n\r\n\t\t\t\t\t\t\ttooltipDiv\r\n\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t.duration(500)\r\n\t\t\t\t\t\t\t\t\t.style(\"opacity\", 1.0)\r\n\t\t\t\t\t\t\t\t\t.style(\"left\", (d3.event.pageX - www/2) + \"px\")\r\n\t\t\t\t\t\t\t\t\t.style(\"top\", (d3.event.pageY - hhh/2) + \"px\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar tooltipHide = function(id, cancel) {\r\n\t\t\t\t\t\tconst tooltipDiv = d3.selectAll('#'+tooltipDivID);\r\n\r\n\t\t\t\t\t\tif (cancel){\r\n\t\t\t\t\t\t\t//console.log(\"cancelling tooltip hide\");\r\n\t\t\t\t\t\t\ttooltipDiv\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.style(\"opacity\", 1.0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\ttooltipDiv\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(2000)\r\n\t\t\t\t\t\t\t.style(\"opacity\", 0)\r\n\t\t\t\t\t\t\t.on(\"end\", function () {\r\n\t\t\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t\t\t.html('')\r\n\t\t\t\t\t\t\t\t\t.classed(\"michaeldmoore-multistat-panel-tooltip\", false);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar scaleAndClipValue = function(d) {\r\n\t\t\t\t\t\t\tvar val = d * ScaleFactor;\r\n\t\t\t\t\t\t\tif (val > maxLineValue)\r\n\t\t\t\t\t\t\t\t\tval = maxLineValue;\r\n\t\t\t\t\t\t\tif (val < minLineValue)\r\n\t\t\t\t\t\t\t\t\tval = minLineValue;\r\n\r\n\t\t\t\t\t\t\treturn val;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar getBarColor = function(d) {\r\n\t\t\t\t\t\tif (recolorCol != -1){\r\n\t\t\t\t\t\t\tlet recolorString = d[recolorCol];\r\n\r\n\t\t\t\t\t\t\tif (RecolorRules.length){\r\n\t\t\t\t\t\t\t\tif (recolorString) {\r\n\t\t\t\t\t\t\t\t\tlet recolorRule = RecolorRules.find(r => {\r\n\t\t\t\t\t\t\t\t\t\tif (r.pattern) {\r\n\t\t\t\t\t\t\t\t\t\t\tswitch(r.matchType) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'reg-ex':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet re = RegExp(r.pattern);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn re.test(recolorString);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'list':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn r.pattern.indexOf(recolorString) != -1;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'subset':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn recolorString.indexOf(r.pattern) != -1;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn r.pattern===recolorString;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tif (recolorRule)\r\n\t\t\t\t\t\t\t\t\t\treturn recolorRule.color;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// no matching rule found, check if recolorString is a valid color\r\n\t\t\t\t\t\t\tconst s = new Option().style;\r\n\t\t\t\t\t\t\ts.color = recolorString;\r\n\t\t\t\t\t\t\tif (s.color !== '')\r\n\t\t\t\t\t\t\t\treturn recolorString;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet value = d[valueCol] * ScaleFactor;\r\n\t\t\t\t\t\tif (recolorHighLimitBar && (value > highLimitValue))\r\n\t\t\t\t\t\t\treturn HighLimitBarColor;\r\n\t\t\t\t\t\tif (recolorLowLimitBar && (value < lowLimitValue))\r\n\t\t\t\t\t\t\treturn LowLimitBarColor;\r\n\t\t\t\t\t\treturn (value > baseLineValue) ? highBarColor : lowBarColor;\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tif (horizontal) {\r\n\t\t\t\t\t\t\tvar plotGroupHorizontal = function(panel, svg, data, numRows, groupName, groupNameOffset, left, w, hh, dh) {\r\n\r\n\t\t\t\t\t\t\t\t\t// Draw border rectangle\r\n\t\t\t\t\t\t\t\t\t/*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"yellow\");*/\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.SortDirection != \"none\") {\r\n\t\t\t\t\t\t\t\t\t\tvar ascending = panel.SortDirection == \"ascending\";\r\n\t\t\t\t\t\t\t\t\t\tdata.sort(function(x, y) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn ascending ? x[sortCol] - y[sortCol] : y[sortCol] - x[sortCol];\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Add Above-High Side Group Names\r\n\t\t\t\t\t\t\t\t\tif (groupName != '' && panel.ShowGroupLabels) {\r\n\t\t\t\t\t\t\t\t\t\t\tsvg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(groupName)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left + (labelMargin + w) / 2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh + groupNameOffset / 2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.GroupLabelFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.GroupLabelColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"background\", \"blue\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\thh += groupNameOffset;\r\n\t\t\t\t\t\t\t\t\tdh -= groupNameOffset;\r\n\r\n\t\t\t\t\t\t\t\t\t// Draw border rectangle\r\n\t\t\t\t\t\t\t\t\t/*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"#ffffff\");*/\r\n\r\n\t\t\t\t\t\t\t\t\tvar labels = data.map(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn d[labelCol];\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\twhile (labels.length < numRows)\r\n\t\t\t\t\t\t\t\t\t\t\tlabels = labels.concat('_' + Math.random().toString(36).substr(2, 9));\r\n\r\n\t\t\t\t\t\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t\t\t\t.domain(labels)\r\n\t\t\t\t\t\t\t\t\t\t\t.rangeRound([hh + highSideMargin, hh + dh - lowSideMargin])\r\n\t\t\t\t\t\t\t\t\t\t\t.paddingInner(barPadding / 100)\r\n\t\t\t\t\t\t\t\t\t\t\t.paddingOuter(barPadding / 200);\r\n\r\n\t\t\t\t\t\t\t\t\tvar stripedata = data.concat(d3.range(data.length, numRows));\r\n\r\n\t\t\t\t\t\t\t\t\tvar stripeScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t\t\t\t.domain(stripedata)\r\n\t\t\t\t\t\t\t\t\t\t\t.rangeRound([hh + highSideMargin, hh + dh - lowSideMargin]);\r\n\r\n\t\t\t\t\t\t\t\t\t// Draw background of alternating stripes\r\n\t\t\t\t\t\t\t\t\tvar oddeven = false;\r\n\t\t\t\t\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t.data(stripedata)\r\n\t\t\t\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"height\", stripeScale.step())\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn stripeScale(d);\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toddeven = !oddeven;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn oddeven ? OddRowColor : EvenRowColor;\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tvar g1 = svg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t\t\t\t.append(\"g\");\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar maxValueWidth = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tg1.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left + w)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.each(function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar thisWidth = this.getComputedTextLength();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxValueWidth = d3.max([maxValueWidth, thisWidth]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tw -= maxValueWidth;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowLabels) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar maxLabelWidth = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tvar labelAngle = Number(panel.LableAngle);\r\n\t\t\t\t\t\t\t\t\t\t\tg1.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[labelCol];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.LabelFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet value = d[valueCol] * ScaleFactor;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn ((value > maxLineValue) || (value < minLineValue)) ? panel.OutOfRangeLabelColor : panel.LabelColor;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"transform\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar bbox = this.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar s = Math.sin(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar c = Math.cos(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar y = labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar x = left + a / 2;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn \"translate(\" + x + \",\" + y + \") rotate(\" + labelAngle + \")\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.each(function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar bbox = this.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar s = Math.sin(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar c = Math.cos(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar thisWidth = a;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxLabelWidth = d3.max([maxLabelWidth, thisWidth]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ($.isNumeric(labelMargin)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft += labelMargin;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tw -= labelMargin;\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tleft += maxLabelWidth;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tw -= maxLabelWidth;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t\t\t\t\t\t.domain([minLineValue, maxLineValue])\r\n\t\t\t\t\t\t\t\t\t\t\t.range([left + labelMargin, left + w])\r\n\t\t\t\t\t\t\t\t\t\t\t.nice();\r\n\r\n\t\t\t\t\t\t\t\t\tfunction vLine(svg, value, color, strokeWidth) {\r\n\t\t\t\t\t\t\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke-width\", strokeWidth == null ? 1 : strokeWidth)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y1\", hh + highSideMargin)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x1\", valueScale(value))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y2\", hh + dh - lowSideMargin)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x2\", valueScale(value));\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowBaseLine)\r\n\t\t\t\t\t\t\t\t\t\t\tvLine(svg, baseLineValue, panel.BaseLineColor, panel.BaseLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowMaxLine)\r\n\t\t\t\t\t\t\t\t\t\t\tvLine(svg, maxLineValue, panel.MaxLineColor, panel.MaxLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowMinLine)\r\n\t\t\t\t\t\t\t\t\t\t\tvLine(svg, minLineValue, panel.MinLineColor, panel.MinLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowHighLimitLine)\r\n\t\t\t\t\t\t\t\t\t\t\tvLine(svg, highLimitValue, panel.HighLimitLineColor, panel.HighLimitLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowLowLimitLine)\r\n\t\t\t\t\t\t\t\t\t\t\tvLine(svg, lowLimitValue, panel.LowLimitLineColor, panel.LowLimitLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowBars) {\r\n\t\t\t\t\t\t\t\t\t\t\tg1.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"width\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn Math.abs(valueScale(val) - valueScale(baseLineValue));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"height\", labelScale.bandwidth())\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d3.min([valueScale(val), valueScale(baseLineValue)]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", function(d) { return getBarColor(d);})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.classed(\"highflash\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn recolorHighLimitBar && flashHighLimitBar && (d[valueCol] * ScaleFactor > highLimitValue);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.classed(\"lowflash\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn recolorLowLimitBar && flashLowLimitBar && (d[valueCol] * ScaleFactor < lowLimitValue);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowLines) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (panel.LineWidth) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar points = [];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar bw = labelScale.step();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar d = data[i];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar y = hh + highSideMargin + (i + 0.5) * bw;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar x = valueScale(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpoints.push({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ty\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar curveFunc = d3.curveLinear;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tswitch (panel.CurveType) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Linear':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveLinear;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Monotone':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveMonotoneY;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Cardinal':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveCardinal;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Catmull-Rom':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveCatmullRom;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar lineFunction = d3.line()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.curve(curveFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.x(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d.x;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.y(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d.y;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar lineGraph = svg.append(\"path\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"d\", lineFunction(points))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", panel.LineColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke-width\", panel.LineWidth)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", \"none\");\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (panel.DotSize) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tg1.append(\"circle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"r\", panel.DotSize / 2.0)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.DotColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"cy\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]) + (bw * (1.0 - (barPadding/100.0)) / 2.0);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"cx\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn valueScale(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\tg1.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (panel.ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn valueScale(baseLineValue);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn valueScale(val) + ((val > baseLineValue));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (panel.ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"start\" : \"end\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"end\" : \"start\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t.data(stripedata)\r\n\t\t\t\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"height\", stripeScale.step())\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn stripeScale(d);\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", \"rgba(0,0,0,0)\")\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", OutlineColor)\r\n\t\t\t\t\t\t\t\t\t\t\t.on(\"mouseover\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (showTooltips || Links.length/* && i < data.length*/)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltipShow(id, d);\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t.on(\"mouseleave\", function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (!isInTooltip){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttooltipHide(id, false);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t// Add High Side Value Axis (X)\r\n\t\t\t\t\t\t\t\t\tif (highSideMargin > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar ggHighSide = svg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"transform\", 'translate(1,' + (hh + highSideMargin) + ')')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.call(d3.axisTop(valueScale));\r\n\t\t\t\t\t\t\t\t\t\t\tggHighSide.selectAll('.tick text').attr('fill', panel.HighAxisColor);\r\n\t\t\t\t\t\t\t\t\t\t\tggHighSide.selectAll('.tick line').attr('stroke', panel.HighAxisColor).attr('stroke-width', panel.HighAxisWidth);\r\n\t\t\t\t\t\t\t\t\t\t\tggHighSide.selectAll('path.domain').attr('stroke', panel.HighAxisColor).attr('stroke-width', panel.HighAxisWidth);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Add Low Side Value Axis (X)\r\n\t\t\t\t\t\t\t\t\tif (lowSideMargin > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar ggLowSide = svg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"transform\", 'translate(0,' + (hh + dh - lowSideMargin) + ')')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-valueaxis\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.call(d3.axisBottom(valueScale));\r\n\t\t\t\t\t\t\t\t\t\t\tggLowSide.selectAll('.tick text').attr('fill', panel.LowAxisColor);\r\n\t\t\t\t\t\t\t\t\t\t\tggLowSide.selectAll('.tick line').attr('stroke', panel.LowAxisColor).attr('stroke-width', panel.LowAxisWidth);\r\n\t\t\t\t\t\t\t\t\t\t\tggLowSide.selectAll('path.domain').attr('stroke', panel.LowAxisColor).attr('stroke-width', panel.LowAxisWidth);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\tif (this.groupedRows != null) {\r\n\t\t\t\t\t\t\t\t\tvar gcols = (GroupCols <= 0 || GroupCols > this.groupedRows.length) ? this.groupedRows.length : GroupCols;\r\n\t\t\t\t\t\t\t\t\tvar dw = ((w + GroupGap) / gcols);\r\n\r\n\t\t\t\t\t\t\t\t\t// Figure out the max data points in each row of groups...\r\n\t\t\t\t\t\t\t\t\tvar pointsPerRow = [];\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < this.groupedRows.length / gcols; i++)\r\n\t\t\t\t\t\t\t\t\t\t\tpointsPerRow.push(0);\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < this.groupedRows.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet rr = Math.floor(i / gcols);\r\n\t\t\t\t\t\t\t\t\t\t\tlet u = this.groupedRows[i].values.length;\r\n\t\t\t\t\t\t\t\t\t\t\tif (pointsPerRow[rr] < u)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpointsPerRow[rr] = u;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tvar totalPoints = 0;\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < pointsPerRow.length; i++)\r\n\t\t\t\t\t\t\t\t\t\t\ttotalPoints += pointsPerRow[i];\r\n\r\n\t\t\t\t\t\t\t\t\tvar rowOverheadHeight = groupNameOffset + this.panel.LowSideMargin + this.panel.HighSideMargin;\r\n\t\t\t\t\t\t\t\t\tvar rowHeight = (h - (pointsPerRow.length * rowOverheadHeight)) / totalPoints;\r\n\r\n\t\t\t\t\t\t\t\t\tvar numRows = Math.ceil(this.groupedRows.length / gcols);\r\n\t\t\t\t\t\t\t\t\tvar hh = 0;\r\n\t\t\t\t\t\t\t\t\tfor (var rr = 0; rr < numRows; rr++) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar nn = pointsPerRow[rr];\r\n\t\t\t\t\t\t\t\t\t\t\tvar dh = rowOverheadHeight + (nn * rowHeight);\r\n\t\t\t\t\t\t\t\t\t\t\thh += dh;\r\n\t\t\t\t\t\t\t\t\t\t\tfor (var cc = 0; cc < gcols; cc++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar ii = cc + (rr * gcols);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (ii < this.groupedRows.length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tplotGroupHorizontal(this.panel, this.svg, this.groupedRows[ii].values, nn, this.groupedRows[ii].key, groupNameOffset,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcc * dw, dw - GroupGap, hh - dh, dh);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tplotGroupHorizontal(this.panel, this.svg, this.rows, this.rows.length, '', 0, 0, w, 0, h);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvar plotGroupVertical = function(panel, svg, data, numRows, groupName, groupNameOffset, left, w, hh, dh) {\r\n\r\n\t\t\t\t\t\t\t\t\t// Draw border rectangle\r\n\t\t\t\t\t\t\t\t\t/*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"yellow\");*/\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.SortDirection != \"none\") {\r\n\t\t\t\t\t\t\t\t\t\tvar ascending = panel.SortDirection == \"ascending\";\r\n\t\t\t\t\t\t\t\t\t\tdata.sort(function(x, y) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn ascending ? x[sortCol] - y[sortCol] : y[sortCol] - x[sortCol];\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Add Above-High Side Group Names\r\n\t\t\t\t\t\t\t\t\tif (groupName != '' && panel.ShowGroupLabels) {\r\n\t\t\t\t\t\t\t\t\t\t\tsvg\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(groupName)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left + (labelMargin + w) / 2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh + groupNameOffset / 2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.GroupLabelFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.GroupLabelColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"background\", \"blue\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\thh += groupNameOffset;\r\n\t\t\t\t\t\t\t\t\tdh -= groupNameOffset;\r\n\r\n\t\t\t\t\t\t\t\t\t// Draw border rectangle\r\n\t\t\t\t\t\t\t\t\t/*svg.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"width\", w)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"x\", left)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", \"#ffffff\");*/\r\n\r\n\r\n\t\t\t\t\t\t\t\t\tvar labels = data.map(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn d[labelCol];\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\twhile (labels.length < numRows)\r\n\t\t\t\t\t\t\t\t\t\t\tlabels = labels.concat('_' + Math.random().toString(36).substr(2, 9));\r\n\r\n\t\t\t\t\t\t\t\t\tvar labelScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t\t\t\t.domain(labels)\r\n\t\t\t\t\t\t\t\t\t\t\t.range([left + lowSideMargin, left + w - highSideMargin])\r\n\t\t\t\t\t\t\t\t\t\t\t.paddingInner(barPadding / 100)\r\n\t\t\t\t\t\t\t\t\t\t\t.paddingOuter(barPadding / 200);\r\n\r\n\t\t\t\t\t\t\t\t\tvar stripedata = data.concat(d3.range(data.length, numRows));\r\n\r\n\t\t\t\t\t\t\t\t\tvar stripeScale = d3.scaleBand()\r\n\t\t\t\t\t\t\t\t\t\t\t.domain(stripedata)\r\n\t\t\t\t\t\t\t\t\t\t\t.range([left + lowSideMargin, left + w - highSideMargin]);\r\n\r\n\t\t\t\t\t\t\t\t\t// Draw background of alternating stripes\r\n\t\t\t\t\t\t\t\t\tvar oddeven = false;\r\n\t\t\t\t\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t.data(stripedata)\r\n\t\t\t\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-row\")\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"width\", stripeScale.step())\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn stripeScale(d);\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\toddeven = !oddeven;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn oddeven ? OddRowColor : EvenRowColor;\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tvar g2 = svg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t\t\t\t.append(\"g\");\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowValues && panel.ValuePosition == \"top\") {\r\n\t\t\t\t\t\t\t\t\t\t\tvar maxValueHeight = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tg2.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"text-before-edge\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.each(function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar thisHeight = this.getBBox().height;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxValueHeight = d3.max([maxValueHeight, thisHeight]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\thh += maxValueHeight;\r\n\t\t\t\t\t\t\t\t\t\t\tdh -= maxValueHeight;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowLabels) {\r\n\t\t\t\t\t\t\t\t\t\t\tvar maxLabelHeight = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tvar labelAngle = Number(panel.LableAngle);\r\n\t\t\t\t\t\t\t\t\t\t\tg2.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.text(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[labelCol];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.LabelFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d[valueCol] * ScaleFactor > maxLineValue || d[valueCol] * ScaleFactor < minLineValue ? panel.OutOfRangeLabelColor : LabelColor;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", \"central\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"transform\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar bbox = this.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar s = Math.sin(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar c = Math.cos(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar x = labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar y = hh + dh - b / 2;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn \"translate(\" + x + \",\" + y + \") rotate(\" + labelAngle + \")\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.each(function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar bbox = this.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar s = Math.sin(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar c = Math.cos(labelAngle * Math.PI / 180);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar b = Math.abs(bbox.width * s) + Math.abs(bbox.height * c);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar a = Math.abs(bbox.width * c) + Math.abs(bbox.height * s);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar thisHeight = b;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxLabelHeight = d3.max([maxLabelHeight, thisHeight]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\tif ($.isNumeric(labelMargin)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdh -= labelMargin;\r\n\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdh -= maxLabelHeight;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tvar valueScale = d3.scaleLinear()\r\n\t\t\t\t\t\t\t\t\t\t\t.domain([maxLineValue, minLineValue])\r\n\t\t\t\t\t\t\t\t\t\t\t.range([hh, hh + dh])\r\n\t\t\t\t\t\t\t\t\t\t\t.nice();\r\n\r\n\t\t\t\t\t\t\t\t\tfunction hLine(svg, value, color, strokeWidth) {\r\n\t\t\t\t\t\t\t\t\t\t\tsvg.append(\"line\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.style(\"stroke\", color)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke-width\", strokeWidth == null ? 1 : strokeWidth)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x1\", left + lowSideMargin)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y1\", valueScale(value))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x2\", left + w - highSideMargin)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y2\", valueScale(value));\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowBaseLine)\r\n\t\t\t\t\t\t\t\t\t\t\thLine(svg, baseLineValue, panel.BaseLineColor, panel.BaseLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowMaxLine)\r\n\t\t\t\t\t\t\t\t\t\t\thLine(svg, maxLineValue, panel.MaxLineColor, panel.MaxLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowMinLine)\r\n\t\t\t\t\t\t\t\t\t\t\thLine(svg, minLineValue, panel.MinLineColor, panel.MinLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowHighLimitLine)\r\n\t\t\t\t\t\t\t\t\t\t\thLine(svg, highLimitValue, panel.HighLimitLineColor, panel.HighLimitLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowLowLimitLine)\r\n\t\t\t\t\t\t\t\t\t\t\thLine(svg, lowLimitValue, panel.LowLimitLineColor, panel.LowLimitLineWidth);\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowBars) {\r\n\t\t\t\t\t\t\t\t\t\t\tg2.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"class\", \"michaeldmoore-multistat-panel-bar\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"height\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn Math.abs(valueScale(baseLineValue) - valueScale(val));\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"width\", labelScale.bandwidth())\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d3.min([valueScale(val), valueScale(baseLineValue)]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", function(d) { return getBarColor(d);})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.classed(\"highflash\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn recolorHighLimitBar && flashHighLimitBar && (d[valueCol] * ScaleFactor > highLimitValue);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.classed(\"lowflash\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn recolorLowLimitBar && flashLowLimitBar && (d[valueCol] * ScaleFactor < lowLimitValue);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowLines) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (panel.LineWidth) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar points = [];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar bw = labelScale.step();\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar d = data[i];\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar x = left + lowSideMargin + (i + 0.5) * bw;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar y = valueScale(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpoints.push({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ty\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar curveFunc = d3.curveLinear;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tswitch (panel.CurveType) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Linear':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveLinear;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Monotone':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveMonotoneX;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Cardinal':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveCardinal;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcase 'Catmull-Rom':\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurveFunc = d3.curveCatmullRom;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar lineFunction = d3.line()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.curve(curveFunc)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.x(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d.x;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.y(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn d.y;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar lineGraph = svg.append(\"path\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"d\", lineFunction(points))\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", panel.LineColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke-width\", panel.LineWidth)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", \"none\");\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif (panel.DotSize) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tg2.append(\"circle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"r\", panel.DotSize / 2.0)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.DotColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"cx\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]) + (bw * (1.0 - (barPadding/100.0)) / 2.0);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"cy\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn valueScale(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (panel.ShowValues && panel.ValuePosition != \"top\") {\r\n\t\t\t\t\t\t\t\t\t\t\tg2.append(\"text\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.text(function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (Number(d[valueCol]) * ScaleFactor).toFixed(ValueDecimals);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn labelScale(d[labelCol]) + (labelScale.bandwidth() / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn valueScale(baseLineValue);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar val = scaleAndClipValue(d[valueCol]);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn valueScale(val);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-family\", \"sans-serif\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"font-size\", panel.ValueFontSize)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", panel.ValueColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"dominant-baseline\", function(d) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (ValuePosition == \"bar base\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"text-after-edge\" : \"text-before-edge\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn (d[valueCol] * ScaleFactor > baseLineValue) ? \"text-before-edge\" : \"text-after-edge\";\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tsvg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.data(stripedata)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"width\", stripeScale.step())\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"height\", dh)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"x\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn stripeScale(d);\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"y\", hh)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"fill\", \"rgba(0,0,0,0)\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t.attr(\"stroke\", OutlineColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t.on(\"mouseover\", function(d, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (showTooltips || Links.length/* && i < data.length*/)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltipShow(id, d);\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t.on(\"mouseleave\", function() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttooltipHide(id, false);\r\n\t\t\t\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\t\tif (lowSideMargin > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet ggLowSide = svg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr('transform', 'translate(' + (left + lowSideMargin) + ', 0)')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.call(d3.axisLeft(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t\t\t\t\t\t\t\tggLowSide.selectAll('.tick text').attr('fill', panel.LowAxisColor);\r\n\t\t\t\t\t\t\t\t\t\t\tggLowSide.selectAll('.tick line').attr('stroke', panel.LowAxisColor).attr('stroke-width', panel.LowAxisWidth);\r\n\t\t\t\t\t\t\t\t\t\t\tggLowSide.selectAll('path.domain').attr('stroke', panel.LowAxisColor).attr('stroke-width', panel.LowAxisWidth);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (highSideMargin > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet ggHighSide = svg.append(\"g\")\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.attr('transform', 'translate(' + (left + w - highSideMargin) + ', 0)')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.classed('michaeldmoore-multistat-panel-valueaxis', true)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t.call(d3.axisRight(valueScale).tickSizeInner(5).tickSizeOuter(10).ticks(5));\r\n\t\t\t\t\t\t\t\t\t\t\tggHighSide.selectAll('.tick text').attr('fill', panel.HighAxisColor);\r\n\t\t\t\t\t\t\t\t\t\t\tggHighSide.selectAll('.tick line').attr('stroke', panel.HighAxisColor).attr('stroke-width', panel.HighAxisWidth);\r\n\t\t\t\t\t\t\t\t\t\t\tggHighSide.selectAll('path.domain').attr('stroke', panel.HighAxisColor).attr('stroke-width', panel.HighAxisWidth);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t};\r\n\r\n\r\n\t\t\t\t\t\t\tlet groupNameOffset = this.panel.ShowGroupLabels ? Number(this.panel.GroupLabelFontSize.replace('%', '')) * 0.15 : 0;\r\n\r\n\t\t\t\t\t\t\tif (this.groupedRows != null) {\r\n\t\t\t\t\t\t\t\t\tlet gcols = (GroupCols <= 0 || GroupCols > this.groupedRows.length) ? this.groupedRows.length : GroupCols;\r\n\t\t\t\t\t\t\t\t\tlet dw = ((w + GroupGap) / gcols);\r\n\r\n\t\t\t\t\t\t\t\t\t// Figure out the max data points in each column of groups...\r\n\t\t\t\t\t\t\t\t\tvar pointsPerCol = [];\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < gcols; i++)\r\n\t\t\t\t\t\t\t\t\t\t\tpointsPerCol.push(0);\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < this.groupedRows.length; i++) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet cc = i % gcols;\r\n\t\t\t\t\t\t\t\t\t\t\tlet u = this.groupedRows[i].values.length;\r\n\t\t\t\t\t\t\t\t\t\t\tif (pointsPerCol[cc] < u)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpointsPerCol[cc] = u;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tlet totalPoints = 0;\r\n\t\t\t\t\t\t\t\t\tfor (let i = 0; i < pointsPerCol.length; i++)\r\n\t\t\t\t\t\t\t\t\t\t\ttotalPoints += pointsPerCol[i];\r\n\r\n\t\t\t\t\t\t\t\t\tvar colOverheadWidth = this.panel.LowSideMargin + this.panel.HighSideMargin;\r\n\t\t\t\t\t\t\t\t\tvar colWidth = (w - (pointsPerCol.length * colOverheadWidth)) / totalPoints;\r\n\r\n\t\t\t\t\t\t\t\t\tlet numRows = Math.ceil(this.groupedRows.length / gcols);\r\n\t\t\t\t\t\t\t\t\tlet dh = h / numRows;\r\n\t\t\t\t\t\t\t\t\tlet hh = dh;\r\n\t\t\t\t\t\t\t\t\tfor (let rr = 0; rr < numRows; rr++) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet ww = 0;\r\n\t\t\t\t\t\t\t\t\t\t\tfor (let cc = 0; cc < gcols; cc++) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet nn = pointsPerCol[cc];\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet ii = cc + (rr * gcols);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (ii < this.groupedRows.length) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tplotGroupVertical(this.panel, this.svg, this.groupedRows[ii].values, nn, this.groupedRows[ii].key, groupNameOffset,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tww, dw - GroupGap, hh - dh, dh);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tww += dw;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\thh += dh;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tplotGroupVertical(this.panel, this.svg, this.rows, this.rows.length, '', 0, 0, w, 0, h);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar pulseHigh = function(svg) {\r\n\t\t\t\t\t\t\tvar highFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.highflash\");\r\n\r\n\t\t\t\t\t\t\tif ($.isNumeric(HighLimitBarFlashTimeout) && highFlashRects._groups.length > 0 && highFlashRects._groups[0].length > 0) {\r\n\t\t\t\t\t\t\t\t\thighFlashRects\r\n\t\t\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t\t\t.on(\"start\", function highRepeat() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td3.active(this)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.style(\"fill\", HighLimitBarFlashColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.style(\"fill\", HighLimitBarColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.duration(HighLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.on(\"start\", highRepeat);\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tvar pulseLow = function(svg) {\r\n\t\t\t\t\t\t\tvar lowFlashRects = svg.selectAll(\"rect.michaeldmoore-multistat-panel-bar.lowflash\");\r\n\t\t\t\t\t\t\tif ($.isNumeric(LowLimitBarFlashTimeout) && lowFlashRects._groups.length > 0 && lowFlashRects._groups[0].length > 0) {\r\n\t\t\t\t\t\t\t\t\tlowFlashRects\r\n\t\t\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t\t\t.on(\"start\", function lowRepeat() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\td3.active(this)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.style(\"fill\", LowLimitBarFlashColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.style(\"fill\", LowLimitBarColor)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.duration(LowLimitBarFlashTimeout)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.on(\"start\", lowRepeat);\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tpulseHigh(this.svg);\r\n\t\t\t\t\tpulseLow(this.svg);\r\n\t\t\t} else {\r\n\t\t\t\tthis.displayStatusMessage(\"No data\");\r\n\t\t\t}\r\n\r\n\t\t\t// console.log((new XMLSerializer()).serializeToString(this.svg.node()));\r\n\r\n\t\t\tthis.ctrl.renderingCompleted();\r\n\t}\r\n\r\n\tonConfigChanged() {\r\n\t\t\tthis.refresh();\r\n\t}\r\n\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\t\tthis.ctrl = ctrl;\r\n\t\t\tthis.elem = elem;\r\n\r\n\t\t\t// for backward compatability (grafana 6.6.0 and earlier)\r\n\t\t\tvar panelContentElem = elem.find('.panel-content');\r\n\t\t\tif (panelContentElem.length)\r\n\t\t\t\tthis.elem = panelContentElem;\r\n\t}\r\n}\r\n\r\nMultistatPanelCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n\tMultistatPanelCtrl as PanelCtrl\r\n};\r\n"]}